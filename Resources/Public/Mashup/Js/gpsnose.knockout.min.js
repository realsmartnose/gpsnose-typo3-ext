class BaseViewModel{constructor(){this.AppleLink=ko.observable("https://itunes.apple.com/us/app/gpsnose/id892215768"),this.GoogleLink=ko.observable("https://goo.gl/4q4TGl"),this.YoutubeLink=ko.observable("https://www.youtube.com/embed/ZD6O-Hy7NtA"),this.SupportedDefaultKeywords=["fireplace","pingpongtische-ch","osm-wc","osm-bicycle","osm-medi","osm-pets","osm-emobility","osm-hydrant"]}GetQrCodeUrl(e){return gnSettings.BaseUrl+"/Components/QrCode?tag="+encodeURIComponent(e)}GetLoginUrl(e){return-1<window.location.href.indexOf("/Account/Login")?e:(e||"/Account/Login")+"?returnUrl="+encodeURIComponent("/"+window.location.href.replace(/^(?:\/\/|[^\/]+)*\//,""))}GetHtmlFromString(e){return e?(e=(e=(e=e.replace(/(?:\r\n|\r|\n)/g," <br> ")).replace(/(https?:\/\/[^\s]+)/g,function(e){return'<a href="'+e+'" data-external>'+decodeURI(e)+"</a>"})).replace(/( |^)www\.[^\s]+\.[^\s]+/g,function(e){return'<a href="https://'+e.trim()+'" data-external>'+decodeURI(e)+"</a>"})).replace(/[\w-\.]+@([\w-]+\.)+[\w-]{2,4}/g,function(e){return'<a href="mailto:'+e+'">'+decodeURI(e)+"</a>"}):""}GetKeywordDisplayName(e){return e?0===e.lastIndexOf("i-",0)&&2<e.length?e.substring(2):"grillstelle-ch"==e?"fireplace":e:""}GetDefaultImageFromKeywords(t){if(Array.isArray(t)||null==t||(t=t.split(";")),Array.isArray(t)){let e=t.map(e=>{e=this.GetKeywordDisplayName(e);if(-1!=this.SupportedDefaultKeywords.indexOf(e))return e;var t=e.lastIndexOf("-");if(0<t){e=e.substring(0,t);if(-1!=this.SupportedDefaultKeywords.indexOf(e))return e;t=e.lastIndexOf("-");if(0<t){e=e.substring(0,t);if(-1!=this.SupportedDefaultKeywords.indexOf(e))return e}}return null}).filter(e=>null!=e);if(0<e.length&&e[0])return gnSettings.ImagePath+"/default_"+e[0].replace(/\-/g,"_")+".png"}return""}}class BaseComponentsViewModel{constructor(e){this.AppleLink=ko.observable("https://itunes.apple.com/us/app/gpsnose/id892215768"),this.GoogleLink=ko.observable("https://goo.gl/4q4TGl"),this.YoutubeLink=ko.observable("https://www.youtube.com/embed/ZD6O-Hy7NtA"),this.SupportedDefaultKeywords=["fireplace","pingpongtische-ch","osm-wc","osm-bicycle","osm-medi","osm-pets","osm-emobility","osm-hydrant"],this.ImagePath=ko.observable(e||"/Content/Mashup/Images")}GetLoginUrl(e){return(e||"/Account/Login")+"?returnUrl="+encodeURIComponent("/"+window.location.href.replace(/^(?:\/\/|[^\/]+)*\//,""))}GetHtmlFromString(e){return e?(e=(e=(e=e.replace(/(?:\r\n|\r|\n)/g," <br> ")).replace(/(https?:\/\/[^\s]+)/g,function(e){return'<a href="'+e+'" data-external>'+decodeURI(e)+"</a>"})).replace(/( |^)www\.[^\s]+\.[^\s]+/g,function(e){return'<a href="https://'+e.trim()+'" data-external>'+decodeURI(e)+"</a>"})).replace(/[\w-\.]+@([\w-]+\.)+[\w-]{2,4}/g,function(e){return'<a href="mailto:'+e+'">'+decodeURI(e)+"</a>"}):""}GetKeywordDisplayName(e){return e?0===e.lastIndexOf("i-",0)&&2<e.length?e.substring(2):"grillstelle-ch"==e?"fireplace":e:""}GetDefaultImageFromKeywords(t){if(Array.isArray(t)||null==t||(t=t.split(";")),Array.isArray(t)){let e=t.map(e=>{e=this.GetKeywordDisplayName(e);if(-1!=this.SupportedDefaultKeywords.indexOf(e))return e;var t=e.lastIndexOf("-");if(0<t){e=e.substring(0,t);if(-1!=this.SupportedDefaultKeywords.indexOf(e))return e;t=e.lastIndexOf("-");if(0<t){e=e.substring(0,t);if(-1!=this.SupportedDefaultKeywords.indexOf(e))return e}}return null}).filter(e=>null!=e);if(0<e.length&&e[0])return gnSettings.ImagePath+"/default_"+e[0].replace(/\-/g,"_")+".png"}return""}GetPackageTitle(e){let t=this.GetAppKeywordMarkFromKeywords(e);return"primaguide$"==(null===t||void 0===t?void 0:t.toLowerCase())?GetLangRes("AppType_lblPrimaGuideTitle","PrimaGuide"):null}GetPackageMessage(e){let t=this.GetAppKeywordMarkFromKeywords(e);return"primaguide$"==(null===t||void 0===t?void 0:t.toLowerCase())?GetLangRes("AppType_lblPrimaGuideMessage","Download PrimaGuide, its free!"):null}GetPackageForAndroid(e){let t=this.GetAppKeywordMarkFromKeywords(e);return"primaguide$"==(null===t||void 0===t?void 0:t.toLowerCase())?"sk.swizzbits.primaguide.app":null}GetPackageForIos(e){let t=this.GetAppKeywordMarkFromKeywords(e);return"primaguide$"==(null===t||void 0===t?void 0:t.toLowerCase())?"6444717857":null}GetAppKeywordMarkFromKeywords(e){return null==e?void 0:e.find(e=>0<e.indexOf("$"))}}window.MAX_DATE_TIME_TICKS="3155378975999999999",ko.bindingHandlers.modal={init:(e,t)=>{jQuery(e).modal();var s=t();"function"==typeof s&&jQuery(e).on("hide.bs.modal",()=>{s(!1)}),ko.utils.domNodeDisposal.addDisposeCallback(e,()=>{jQuery(e).modal("hide")})},update:(e,t)=>{t=t();ko.utils.unwrapObservable(t)?jQuery(e).modal("show"):jQuery(e).modal("hide")}},ko.bindingHandlers.enterkey={init:(t,e,s,a)=>{var o=e();jQuery(t).on("keypress",e=>{return 13!==(e.which||e.keyCode)||(jQuery(t).trigger("blur"),o.call(a),!1)})}},ko.bindingHandlers.bsChecked={init:(e,t,s,a,o)=>{var i=t(),n=null;s.has("checkedValue")?n=ko.utils.unwrapObservable(s.get("checkedValue")):s.has("value")&&(n=ko.utils.unwrapObservable(s.get("value")));ko.bindingHandlers.event.init(e,()=>({change:()=>{i(n)}}),s,a,o)},update:(e,t,s,a,o)=>{jQuery(e).val()==ko.unwrap(t())&&setTimeout(()=>{jQuery(e).closest(".btn").button("toggle")},10)}},ko.bindingHandlers.fancyboxAttr={update:(e,t,s,a,o)=>{var t=t(),i=s.get("group")||"",n=s.get("external");s.get("disabled");s.get("disabled")||(n?(jQuery(e).attr("data-external",""),jQuery(e).attr("href",t.DetailUrl())):(jQuery(e).attr("data-fancybox",i),(n=s.get("fancyboxType"))&&jQuery(e).attr("data-type",n),jQuery(e).attr("data-src")||jQuery(e).attr("data-src",t.PreviewUrl())))}},ko.bindingHandlers.dateTimePicker={init:function(e,s,t){var t=t().dateTimePickerOptions||{},a=ko.utils.unwrapObservable(s());a&&(t.date=a),jQuery(e).datetimepicker(t),ko.utils.registerEventHandler(e,"change.datetimepicker",function(e){var t=s();ko.isObservable(t)&&t(e.date||e.target.value||null)}),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){jQuery(e).datetimepicker("destroy")})},update:function(e,t){t=ko.utils.unwrapObservable(t());jQuery(e).datetimepicker&&jQuery(e).datetimepicker("date",t)}},ko.extenders.numeric=(o,i)=>{var e=ko.computed({read:o,write:function(e){var t=o(),s=Math.pow(10,i),a=isNaN(e)?0:+e,a=Math.round(a*s)/s;a!==t?o(a):e!==t&&o.notifySubscribers(a)}});return e(o()),e};class CommunityDetailViewModel extends BaseViewModel{constructor(e,t){super(),this.MembersPageUrl="/Community/Page_Members",this.Members=ko.observableArray(),this.MembersPageSize=gnSettings.CommunityMembersPageSize,this.MembersLastJoinTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreMembers=ko.observable(!0),this.MembersRequestActive=ko.observable(!1),this.NewsCurrentPage=ko.observable(0),this.MembersRequestActive.subscribe(e=>{ShowPreviewPageLoad(e)}),this.TagName=e.TagName,this.NoseDto=new NoseDto({LoginName:e.CreatorLoginName}),this.Entity=new CommunityDto(e,t)}DisplayName(){return this.Entity.DisplayName()}PageNews(){this.NewsCurrentPage(this.NewsCurrentPage()+1)}OnAddMembers(e){}AddMembers(e){if(null!=e){if(0<e.length){for(var t in this.MembersLastJoinTicks=e[e.length-1].JoinTicks,e){t=new CommunityMemberDto(e[t]);t.IsAdmin=t.LoginName==this.Entity.CreatorLoginName()||this.Entity.Admins()&&-1!=jQuery.inArray(t.LoginName,this.Entity.Admins()),this.Members.push(t)}e.length%this.MembersPageSize!=0&&this.HasMoreMembers(!1)}else this.HasMoreMembers(!1);this.OnAddMembers&&this.OnAddMembers(e)}}PageMembers(){!this.MembersRequestActive()&&this.HasMoreMembers()&&(this.MembersRequestActive(!0),jQuery.ajax({type:"POST",url:this.MembersPageUrl,cache:!1,data:{lastKnownTicks:this.MembersLastJoinTicks,profileTag:this.TagName,pageSize:this.MembersPageSize},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddMembers(e):this.HasMoreMembers(!1),this.MembersRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.MembersRequestActive(!1)}}))}}class AppTypeComponent extends BaseComponentsViewModel{constructor(e){var t;super(e&&e.imagePath||null),this.Keywords=ko.observableArray(null!=(t=null==e?void 0:e.keywords)?t:[]),this.PackageTitle=ko.observable(this.GetPackageTitle(null==e?void 0:e.keywords)),this.PackageMessage=ko.observable(this.GetPackageMessage(null==e?void 0:e.keywords)),this.PackageForIos=ko.observable(this.GetPackageForIos(null==e?void 0:e.keywords)),this.PackageForAndroid=ko.observable(this.GetPackageForAndroid(null==e?void 0:e.keywords))}}ko.components.register("ma-gpsnose-apptype",{viewModel:{createViewModel:(e,t)=>new AppTypeComponent(e)},template:'<li class="list-group-item p-2" class="row" data-bind="if: PackageForIos || PackageForAndroid"><h3 class="text-center" data-bind="text: PackageTitle()"></h3><p class="text-center" data-bind="text: PackageMessage()"></p><div class="row"><div class="col-6"><div class="text-right text-end"><a data-bind="attr: { href: `https://itunes.apple.com/us/app/id` + PackageForIos() }" data-external role="button"><img height="40" alt="App Store" data-bind="attr: { src: ImagePath() + \'/badge_app_store.png\' }"></a></div></div><div class="col-6"><div class="text-left text-start"><a data-bind="attr: { href: `https://play.google.com/store/apps/details?id=` + PackageForAndroid() }" data-external role="button"><img height="40" alt="Google Play" data-bind="attr: { src: ImagePath() + \'/badge_google_play.png\' }"></a></div></div></div></li>'});class CarouselViewModel extends BaseComponentsViewModel{constructor(e){if(super(e&&e.imagePath||null),this.IsHidden=ko.observable(!1),this.HasCarousel=ko.observable(!1),this.Slides=ko.observableArray(),this.IsHidden(e&&e.isHidden),this.HasCarousel(e&&e.hasCarousel),this.Slides.push(new CarouselItemDto(GetLangRes("Shared_HomePageCarouselView0_Title",""),GetLangRes("Shared_HomePageCarouselView0_Text",""))),this.HasCarousel()){var t,s=[{title:GetLangRes("Shared_HomePageCarouselView1_Title",""),text:GetLangRes("Shared_HomePageCarouselView1_Text","")},{title:GetLangRes("Shared_HomePageCarouselView2_Title",""),text:GetLangRes("Shared_HomePageCarouselView2_Text","")},{title:GetLangRes("Shared_HomePageCarouselView3_Title",""),text:GetLangRes("Shared_HomePageCarouselView3_Text","")},{title:GetLangRes("Shared_HomePageCarouselView4_Title",""),text:GetLangRes("Shared_HomePageCarouselView4_Text","")},{title:GetLangRes("Shared_HomePageCarouselView5_Title",""),text:GetLangRes("Shared_HomePageCarouselView5_Text","")},{title:GetLangRes("Shared_HomePageCarouselView6_Title",""),text:GetLangRes("Shared_HomePageCarouselView6_Text","")},{title:GetLangRes("Shared_HomePageCarouselView7_Title",""),text:GetLangRes("Shared_HomePageCarouselView7_Text","")},{title:GetLangRes("Shared_HomePageCarouselView8_Title",""),text:GetLangRes("Shared_HomePageCarouselView8_Text","")}];for(t in s){var a=s[t];this.Slides.push(new CarouselItemDto(a.title,a.text))}}}}ko.components.register("ma-gpsnose-carousel",{viewModel:{createViewModel:(e,t)=>new CarouselViewModel(e)},template:`
<header class="header-carousel" data-bind="visible: ! IsHidden()">
    <div id="carousel1" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="10000" data-bs-keyboard="true">
        <div class="carousel-indicators" data-bind="foreach: Slides, visible: Slides().length > 1">
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bind="attr: { 'data-bs-slide-to': $index() }, css: { active: $index() == 0 }"></button>
        </div>
        <div class="carousel-inner" data-bind="foreach: Slides">
            <div class="carousel-item" data-bind="css: { active: $index() == 0 }">
                <img data-bind="attr: { src: $parent.ImagePath() + '/bg' + $index() + '.png', atr: Text }">
                <div class="container2">
                    <div class="carousel-caption d-flex flex-column justify-content-center">
                        <div class="d-flex">
                            <div class="me-3">
                                <img class="intropage"data-bind="attr: { src: $parent.ImagePath() + '/fg' + $index() + '.png', atr: Text }">
                            </div>
                            <div class="flx-grow-1 d-flex flex-column justify-content-center">
                                <h2 data-bind="text: Title"></h2>
                                <p data-bind="text: Text" class="d-none d-lg-block m-0"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carousel1" data-bs-slide="prev" data-bind="visible: Slides().length > 1">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carousel1" data-bs-slide="next" data-bind="visible: Slides().length > 1">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</header>`});class CommentsViewModel extends BaseComponentsViewModel{constructor(e){super(e&&e.imagePath||null),this.CommentPageUrl="/Comment/Page_Comment",this.CommentSaveUrl="/WebApi/SaveComment",this.Comments=ko.observableArray(),this.CommentsPageSize=gnSettings.CommentsPageSize,this.CommentsLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreComments=ko.observable(!0),this.CommentsRequestActive=ko.observable(!1),this.LoginName=ko.observable(""),this.IsActivated=ko.observable(!1),this.IsAddAllowed=ko.observable(!1),this.IsReadonly=ko.observable(!1),this.IsLoggedIn=ko.observable(!1),this.CommentAddText=ko.observable(""),this.CommentAddMood=ko.observable(""),this.CommentEditText=ko.observable(""),this.CommentEditMood=ko.observable(""),this.SaveCommentRequestActive=ko.observable(!1),this.UniqueKey=e&&e.uniqueKey||"",this.HideTitle=e&&e.hideTitle||!1,e&&e.commentPageUrl&&(this.CommentPageUrl=e.commentPageUrl),e&&e.commentSaveUrl&&(this.CommentSaveUrl=e.commentSaveUrl),e&&e.loginUrl&&(this.LoginUrl=e.loginUrl),e&&e.onChangeComments&&(this.OnChangeComments=e.onChangeComments),e&&e.loginName&&this.LoginName(e.loginName),e&&e.isActivated&&this.IsActivated(e.isActivated),e&&e.entity&&(this.Entity=e.entity,this.ItemType=this.Entity.CommentItemType,this.IsAddAllowed(this.Entity.IsCommentsAllowed())),e&&e.isReadonly&&this.IsReadonly(e.isReadonly),this.IsLoggedIn(0<this.LoginName().length),this.Moods=ko.observableArray(["ðŸ˜Š","ðŸ˜","â¤","ðŸ’¤","ðŸ˜±","ðŸ˜”","ðŸ˜­","ðŸ˜ "]),this.CommentAddMood.subscribe(e=>{0<e.length&&(0<this.CommentAddText().length?(this.CommentAddText(this.CommentAddText().trim()+"  "+e),this.CommentAddMood("")):this.AddComment())}),e&&e.comments&&0<e.comments.length?this.AddComments(e.comments):e&&e.comments?this.HasMoreComments(!1):this.PageComments()}OnChangeComments(e){}AddComments(e){if(null!=e){if(0<e.length){for(var t in this.CommentsLastKnownTicks=e[e.length-1].CreationTicks,e)this.Comments.push(new CommentDto(e[t]));e.length%this.CommentsPageSize!=0&&this.HasMoreComments(!1)}else this.HasMoreComments(!1);this.OnChangeComments&&this.OnChangeComments(jQuery("#commentsContainer"))}}PageComments(){!this.CommentsRequestActive()&&this.HasMoreComments()&&(this.CommentsRequestActive(!0),jQuery.ajax({type:"POST",url:this.CommentPageUrl,cache:!1,data:{lastKnownTicks:this.CommentsLastKnownTicks,uniqueKey:this.UniqueKey,pageSize:this.CommentsPageSize,itemType:this.ItemType},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddComments(e):this.HasMoreComments(!1),this.CommentsRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.CommentsRequestActive(!1)}}))}AddComment(){var e;0==this.CommentAddText().length&&0==this.CommentAddMood().length?dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Comment_lblErrorTextRequired","Text is required!"),null):(e=new CommentDto({Creator:this.LoginName(),Text:this.CommentAddText(),Mood:this.CommentAddMood(),CreationTicks:GetTicksFromDate(new Date)}),this.SaveComment(e,!1,()=>{this.CommentAddText(""),this.CommentAddMood("")}))}LongComment(){jQuery(document).off("gn.dialog.show").on("gn.dialog.show",()=>{setTimeout(()=>{jQuery("#CommentLongField").trigger("select")},500)}),dialog.Show(GetLangRes("Common_lblCommentAdd","Add comment"),'<textarea id="CommentLongField" rows="4" cols="50" maxlength="5000" type="text" class="form-control" placeholder="'+GetLangRes("Common_lblCommentAddHint","Write comment")+'">'+this.CommentAddText()+"</textarea>",()=>{var e=String(jQuery("#CommentLongField").val());e&&0<e.length?(e=new CommentDto({Creator:this.LoginName(),Text:e,CreationTicks:GetTicksFromDate(new Date)}),this.SaveComment(e,!1,()=>{dialog.Hide(),this.CommentAddText(""),this.CommentAddMood(""),jQuery("#CommentLongField").val("");var e=this.Comments();this.Comments([]),this.Comments(e),this.OnChangeComments&&this.OnChangeComments(jQuery("#commentsContainer"))})):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Comment_lblErrorTextRequired","Text is required!"),null)})}EditComment(t){jQuery(document).off("gn.dialog.show").on("gn.dialog.show",()=>{setTimeout(()=>{jQuery("#CommentEditField").trigger("select")},500)}),dialog.Show(GetLangRes("Common_lblCommentEdit","Edit comment"),'<textarea id="CommentEditField" rows="4" cols="50" maxlength="5000" type="text" class="form-control" placeholder="'+GetLangRes("Common_lblCommentEditHint","Remove comment")+'">'+t.Text+"</textarea>",()=>{var e=String(jQuery("#CommentEditField").val());e&&0<e.length?(t.Text=e,this.SaveComment(t,!0,()=>{dialog.Hide();var e=this.Comments();this.Comments([]),this.Comments(e),this.OnChangeComments&&this.OnChangeComments(jQuery("#commentsContainer"))})):this.DeleteComment(t)})}DeleteComment(e){dialog.ShowDestructive(GetLangRes("Common_lblAreYouSureTitle","Are you sure?"),GetLangRes("Common_lblAreYouSureMessage","This can not be undone, proceed anyway?"),()=>{e.Text=null,e.Mood=null,this.SaveComment(e,!0,()=>{this.Comments.remove(e)}),dialog.Hide()})}SaveComment(t,e,s){this.SaveCommentRequestActive()||(this.SaveCommentRequestActive(!0),jQuery.ajax({type:"POST",url:this.CommentSaveUrl,cache:!1,data:{uniqueKey:this.UniqueKey,text:t.Text,mood:t.Mood,itemType:this.ItemType,creationTicks:t.CreationTicks,isUpdate:e},dataType:"json",success:e=>{e&&0<e.ErrorCode?dialog.Show(GetLangRes("Common_lblError","Error"),e.Message,null):(e&&"string"==typeof e&&e.match(/^-{0,1}\d+$/)&&(t.CreationTicks=e),e=ko.utils.arrayFirst(this.Comments(),function(e){return t.CreationTicks===e.CreationTicks}),null==t.Text&&null===t.Mood&&e?(this.Comments.remove(e),this.OnChangeComments&&this.OnChangeComments(jQuery("#commentsContainer"))):e?(e.Text=t.Text,e.Mood=t.Mood):(this.Comments.splice(0,0,t),this.OnChangeComments&&this.OnChangeComments(jQuery("#commentsContainer"))),s&&s()),this.SaveCommentRequestActive(!1)},error:()=>{dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Comment_lblErrorCannotSave","The comment could not be saved!"),null),this.SaveCommentRequestActive(!1)}}))}}ko.components.register("ma-gpsnose-comments",{viewModel:{createViewModel:(e,t)=>new CommentsViewModel(e)},template:'<div id="commentsContainer"><h3 data-bind="text: GetLangRes(\'Common_lblComments\', \'Comments\'), visible: ! HideTitle"></h3><div data-bind="if: IsAddAllowed() && IsLoggedIn() && ! IsActivated() && ! IsReadonly()"><div class="alert alert-info"><i class="glyphicon glyphicon-info-sign fas fa-info-circle"></i><span data-bind="text: \' \' + GetLangRes(\'Comment_lblActivationRequired\', \'To add comments, it is required to validate your account, please validate your account in the GpsNose-App!\')"></span></div></div><div data-bind="if: IsAddAllowed() && ! IsLoggedIn() && ! IsReadonly()"><div class="alert alert-info"><i class="glyphicon glyphicon-info-sign fas fa-info-circle"></i><span data-bind="text: \' \' + GetLangRes(\'Community_loginRequired\', \'Login first to interact\')"></span><button type="button" class="btn btn-info btn-sm pull-right float-right float-end" data-bind="click: function() { document.location.href = $data.GetLoginUrl($data.LoginUrl); }"><i class="glyphicon glyphicon-user fas fa-user"></i><span data-bind="text: \' \' + GetLangRes(\'Common_btnLogin\', \'Login\')"></span></button></div></div><div data-bind="if: IsAddAllowed() && IsLoggedIn() && IsActivated() && ! IsReadonly()"><form onsubmit="AddComment()"><div class="form-group mb-3"><div class="input-group"><div class="input-group-btn input-group-prepend"><div class="btn btn-default btn-outline-secondary" type="button" style="letter-spacing:-2px;" data-fancybox data-src="#moods-dialog" data-bind="attr: { \'data-remove\': MA_GPSNOSE_IS_MASHUP }">&#x1F60A;&#x1F601;&#x1F631;&#x1F614;</div><button type="button" class="btn btn-default btn-outline-secondary" data-bind="click: function() { LongComment() }"><i class="glyphicon glyphicon-align-left fas fa-align-left"></i> </button></div><input type="text" maxlength="1000" class="form-control" data-bind="textInput: CommentAddText, attr: { \'placeholder\': GetLangRes(\'Common_lblCommentAddHint\', \'Write comment\') }" /><div class="input-group-btn input-group-append"><button class="btn btn-primary" type="submit" data-bind="attr: { \'disabled\': SaveCommentRequestActive() }, click: function(){ AddComment() }"><i class="glyphicon glyphicon-comment fas fa-comment-alt" data-bind="visible: ! SaveCommentRequestActive()"></i> <i class="glyphicon glyphicon-repeat gly-spin fas fa-redo-alt" data-bind="visible: SaveCommentRequestActive()"></i> <span data-bind="text: GetLangRes(\'Common_btnSend\', \'Send\')"></span></button></div></div></div></form><div id="moods-dialog" data-bind="foreach: Moods" style="display:none;" class="moods-dialog"><div class="btn btn-default btn-outline-secondary p-1" data-bind="text: $data, click: function() { if (jQuery().fancybox) jQuery.fancybox.close(true); $parent.CommentAddMood($data); }"></div></div></div><div data-bind="if: Comments().length == 0"><div class="alert alert-info" data-bind="text: GetLangRes(\'Common_lblNoCommentsAvailable\', \'Currently there are no comments available for this item.\')"></div></div><div class="comments" data-bind="if: Comments().length > 0"><div class="masonry row" data-bind="foreach: Comments.sort(function (l, r) { return l.CreationTicks < r.CreationTicks ? 1 : -1 })">\x3c!-- ko if: ($index() === 0) --\x3e<div class="masonry-sizer col-md-4 col-sm-6"></div>\x3c!-- /ko --\x3e<div class="masonry-item col-md-4 col-sm-6"><div class="outer shadow-sm"><div class="media d-flex mb-2"><div class="media-left mr-2 me-2"><img class="media-object img-circle rounded-circle" width="32px" data-bind="attr: { src: $data.NoseDto.ImageUrl() + \'@200\', onerror: \'ImageErrorHandler(this, \\\'\' + $parent.ImagePath() + \'/EmptyUser.png\\\')\' }" /></div><div class="media-body middle flex-grow-1" data-bind="text: $data.Creator"></div><div class="media-body middle flex-grow-1 mood" data-bind="text: $data.Mood"></div><div class="media-right middle" data-bind="text: GetAgeStringFromTicks($data.CreationTicks)"></div></div><div data-bind="html: $parent.GetHtmlFromString($data.Text), visible: HasText(), css: ($data.Text && $data.Text.length > 20 ? \'text\' : \'text-big\')"></div><div class="clearfix" data-bind="if: ! $parent.IsReadonly()"><img class="ma-crown" data-bind="attr: { src: $parent.ImagePath() + \'/IcActionCrown.png\' }, visible: $parent.Entity.IsUserAdmin($data.Creator)" /><div class="btn-group btn-group-sm pull-right float-right float-end" role="group" aria-label="share"><a class="btn btn-default btn-outline-secondary" data-popup data-bind="attr: { href: $data.NoseDto.DetailUrl(), title: GetLangRes(\'Common_btnShowProfile\', \'Show profile\') }"><i class="glyphicon glyphicon-user fas fa-user"></i><span data-bind="text: \' \' + GetLangRes(\'Common_btnShowProfile\', \'Show profile\')"></span></a><div class="btn btn-default btn-outline-secondary" data-bind="visible: $data.HasText(), click: function() { if (! $parent.SaveCommentRequestActive()) { if (jQuery().fancybox) jQuery.fancybox.close(true); $parent.EditComment($data); } }, attr: { \'disabled\': $parent.SaveCommentRequestActive(), \'data-remove\': $parent.LoginName() != $data.Creator, title: GetLangRes(\'Common_btnEdit\', \'Edit\') }"><i class="glyphicon glyphicon-edit fas fa-edit"></i><span data-bind="text: \' \' + GetLangRes(\'Common_btnEdit\', \'Edit\')"></span></div><div class="btn btn-danger" data-bind="click: function() { if (! $parent.SaveCommentRequestActive()) $parent.DeleteComment($data); }, attr: { \'disabled\': $parent.SaveCommentRequestActive(), \'data-remove\': $parent.LoginName() != $data.Creator, title: GetLangRes(\'Common_btnDelete\', \'Delete\') }"><i class="glyphicon glyphicon-remove fas fa-times"></i></div></div></div></div></div></div></div><div class="text-center" data-bind="if: ! IsReadonly()"><div class="btn btn-default btn-outline-secondary btn-lg" data-bind="click: function(){ PageComments() }, visible: HasMoreComments(), attr: { disabled: CommentsRequestActive() }"><div data-bind="visible: ! CommentsRequestActive(), click: function () { PageComments(); }"><i class="glyphicon glyphicon-cloud-download fas fa-cloud-download-alt"></i><span data-bind="text: \' \' + GetLangRes(\'Common_lblLoadMore\', \'more..\')"></span></div><div data-bind="visible: CommentsRequestActive()"><i class="glyphicon glyphicon-repeat gly-spin fas fa-redo-alt"></i>'+"<span data-bind=\"text: ' ' + GetLangRes('Common_lblRequestInProgress', 'Request in progress')\"></span></div></div></div></div>"});class DialogViewModel{constructor(){this.Title=ko.observable(""),this.Message=ko.observable(""),this.IsDestructive=ko.observable(!1),this.OkCallback=null,this.OkClicked=ko.observable(!1),this.HasOkCallback=ko.observable(!1),this.ShowDialog=ko.observable(!1)}Show(e,t,s){this.Title(e),this.Message(t),this.IsDestructive(!1),this.OkCallback=s,this.HasOkCallback(null!=s),this.ShowDialog(0<e.length||0<t.length),this.OkClicked(!1),jQuery(document).trigger("gn.dialog.show")}ShowDestructive(e,t,s){this.Title(e),this.Message(t),this.IsDestructive(!0),this.OkCallback=s,this.HasOkCallback(null!=s),this.ShowDialog(0<e.length||0<t.length),this.OkClicked(!1),jQuery(document).trigger("gn.dialog.show")}Hide(){this.ShowDialog(!1),jQuery(document).trigger("gn.dialog.hide")}ClickOkButton(){this.OkClicked(!0),this.OkCallback&&this.OkCallback(),jQuery(document).trigger("gn.dialog.click.ok")}HasTitle(){return null!=this.Title()||0<this.Title().length}JoinCommunity(e,t,s){this.OkClicked(!1);var a=new KeywordDto(e);a.IsCommunity&&(a=GetLangRes("Common_lblJoinCommunityAreYouSure","Would you like to join the community %community%?").replace("%community%",a.GetHtml()),dialog.Show(GetLangRes("Common_lblJoinTitle","Join a community"),a,()=>{jQuery.ajax({type:"POST",url:"/WebApi/JoinCommunity",cache:!1,data:{tag:e},dataType:"json",success:e=>{e&&0==e.ErrorCode?(dialog.Hide(),s&&s()):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_loginRequired","Please login first."),null)},error:()=>{dialog.Show(GetLangRes("Common_lblError","Error"),"",null)}})}))}LeaveCommunity(e,t,s){this.OkClicked(!1);var a=new KeywordDto(e);a.IsCommunity&&(a=GetLangRes("Common_lblLeaveCommunityAreYouSure","Would you like to leave the community %community%?").replace("%community%",a.GetHtml()),dialog.ShowDestructive(GetLangRes("Common_lblLeaveTitle","Leave community"),a,()=>{jQuery.ajax({type:"POST",url:"/WebApi/LeaveCommunity",cache:!1,data:{tag:e},dataType:"json",success:e=>{e&&0==e.ErrorCode?(dialog.Hide(),s&&s()):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_loginRequired","Please login first."),null)},error:()=>{dialog.Show(GetLangRes("Common_lblError","Error"),"",null)}})}))}}var GroupTypeEnum,CoordinateTypeEnum,CommentItemType,CommunityAcl,NewsType,dialog=new DialogViewModel;ko.components.register("ma-gpsnose-dialog",{viewModel:{instance:dialog},template:'<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="dialogModalLabel" data-show="false" data-bind="modal: ShowDialog"><div class="modal-dialog" role="document"><form data-bind="submit: function(){ ClickOkButton() }"><div class="modal-content"><div class="modal-header" data-bind="visible: Title().length > 0"><button type="button" class="close d-none" data-dismiss="modal" data-bind="attr: { \'aria-label\': GetLangRes(\'Common_btnClose\', \'Close\') }"><span>&times;</span></button><h4 class="modal-title" data-bind="text: $data.Title"></h4><button type="button" class="close btn-close hidden" data-dismiss="modal" data-bs-dismiss="modal" data-bind="attr: { \'aria-label\': GetLangRes(\'Common_btnClose\', \'Close\') }"><span class="visually-hidden">&times;</span></button></div><div class="modal-body"><span data-bind="html: Message"></span></div><div class="modal-footer"><button type="button" class="btn btn-default btn-outline-secondary" data-dismiss="modal" data-bs-dismiss="modal"><i class="glyphicon glyphicon-remove fas fa-times"></i><span data-bind="text: \' \' + GetLangRes(\'Common_btnClose\', \'Close\')"></span></button><button type="button" class="btn" data-bind="visible: HasOkCallback(), click: function(){ ClickOkButton() }, attr: { \'disabled\': OkClicked() }, css: { \'btn-danger\': IsDestructive(), \'btn-primary\': !IsDestructive() }"><i class="glyphicon glyphicon-ok fas fa-check"></i>'+"<span data-bind=\"text: ' ' + GetLangRes('Common_btnOk', 'OK')\"></span></button></div></div></form></div></div>"});class FooterViewModel extends BaseComponentsViewModel{constructor(e){super(e&&e.imagePath||null),this.IsHidden=ko.observable(e&&e.isHidden);var t=new Date;this.Copyright="&copy; "+t.getFullYear()+" "+GetLangRes("Common_lblCompanyName","SwizzBits s.r.o."),this.HideCopyright=ko.observable(e&&e.hideCopyright),this.HideSupportMail=ko.observable(e&&e.hideSupportMail)}}ko.components.register("ma-gpsnose-footer",{viewModel:{createViewModel:(e,t)=>new FooterViewModel(e)},template:`
<div class="footer mt-auto shadow-lg" data-bind="ifnot: IsHidden()">
    <div class="container d-lg-none">
        <div class="row my-2">
            <div class="col-6">
                <div class="text-end gn-badge">
                    <a href="#" data-external role="button" data-bind="attr: { 'href': AppleLink }">
                        <img data-bind="attr: { src: ImagePath() + '/badge_app_store.svg' }" alt="App Store">
                    </a>
                </div>
            </div>
            <div class="col-6">
                <div class="text-start gn-badge">
                    <a href="#" data-external role="button" data-bind="attr: { 'href': GoogleLink }">
                        <img data-bind="attr: { src: ImagePath() + '/badge_google_play.svg' }" alt="Google Play">
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="container d-none d-lg-block">
        <div class="row">
            <div class="col-4 gn-preview" data-aos="fade-right">
                <img src="/Content/images/screenshot_gn1.png" alt="GpsNose Screenshot">
            </div>
            <div class="col-8 d-flex flex-column">
                <div class="text-center mt-3">
                    <h2 class="mt-4 mb-0" data-bind="text: GetLangRes('Common_lblFooterTitle')"></h2>
                    <p class="m-0" data-bind="text: GetLangRes('Common_lblFooterMessage')"></p>
                </div>
                <div class="row flex-grow-1">
                    <div class="col-6 d-flex align-items-center">
                        <div class="text-end w-100 gn-badge" data-aos="fade-right" data-aos-delay="300" data-aos-offset="1">
                            <a href="#" data-external role="button" data-bind="attr: { 'href': AppleLink }">
                                <img data-bind="attr: { src: ImagePath() + '/badge_app_store.svg' }" alt="App Store">
                            </a>
                        </div>
                    </div>
                    <div class="col-6 d-flex align-items-center">
                        <div class="text-start w-100 gn-badge" data-aos="fade-left" data-aos-delay="300" data-aos-offset="1">
                            <a href="#" data-external role="button" data-bind="attr: { 'href': GoogleLink }">
                                <img data-bind="attr: { src: ImagePath() + '/badge_google_play.svg' }" alt="Google Play">
                            </a>
                        </div>
                    </div>
                </div>
                <div data-bind="if: ! HideCopyright()" class="flex-">
                    <footer>
                        <p class="text-center" data-bind="html: Copyright"></p>
                    </footer>
                </div>
            </div>
        </div>
    </div>
</div>`});class KeepAliveViewModel{constructor(e){this.IsLoggedIn=ko.observable(!0);var t=600;null!=e&&0<=e.interval&&(t=Math.max(60,e.interval)),this.StartInterval(t)}IsStillLoggedIn(t){jQuery.ajax({type:"POST",url:"/Login/IsStillLoggedIn",cache:!1,data:JSON.stringify({}),dataType:"json",contentType:"application/json",success:e=>{null!=t&&t(e)},error:function(){null!=t&&t(!1)}})}StartInterval(e){var t=this;setInterval(function(){t.IsStillLoggedIn(e=>{t.IsLoggedIn(e)})},1e3*e)}}ko.components.register("ma-gpsnose-keepalive",{viewModel:{createViewModel:(e,t)=>new KeepAliveViewModel(e)},template:'<div data-bind="if: ! IsLoggedIn()"><div class="alert alert-danger"><i class="glyphicon glyphicon-info-sign fas fa-info-circle"></i><span data-bind="text: \' \' + GetLangRes(\'Common_lblLoggedOut\', \'You have been logged out. To continue with your work, you have to sign in again.\')"></span><button type="button" class="btn btn-danger btn-sm pull-right float-right float-end" data-bind="click: function() { location.reload(); }"><i class="glyphicon glyphicon-user fas fa-user"></i>'+"<span data-bind=\"text: ' ' + GetLangRes('Common_btnLogin', 'Login')\"></span></button></div></div>"});class KeywordsViewModel{constructor(e){this.Keywords=ko.observableArray(),this.SelectedKeywords=ko.observableArray(),this.NewKeyword=ko.observable(""),this.OnSelectionChange=e&&e.onSelectionChange||null,this.OnKeywordFieldChange=e&&e.onKeywordFieldChange||null,this.SearchClasses=e&&e.searchClasses||"input-group col-lg-3 col-md-6",this.IsEditable=ko.observable(e&&e.isEditable||!1),e&&ko.isObservable(e.isRequired)?this.IsRequired=e.isRequired:this.IsRequired=ko.observable(!0),this.NoEntryLabel=ko.observable(e&&e.noEntryLabel||null),this.SelectedKeywords.subscribe(e=>{this.OnSelectionChange&&this.OnSelectionChange(this.SelectedKeywords())}),this.NewKeyword.subscribe(e=>{this.OnKeywordFieldChange&&this.OnKeywordFieldChange(e)}),this.AddKeywords(e&&e.keywords||[],!1),e&&e.keywordString&&this.AddKeywords(e.keywordString.split(";"),!1),ko.utils.arrayForEach(e&&e.selectedKeywords||[],e=>{this.SelectedKeywords.push(e)})}OnSelectionChange(e){}OnKeywordFieldChange(e){}AddKeywords(e,o){ko.utils.arrayForEach(e,t=>{var s,e,a=!0;ko.utils.arrayForEach(this.Keywords()||[],e=>{t==e.Name()&&(a=!1)}),a&&-1==t.indexOf("$")&&(s=o,ko.utils.arrayForEach(this.SelectedKeywords(),e=>{e==t&&(s=!0)}),e=new KeywordDto(t.toLowerCase()),this.Keywords.push(e),e.IsSelected.subscribe(e=>{this.SelectedKeywords.removeAll(),ko.utils.arrayForEach(this.Keywords()||[],e=>{e.IsSelected()&&this.SelectedKeywords.push(e.Name())})}),e.IsSelected(s))})}AddKeyword(){var e,t,s;0<this.NewKeyword().length&&(e=this.NewKeyword().replace(/[^a-zA-Z0-9Ã€-Ã¿\ \.\-_]/gi,""),t=[],s=0,ko.utils.arrayForEach(e.split(" "),e=>{e&&0<e.length&&(t[s]=e,s++)}),0<t.length?(this.AddKeywords(t,!0),this.NewKeyword("")):dialog.Show("",GetLangRes("Common_lblCharsNotAllowed","To add a keyword you have to enter a valid character"),null))}}ko.components.register("ma-gpsnose-keywords",{viewModel:{createViewModel:(e,t)=>new KeywordsViewModel(e)},template:'<div class="keywords"><div data-bind="if: IsEditable()"><div data-bind="attr : { \'class\': SearchClasses }"><input type="text" name="NewKeyword" class="form-control" data-bind="textInput: NewKeyword, attr: { placeholder: GetLangRes(\'Common_lblAddKeyword\', \'Add new keyword...\') }, enterkey: AddKeyword, event: { blur: AddKeyword }, css: { \'is-invalid\': IsRequired() && SelectedKeywords().length == 0 }" /><span class="input-group-btn"><div class="btn btn-primary" data-bind="text: GetLangRes(\'Common_btnAdd\', \'Add\'), click: AddKeyword"></div></span></div><div data-bind="foreach: SelectedKeywords"><input type="hidden" name="Keywords[]" data-bind="value: $data" /></div></div><div class="alert alert-info" data-bind="visible: Keywords().length == 0 && NoEntryLabel()"><i class="glyphicon glyphicon-info-sign fas fa-info-circle"></i><span data-bind="html: \' \' + NoEntryLabel()"></span></div><div data-bind="foreach: Keywords"><a href="javascript:void(0);" data-type="ajax" data-bind="attr: { \'data-external\': MA_GPSNOSE_IS_MASHUP ? true : null, \'data-src\': (IsCommunity() && ! $parent.IsEditable() && ! MA_GPSNOSE_IS_MASHUP) ? Community.PreviewUrl() : null, \'data-fancybox\': (IsCommunity() && ! $parent.IsEditable() && ! MA_GPSNOSE_IS_MASHUP) ? \'community\' : null }, html: GetHtml(), css: { selected: IsSelected() }, click: function() { if ($parent.IsEditable()) Toggle(); else return true; }"></a></div><div class="clearfix"></div></div>'});class MoodsControlViewModel{constructor(e){this.SelectedMood=ko.observable(""),this.MoodIndex=ko.observable(e&&e.index||"0"),this.Moods=ko.observableArray(e&&e.moods||["ðŸ˜Š","ðŸ˜","ðŸ˜‚","ðŸ˜†","ðŸ˜‰","ðŸ˜‹","ðŸ˜","ðŸ˜œ","ðŸ˜ ","ðŸ˜”","ðŸ˜¥","ðŸ˜«","ðŸ˜“","ðŸ˜–","ðŸ˜·","ðŸ˜¢","ðŸ˜­","ðŸ˜±","â¤","ðŸ’”","ðŸ‘¼","ðŸ‘¿","ðŸ’€","ðŸ‘»","ðŸ‘½","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸ’©","ðŸ’£","ðŸ”¥","ðŸ’¤","ðŸ¶","ðŸ±","ðŸŽ","ðŸ­","ðŸ§","ðŸŸ","ðŸŒ","ðŸŽ ","ðŸŽ¢","ðŸŽª","ðŸŽ­","ðŸŽ¼","ðŸŽ¨","ðŸŒ¹","ðŸŒ¼","ðŸŒ´","ðŸŒµ","ðŸ‰","ðŸŽ","ðŸ”","ðŸ•","ðŸ²","ðŸª","ðŸ°","ðŸ«","ðŸ¬","ðŸ·","ðŸ¸","ðŸº","ðŸ´","ðŸšŒ","ðŸš—","ðŸš²","â›µ","âœˆ","ðŸš€","â˜€","â­","â˜","â›…","âš¡","â„","ðŸŽƒ","ðŸŽ„","ðŸŽ†","âœ¨","ðŸŽˆ","ðŸŽ‰","ðŸŽ","âš½","âš¾","ðŸ€","ðŸˆ","ðŸŽ¾","ðŸŽ±","ðŸŽ³","â›³","ðŸŽ¿","ðŸ‚","ðŸ„","ðŸŠ","ðŸŽ®"]),this.OnSelectionChange=e&&e.onSelectionChange||null,this.SelectedMood.subscribe(e=>{this.OnSelectionChange&&this.OnSelectionChange(this.SelectedMood())}),this.SelectedMood(e&&e.selectedMood||"ðŸ˜Š")}OnSelectionChange(e){}}ko.components.register("ma-gpsnose-moods-control",{viewModel:{createViewModel:(e,t)=>new MoodsControlViewModel(e)},template:'<div class="moods-control"><div class="btn btn-outline-secondary mood" data-fancybox data-bind="attr: { \'data-src\': \'#moods-dialog-\' + MoodIndex() }"><span data-bind="text: SelectedMood() + \' \'"></span><span class="caret"></span></div><input type="hidden" name="Mood" data-bind="value: SelectedMood()" /><div data-bind="foreach: Moods, attr: { \'id\': \'moods-dialog-\' + MoodIndex() }" style="display: none;" class="moods-dialog"><div class="btn btn-outline-secondary p-1" data-bind="text: $data, css: { active: $data == $parent.SelectedMood() }, click: function() { $parent.SelectedMood($data); jQuery.fancybox.close(true); }"></div></div></div>'});class NavbarViewModel extends BaseViewModel{constructor(e){super(),this.params=e,this.ImagePath=ko.observable(this.params&&this.params.imagePath||"/Content/Mashup/Images"),this.IsHidden=ko.observable(this.params&&this.params.isHidden),this.Profile=this.params&&this.params.profile||{},this.NoseDto=new NoseDto({LoginName:this.Profile.LoginName}),this.Languages=ko.observableArray(this.params&&this.params.languages||[]),this.Navigation=ko.observableArray([]),this.PokeMoods=ko.observableArray([]),this.User=new UserDto(e&&e.user||{}),this.Navigation([new NavBarDto("/",GetLangRes("Common_menuHome","Home"),"fas fa-home",/^\/$|^\/home\/?$|^\/home\/index\/?/i),new NavBarDto("/Home/Overview",GetLangRes("Common_menuOverview","Overview"),"fas fa-magnifying-glass-location",/^\/home\/overview\/?/i),new NavBarDto("/Home/ImportedKeywords",GetLangRes("Common_menuImportedKeywords","POIs"),"fas fa-hashtag",/^\/home\/importedkeywords\/?/i),new NavBarDto(this.User.LoginName?"/PhotoUploader/Index":"/Home/PhotoUploaderAbout",GetLangRes("Common_menuPhotoUploader","Upload photos"),"fas fa-camera",/^\/photouploader\/?/i),new NavBarDto("/Developer",GetLangRes("Common_menuDeveloperIndex","For developers"),"fas fa-laptop-code",/^\/developer\/?/i),new NavBarDto("/Home/About",GetLangRes("Common_menuSiteAbout","Help"),"fas fa-question-circle",/^\/home\/about\/?/i)]),this.PokeMoods=ko.observableArray(["ðŸ˜Š","ðŸ˜","ðŸ˜‚","ðŸ˜†","ðŸ˜‰","ðŸ˜‹","ðŸ˜","ðŸ˜œ","ðŸ˜ ","ðŸ˜”","ðŸ˜¥","ðŸ˜«","ðŸ˜“","ðŸ˜–","ðŸ˜·","ðŸ˜¢","ðŸ˜­","ðŸ˜±","â¤","ðŸ’”","ðŸ‘¼","ðŸ‘¿","ðŸ‘½","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸ’¤","ðŸŒ¹","ðŸŒ¼","â˜•ï¸","ðŸ·","ðŸ¸","ðŸº","ðŸ´","â­","ðŸŽ"])}OpenUrl(e){location.href=e}SendPoke(e,t){t.IsActivated?jQuery.ajax({type:"POST",url:"/WebApi/SendMail",cache:!1,data:{toLoginName:this.NoseDto.LoginName,body:e},dataType:"json",success:e=>{e&&0==e.ErrorCode?dialog.Show(GetLangRes("Common_lblSuccess","Success"),GetLangRes("Common_lblMessageSendSuccess","Message sent successfully!"),null):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)},error:()=>{dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)}}):dialog.Show(GetLangRes("Common_activationRequired","Validation required"),GetLangRes("Common_lblActivationRequired","To use this functionality, it is required to validate your account, please validate your account in the GpsNose-App!"),null)}}ko.components.register("ma-gpsnose-navbar",{viewModel:{createViewModel:(e,t)=>new NavbarViewModel(e)},template:`
<div id="navbar-sticky">
    <nav class="navbar navbar-expand-lg navbar navbar-light bg-light" data-bind="visible: ! IsHidden()">
        <div class="container">
            <a class="d-inline d-lg-none navbar-brand" href="/" data-bind="text: GetLangRes('Common_menuHome', 'Home')"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#gn-navbar-collapse-1" aria-controls="gn-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="gn-navbar-collapse-1">
                <ul class="navbar-nav">
                    <!-- ko foreach: Navigation -->
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="javascript:void(0);" data-bind="click: function() { $parent.OpenUrl(Url()) }, css: { active: IsActive() }">
                                <i class="d-lg-none" data-bind="class: Icon(), if: Icon()"></i>
                                <span data-bind="text: Text()"></span>
                            </a>
                        </li>
                    <!-- /ko -->
                    <!-- ko if: User.LoginName -->
                        <li class="nav-item dropdown ms-lg-3 mt-lg-0 mt-3">
                            <a class="nav-link dropdown-toggle p-1" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <img class="rounded-circle mr-1 me-1" width="32" data-bind="attr: { src: User.ImageUrl() + '@200', onerror: 'RemoveFancyboxForImage(this);ImageErrorHandler(this, \\'' + ImagePath() + '/EmptyUser.png\\');' }" />
                                <span data-bind="text: User.LoginName"></span>
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <li>
                                    <a class="dropdown-item" data-bind="attr: { href: '/n/' + User.LoginName }">
                                        <i class="fas fa-user-circle"></i>
                                        <span data-bind="text: GetLangRes('Common_btnShowProfile', 'Show Profile')"></span>
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item text-danger" data-bind="attr: { href: '/Account/Logout' }">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span data-bind="text: GetLangRes('Common_menuLogout', 'Logout')"></span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    <!-- /ko -->
                </ul>
                <!-- ko if: !User.LoginName -->
                    <span class="d-inline-block ms-lg-3 mt-3 mt-lg-0">
                        <a class="btn btn-outline-secondary navbar-btn" data-bind="attr: { href: GetLoginUrl(null) }">
                            <i class="fas fa-sign-in-alt me-1"></i>
                            <span data-bind="text: GetLangRes('Common_menuLogin', 'Login')"></span>
                        </a>
                    </span>
                <!-- /ko -->
                <ul class="languages navbar-nav ms-auto mt-3 mt-lg-0" data-bind="foreach: Languages">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="language" data-bind="attr: { href: 'javascript:' + (GetCurrentLang() == $data ? '' : 'SwitchLanguage(\\''+$data+'\\')') + ';' }, text: $data, css: { active: GetCurrentLang() == $data }"></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="bg-light" data-bind="if: Profile.LoginName">
        <div class="container">
            <div class="navbar-userinfo py-2" data-bind="if: Profile.LoginName">
                <div class="row">
                    <div class="col-sm-4 col-5">
                        <div class="d-flex">
                            <div class="me-2">
                                <a data-bind="attr: { href: NoseDto.ImageUrl() }" data-fancybox>
                                    <img class="media-object rounded-circle" data-bind="attr: { src: NoseDto.ImageUrl() + '@200', onerror: 'RemoveFancyboxForImage(this);ImageErrorHandler(this, \\'' + ImagePath() + '/EmptyUser.png\\');' }" />
                                </a>
                            </div>
                            <div class="text-nowrap">
                                <h5 class="m-0" data-bind="text: Profile.LoginName"></h5>
                                <div data-bind="text: Profile.FullName"></div>
                                <div data-bind="text: GetDistanceString(Profile)"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 col-2">
                        <div class="text-center">
                            <div class="btn-group-vertical btn-group-sm" role="group" aria-label="share">
                                <div class="btn btn-outline-secondary py-0" data-src="#share" data-fancybox data-bind="attr: { title: GetLangRes('Common_btnShare', 'Share') }">
                                    <i class="fas fa-qrcode"></i><span class="d-none d-sm-inline" data-bind="text: ' ' + GetLangRes('Common_btnShare', 'Share')"></span>
                                </div>
                                <div class="btn btn-outline-secondary py-0 visually-hidden" data-fancybox data-src="#poke-moods-dialog" data-bind="attr: { title: GetLangRes('Common_btnPoke', 'Knock'), 'data-remove': ! User.LoginName || Profile.LoginName == User.LoginName }, css: { 'visually-hidden': ! User.LoginName || Profile.LoginName == User.LoginName }">
                                    <i class="far fa-hand-point-left"></i><span class="d-none d-sm-inline" data-bind="text: ' ' + GetLangRes('Common_btnPoke', 'Knock')"></span>
                                </div>
                                <a class="btn btn-outline-secondary py-0 visually-hidden" data-bind="attr: { href: GetLoginUrl(null), title: GetLangRes('Common_loginToPoke', 'Login to Knock'), 'data-remove': User.LoginName }, css: { 'visually-hidden': User.LoginName }">
                                    <i class="far fa-hand-point-left"></i><span class="d-none d-sm-inline" data-bind="text: ' ' + GetLangRes('Common_loginToPoke', 'Login to Knock')"></span>
                                </a>
                                <a class="btn btn-outline-secondary py-0 visually-hidden" data-external data-bind="attr: { href: GetGoogleMapsLink(Profile.LastActivityLatitude, Profile.LastActivityLongitude), title: GetLangRes('Common_showOnMap', 'Show on map'), 'data-remove': !IsGeoValid(Profile.LastActivityLatitude, Profile.LastActivityLongitude) }, css: { 'visually-hidden': !IsGeoValid(Profile.LastActivityLatitude, Profile.LastActivityLongitude) }">
                                    <i class="fas fa-map-marker-alt"></i><span class="d-none d-sm-inline" data-bind="text: ' ' + GetLangRes('Common_showOnMap', 'Show on map')"></span>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 col-5">
                        <div class="text-end">
                            <div class="text-nowrap">
                                <h5 data-bind="text: GetLangRes('Nose_Profile_lblLastSeen', 'Last seen') + ':'"></h5>
                                <div data-bind="text: GetDateStringFromTicks(Profile.LastActivityUtcDateTime)"></div>
                                <div data-bind="ifnot: Profile.LastActivityUtcDateTime">
                                    <a data-bind="attr: { href: GetLoginUrl(null) }, text: GetLangRes('Common_loginRequired', 'Please login first.')" data-popup></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="poke-moods-dialog">
    <div id="poke-moods-dialog" data-bind="foreach: PokeMoods" style="display:none;" class="moods-dialog">
        <div class="btn btn-outline-secondary p-1" data-bind="text: $data, click: function() { jQuery.fancybox.getInstance('close'); $parent.SendPoke($data, gn_data.User || {}); }"></div>
    </div>
</div>`});class NewsComponent extends BaseComponentsViewModel{constructor(e){super(e&&e.imagePath||null),this.NewsPageUrl="/Home/Page_News",this.News=ko.observableArray(),this.NewsPageSize=gnSettings.NewsPageSize,this.NewsLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreNews=ko.observable(!0),this.NewsRequestActive=ko.observable(!1),this.CommunityTag=ko.observable(""),this.CommunityTag(e&&e.communityTag||""),this.NewsRequestActive.subscribe(e=>{ShowPreviewPageLoad(e)}),e&&e.onAddNews&&(this.OnAddNews=e.onAddNews),e&&e.newsPageUrl&&(this.NewsPageUrl=e.newsPageUrl),e&&e.page&&e.page.subscribe(()=>{this.HasMoreNews()&&this.PageNews()}),e&&e.news&&0<e.news.length?this.AddNews(e.news):e&&e.news?this.HasMoreNews(!1):this.PageNews()}OnAddNews(){}AddNews(t){if(null!=t){let e=!0;if(0<this.News.length&&(e=!1),0<t.length){for(var s in this.NewsLastKnownTicks=t[t.length-1].CreationTicks,t)this.News.push(new NewsDto(t[s]));t.length%this.NewsPageSize!=0&&this.HasMoreNews(!1)}else this.HasMoreNews(!1);this.OnAddNews&&(e?setTimeout(()=>{this.OnAddNews()},100):this.OnAddNews())}}PageNews(){!this.NewsRequestActive()&&this.HasMoreNews()&&(this.NewsRequestActive(!0),jQuery.ajax({type:"POST",url:this.NewsPageUrl,cache:!1,data:{lastKnownTicks:this.NewsLastKnownTicks,pageSize:this.NewsPageSize,community:this.CommunityTag()},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddNews(e):this.HasMoreNews(!1),this.NewsRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.NewsRequestActive(!1)}}))}}ko.components.register("ma-gpsnose-news",{viewModel:{createViewModel:(e,t)=>new NewsComponent(e)},template:`
<div id="newsContainer" class="masonry row">
    <div class="masonry-sizer col-lg-3 col-md-4 col-6"></div>
    <!-- ko foreach: News -->
    <div data-bind="template: { name: TemplateName() }"></div>
    <!-- /ko -->
</div>

<div class="text-center">
    <div class="btn btn-outline-secondary btn-lg" data-bind="click: function(){ PageNews() }, visible: HasMoreNews(), attr: { disabled: NewsRequestActive() }" data-aos="zoom-in">
        <div data-bind="visible: ! NewsRequestActive()">
            <i class="fas fa-cloud-download-alt"></i>
            <span data-bind="text: ' ' + GetLangRes('Common_lblLoadMore', 'more..')"></span>
        </div>
        <div data-bind="visible: NewsRequestActive()">
            <i class="fas fa-redo-alt gly-spin"></i>
            <span data-bind="text: ' ' + GetLangRes('Common_lblRequestInProgress', 'Request in progress')"></span>
        </div>
    </div>
</div>

<div class="alert alert-info" data-bind="visible: News().length == 0 && ! NewsRequestActive()">
    <i class="fas fa-info-circle"></i>
    <span data-bind="text: ' ' + GetLangRes('Home_Overview_lblNoNews', 'There are currently no such news in your area.')"></span>
</div>



<script type="text/html" id="UnknownTemplate">
    <div class="UnknownNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm">
            <div class="card-body p-2">
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetLangRes('Home_Overview_lblUnknownNews', 'Unknown news')"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="AboutNewsTemplate">
    <div class="AboutNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group:'news', external:MA_GPSNOSE_IS_MASHUP">
            <div class="card-body p-2">
                <div class="d-flex">
                    <div class="me-2">
                        <img class="media-object rounded-circle media-height" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
                    </div>
                    <div class="flow-grow-1">
                        <h4 data-bind="text: $data.Title"></h4>
                        <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                    </div>
                </div>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="ProfileImageNewsTemplate">
    <div class="ProfileImageNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group:'news', external:MA_GPSNOSE_IS_MASHUP">
            <div class="card-body p-2">
                <img class="image" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
                <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="NewGuestUserNewsTemplate">
    <div class="NewGuestUserNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group:'news', external:MA_GPSNOSE_IS_MASHUP">
            <div class="card-body p-2">
                <div class="d-flex">
                    <div class="me-2">
                        <img class="media-object rounded media-height" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
                    </div>
                    <div class="flow-grow-1">
                        <h4 data-bind="text: $data.Title"></h4>
                        <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                    </div>
                </div>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="ProfileActivatedTemplate">
    <div class="ProfileActivated masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group:'news', external:MA_GPSNOSE_IS_MASHUP">
            <div class="card-body p-2">
                <div class="d-flex">
                    <div class="me-2">
                        <img class="media-object rounded media-height" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
                    </div>
                    <div class="flex-grow-1">
                        <h4 data-bind="text: $data.Title"></h4>
                        <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                    </div>
                </div>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="PhotoBlogNewsTemplate">
    <div class="PhotoBlogNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group:'news', external:MA_GPSNOSE_IS_MASHUP, disabled:$data.IsNowDeleted">
            <img class="card-img-top" data-bind="attr: { src: $data.ThumbUrl() }" onerror="this.style.display='none'" />
            <div class="card-body p-2">
                <div class="d-flex">
                    <div class="flex-grow-1" data-bind="html: $parent.GetHtmlFromString($data.Impression_Text)"></div>
                    <div class="text-end" data-bind="text: $data.Impression_Mood"></div>
                </div>
                <div class="text-end mt-2">
                    <span class="align-middle" data-bind="text: NoseDto.LoginName"></span>
                    <img class="rounded-circle" width="32" data-bind="attr: { src: NoseDto.ImageUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
                </div>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="PoIPublishedNewsTemplate">
    <div class="PoIPublishedNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group:'news', external:MA_GPSNOSE_IS_MASHUP, disabled:$data.IsNowDeleted">
            <div class="card-body p-2">
                <div class="d-flex">
                    <div class="me-2">
                        <img class="media-object rounded media-height" data-bind="attr: { src: $data.ThumbUrl(), 'data-default': $parent.GetDefaultImageFromKeywords($data.Keywords) }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyPoi.png')" />
                    </div>
                    <div class="flex-grow-1">
                        <h4 data-bind="text: $data.Title"></h4>
                        <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                    </div>
                </div>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="TourNewsTemplate">
    <div class="TourNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group:'news', external:MA_GPSNOSE_IS_MASHUP, disabled:$data.IsNowDeleted">
            <div class="card-body p-2">
                <div class="d-flex">
                    <div class="me-2">
                        <img class="media-object rounded media-height" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyTour.png')" />
                    </div>
                    <div class="flow-grow-1">
                        <h4 data-bind="text: $data.Title"></h4>
                        <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                    </div>
                </div>
                <div class="card-bottom mt-2">
                    <div class="d-flex">
                        <img class="ma-tour-icon" width="24px" data-bind="attr: { src: '/Content/Mashup/Images/TourType' + $data.Track_TrackType + '.png' }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/TourType99.png')" />
                        <div class="flex-grow-1">
                            <div class="text-center">
                                <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="EventNewsTemplate">
    <div class="AboutNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group:'news', external:MA_GPSNOSE_IS_MASHUP">
            <div class="card-body p-2">
                <div class="d-flex">
                    <div class="me-2">
                        <img class="media-object rounded media-height" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyEvent.png')" />
                    </div>
                    <div class="flow-grow-1">
                        <h4 data-bind="text: $data.Title"></h4>
                        <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                        <p data-bind="text: $data.Event_LocationAddress"></p>
                    </div>
                </div>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="CommentNewsTemplate">
    <div class="CommentNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="attr: {'data-src': MA_GPSNOSE_IS_MASHUP ? $data.DetailUrl() : '#comment-' + $index() }, fancyboxAttr: $data, fancyboxType: null, group: 'news', external: MA_GPSNOSE_IS_MASHUP">
            <div class="card-body p-2">
                <div>
                    <div class="comment-image-container me-2">
                        <div data-bind="if: Comment_CommentItemType == 'Tour'">
                            <img class="rounded comment-image-right" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyTour.png')" />
                        </div>
                        <div data-bind="if: Comment_CommentItemType == 'FavoriteLocation'">
                            <img class="rounded comment-image-right" data-bind="attr: { src: $data.ThumbUrl(), 'data-default': $parent.GetDefaultImageFromKeywords($data.Keywords) }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyPoi.png')" />
                        </div>
                        <div data-bind="if: Comment_CommentItemType == 'PhotoBlog'">
                            <img class="rounded comment-image-right" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyImage.png')" />
                        </div>
                        <div data-bind="if: Comment_CommentItemType == 'Community'">
                            <img class="rounded comment-image-right" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyCommunity.png')" />
                        </div>
                        <img class="rounded comment-image-left" data-bind="attr: { src: NoseDto.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
                    </div>
                    <p data-bind="html: $parent.GetHtmlFromString(CommentText())"></p>
                </div>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="visually-hidden">
        <div data-bind="attr: { id: 'comment-' + $index() }">
            <div class="CommentNews gn-detail-inline">
                <div>
                    <div class="comment-image-container">
                        <div data-bind="if: Comment_CommentItemType == 'Tour'">
                            <img class="rounded comment-image-right" data-fancybox data-type="ajax" data-bind="attr: { src: $data.ThumbUrl(), 'data-src': DetailInlineUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyTour.png')" />
                        </div>
                        <div data-bind="if: Comment_CommentItemType == 'FavoriteLocation'">
                            <img class="rounded comment-image-right" data-fancybox data-type="ajax" data-bind="attr: { src: $data.ThumbUrl(), 'data-src': DetailInlineUrl(), 'data-default': $parent.GetDefaultImageFromKeywords($data.Keywords) }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyPoi.png')" />
                        </div>
                        <div data-bind="if: Comment_CommentItemType == 'PhotoBlog'">
                            <img class="rounded comment-image-right" data-fancybox data-type="ajax" data-bind="attr: { src: $data.ThumbUrl(), 'data-src': DetailInlineUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyImage.png')" />
                        </div>
                        <div data-bind="if: Comment_CommentItemType == 'Community'">
                            <img class="rounded comment-image-right" data-fancybox data-type="ajax" data-bind="attr: { src: $data.ThumbUrl(), 'data-src': DetailInlineUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyCommunity.png')" />
                        </div>
                        <img class="rounded comment-image-left" data-fancybox data-type="ajax" data-bind="attr: { src: NoseDto.ThumbUrl(), 'data-src': NoseDto.PreviewUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
                    </div>
                    <p data-bind="html: $parent.GetHtmlFromString(CommentText())"></p>
                </div>
                <div class="text-center mt-2">
                    <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="RatingNewsTemplate">
    <div class="RatingNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="attr: {'data-src': MA_GPSNOSE_IS_MASHUP ? $data.DetailUrl() : '#rating-' + $index() }, fancyboxAttr: $data, fancyboxType: null, group: 'news', external: MA_GPSNOSE_IS_MASHUP">
            <div class="card-body p-2">
                <div>
                    <div class="comment-image-container">
                        <div data-bind="if: Rating_RatedItemType == 'Tour'">
                            <img class="rounded comment-image-right" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyTour.png')" />
                        </div>
                        <div data-bind="if: Rating_RatedItemType == 'FavoriteLocation'">
                            <img class="rounded comment-image-right" data-bind="attr: { src: $data.ThumbUrl(), 'data-default': $parent.GetDefaultImageFromKeywords($data.Keywords) }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyPoi.png')" />
                        </div>
                        <div data-bind="if: Rating_RatedItemType == 'PhotoBlog'">
                            <img class="rounded comment-image-right" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyImage.png')" />
                        </div>
                        <div data-bind="if: Rating_RatedItemType == 'Community'">
                            <img class="rounded comment-image-right" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyCommunity.png')" />
                        </div>
                        <img class="rounded comment-image-left" data-bind="attr: { src: NoseDto.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
                    </div>
                    <div class="rating-stars-container">
                        <!-- ko component: {
                                name: "ma-gpsnose-rating",
                                params: {
                                    percent: $data.Rating_Percent,
                                    count: -1
                                }
                            } -->
                        <!-- /ko -->
                    </div>
                    <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                </div>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="visually-hidden">
        <div data-bind="attr: { id: 'rating-' + $index() }">
            <div class="RatingNews gn-detail-inline">
                <div>
                    <div class="comment-image-container">
                        <div data-bind="if: Rating_RatedItemType == 'Tour'">
                            <img class="rounded comment-image-right" data-fancybox data-type="ajax" data-bind="attr: { src: ThumbUrl(), 'data-src': DetailInlineUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyTour.png')" />
                        </div>
                        <div data-bind="if: Rating_RatedItemType == 'FavoriteLocation'">
                            <img class="rounded comment-image-right" data-fancybox data-type="ajax" data-bind="attr: { src: ThumbUrl(), 'data-src': DetailInlineUrl(), 'data-default': $parent.GetDefaultImageFromKeywords($data.Keywords) }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyPoi.png')" />
                        </div>
                        <div data-bind="if: Rating_RatedItemType == 'PhotoBlog'">
                            <img class="rounded comment-image-right" data-fancybox data-type="ajax" data-bind="attr: { src: ThumbUrl(), 'data-src': DetailInlineUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyImage.png')" />
                        </div>
                        <div data-bind="if: Rating_RatedItemType == 'Community'">
                            <img class="rounded comment-image-right" data-fancybox data-type="ajax" data-bind="attr: { src: ThumbUrl(), 'data-src': DetailInlineUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyCommunity.png')" />
                        </div>
                        <img class="rounded comment-image-left" data-fancybox data-type="ajax" data-bind="attr: { src: NoseDto.ThumbUrl(), 'data-src': NoseDto.PreviewUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
                    </div>
                    <div class="rating-stars-container">
                        <!-- ko component: {
                                name: "ma-gpsnose-rating",
                                params: {
                                    percent: $data.Rating_Percent,
                                    count: -1
                                }
                            } -->
                        <!-- /ko -->
                    </div>
                    <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                </div>
                <div class="text-center mt-2">
                    <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="MashupNewsTemplate">
    <div class="MashupNews masonry-item col-lg-3 col-md-4 col-sm-6 col-12" data-bind="visible:!$data.IsNowDeleted, if:!$data.IsNowDeleted">
        <div class="card shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group: 'news', external: MA_GPSNOSE_IS_MASHUP, disabled: $data.IsNowDeleted">
            <div class="card-body p-2">
                <div class="d-flex">
                    <div class="me-2">
                        <img class="media-object rounded media-height" data-bind="attr: { src: ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyCommunity.png')" />
                    </div>
                    <div class="flow-grow-1">
                        <h4 data-bind="text: $data.Title"></h4>
                        <p data-bind="html: $parent.GetHtmlFromString($data.Description)"></p>
                    </div>
                </div>
                <div class="card-bottom mt-2">
                    <div class="text-center">
                        <small data-bind="text: GetDateStringFromTicks($data.CreationTicks)"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
`});class NosesComponent extends BaseComponentsViewModel{constructor(e){super(e&&e.imagePath||null),this.NosePageUrl="/Home/Page_Noses",this.Noses=ko.observableArray(),this.NosesPageSize=gnSettings.NosesPageSize,this.NosesLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreNoses=ko.observable(!0),this.NosesRequestActive=ko.observable(!1),this.ShowNoses=ko.observable(!0),this.CommunityTag=ko.observable(""),this.CommunityTag(e&&e.communityTag||""),this.NosesRequestActive.subscribe(e=>{ShowPreviewPageLoad(e)}),e&&e.onAddNoses&&(this.OnAddNoses=e.onAddNoses),e&&e.nosePageUrl&&(this.NosePageUrl=e.nosePageUrl),e&&e.page&&e.page.subscribe(()=>{this.HasMoreNoses()&&this.PageNoses()}),e&&e.noses&&0<e.noses.length?this.AddNoses(e.noses):e&&e.noses?this.HasMoreNoses(!1):this.PageNoses()}OnAddNoses(){}AddNoses(t){if(null!=t){let e=!0;if(0<this.Noses.length&&(e=!1),0<t.length){for(var s in this.NosesLastKnownTicks=t[t.length-1].CreationTicks,t)this.Noses.push(new NoseDto(t[s]));t.length%this.NosesPageSize!=0&&this.HasMoreNoses(!1)}else this.HasMoreNoses(!1);this.OnAddNoses&&(e?setTimeout(()=>{this.OnAddNoses()},100):this.OnAddNoses())}}PageNoses(){this.ShowNoses()&&!this.NosesRequestActive()&&this.HasMoreNoses()&&(this.NosesRequestActive(!0),jQuery.ajax({type:"POST",url:this.NosePageUrl,cache:!1,data:{lastKnownTicks:this.NosesLastKnownTicks,pageSize:this.NosesPageSize,community:this.CommunityTag()},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddNoses(e):this.HasMoreNoses(!1),this.NosesRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.NosesRequestActive(!1)}}))}}ko.components.register("ma-gpsnose-noses",{viewModel:{createViewModel:(e,t)=>new NosesComponent(e)},template:`
<div id="publishersContainer" class="row g-3 mb-3" data-bind="foreach: Noses">
    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
        <div class="card border-0 shadow-sm" data-bind="fancyboxAttr: $data, fancyboxType: 'ajax', group:'nose', external:MA_GPSNOSE_IS_MASHUP">
            <img class="card-img-top" data-bind="attr: { src: $data.ThumbUrl() }" onerror="ImageErrorHandler(this, '/Content/Mashup/Images/EmptyUser.png')" />
            <div class="card-body p-0">
                <div class="loginname text-white bg-primary text-center" data-bind="text: $data.LoginName"></div>
            </div>
        </div>
    </div>
</div>

<div class="text-center">
    <div class="btn btn-outline-secondary btn-lg" data-bind="click: function(){ PageNoses() }, visible: HasMoreNoses(), attr: { disabled: NosesRequestActive() }" data-aos="zoom-in">
        <div data-bind="visible: ! NosesRequestActive()">
            <i class="fas fa-cloud-download-alt"></i>
            <span data-bind="text: ' ' + GetLangRes('Common_lblLoadMore', 'more..')"></span>
        </div>
        <div data-bind="visible: NosesRequestActive()">
            <i class="fas fa-redo-alt gly-spin"></i>
            <span data-bind="text: ' ' + GetLangRes('Common_lblRequestInProgress', 'Request in progress')"></span>
        </div>
    </div>
</div>

<div class="alert alert-info" data-bind="visible: Noses().length == 0 && ! NosesRequestActive()">
    <i class="fas fa-info-circle"></i>
    <span data-bind="text: ' ' + GetLangRes('Home_Overview_lblNoPublishers', 'There are currently no such noses in your area, but you can give the mobile app to your friends to see them here.')"></span>
</div>`});class RatingViewModel extends BaseComponentsViewModel{constructor(e){super(e&&e.imagePath||null);var t=0,t=(e&&!isNaN(e.percent)&&(t=parseInt(e.percent)),this.Percent=ko.observable(t),0);e&&!isNaN(e.count)&&(t=parseInt(e.count)),this.Count=ko.observable(t)}Title(){return this.Percent()+"%"+(0<this.Count()?" ("+this.Count()+")":"")}ImageByPercent(e){return this.ImagePath()+(this.Percent()>e?"/StarOn":"/StarOff")+".png"}}ko.components.register("ma-gpsnose-rating",{viewModel:{createViewModel:(e,t)=>new RatingViewModel(e)},template:'<div data-bind="if: Count() != 0"><div class="rating" data-bind="attr: { title: Title() }"><img class="star" data-bind="attr: { src: ImageByPercent(-1) }" /><img class="star" data-bind="attr: { src: ImageByPercent(20) }" /><img class="star" data-bind="attr: { src: ImageByPercent(45) }" /><img class="star" data-bind="attr: { src: ImageByPercent(70) }" /><img class="star" data-bind="attr: { src: ImageByPercent(90) }" /></div></div>'}),function(e){e[e.None=0]="None",e[e.ByDay=1]="ByDay",e[e.ByWeek=2]="ByWeek",e[e.ByMonth=3]="ByMonth",e[e.ByYear=4]="ByYear",e[e.Custom=5]="Custom"}(GroupTypeEnum=GroupTypeEnum||{}),function(e){e[e.Touch=0]="Touch",e[e.Poi=1]="Poi",e[e.Blog=2]="Blog"}(CoordinateTypeEnum=CoordinateTypeEnum||{}),function(e){e[e.PhotoBlog=1]="PhotoBlog",e[e.FavoriteLocation=2]="FavoriteLocation",e[e.Tour=3]="Tour",e[e.Event=4]="Event",e[e.Community=5]="Community"}(CommentItemType=CommentItemType||{}),function(e){e[e.NoOptions=0]="NoOptions",e[e.ListMembers=1]="ListMembers",e[e.MembersInviteMembers=2]="MembersInviteMembers",e[e.CommentsFromMembers=4]="CommentsFromMembers"}(CommunityAcl=CommunityAcl||{}),function(e){e[e.Unknown=0]="Unknown",e[e.NewGuestUser=1]="NewGuestUser",e[e.ProfileActivated=2]="ProfileActivated",e[e.ProfileAbout=3]="ProfileAbout",e[e.ProfileImage=4]="ProfileImage",e[e.Comment=5]="Comment",e[e.Rating=6]="Rating",e[e.PhotoBlog=7]="PhotoBlog",e[e.PoI=8]="PoI",e[e.Tour=9]="Tour",e[e.Event=10]="Event",e[e.Mashup=11]="Mashup"}(NewsType=NewsType||{});class EulaViewModel extends BaseViewModel{constructor(){super(),this.EulaPath="/eula/",this.IndexCurrId=0,this.UlActive=!1,this.OlActive=!1,this.EulaCurrentVersion=ko.observable(1),this.EulaLanguage=ko.observable("en"),this.Content=ko.observable(""),this.Index=ko.observableArray([])}GetHtml(e){var t="",s=("-"!=e.substring(0,1)&&this.UlActive&&this.UlActive&&(t+="</ul>",this.UlActive=!1),/^[0-9]*\.\s(.*)$/.exec(e)),a=(!s&&this.OlActive&&this.OlActive&&(t+="</ol>",this.OlActive=!1),/^([#]*)\s/.exec(e));return a?(a=null==(a=a[1])?void 0:a.length,t+=this.GetHeader(a,e.substring(a).trim(),a<=2)):"[index]"==e?t+='<div id="index_dest"></div>':"-"==e.substring(0,1)?(this.UlActive||(t+="<ul>",this.UlActive=!0),t+="<li>"+jQuery("<div />").text(e.substring(1).trim()).html()+"</li>"):s?(this.OlActive||(t+="<ol>",this.OlActive=!0),t+="<li>"+jQuery("<div />").text(s[1]).html()+"</li>"):t+="<p>"+jQuery("<div />").text(e).html()+"</p>",this.linkify(t)}linkify(e){return(e=e.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|]|www\.gpsnose\.com)/gi,function(e){return"www.gpsnose.com"==e?`<strong>${e}</strong>`:`<a href="${e}">${e}</a>`})).replace(/(\b[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*)/gi,function(e){return`<a href="${e}">${e}</a>`})}GetHeader(e,t,s){t=jQuery("<div />").text(t).html();return this.IndexCurrId++,s&&this.Index.push('<a href="#anc_'+this.IndexCurrId+'" class="index index-'+e+'">'+t+"</a>"),"<h"+(e+1)+' id="anc_'+this.IndexCurrId+'">'+t+"</h"+(e+1)+">"}LoadFile(s){let a=this;this.UpdateCurrentVersion(()=>{this.CheckLanguage(()=>{jQuery.ajax({type:"GET",url:this.EulaPath+this.EulaCurrentVersion()+"_"+this.EulaLanguage()+".txt",dataType:"text",success:e=>{var e=e.split("\n"),t="";e.forEach(e=>{0<e.trim().length&&(t+=a.GetHtml(e.trim()))}),a.Content(t),s()},error:()=>{dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)}})})})}CheckLanguage(a){var o=GetCurrentLang();let i=this;jQuery.ajax({type:"HEAD",url:this.EulaPath+this.EulaCurrentVersion()+"_"+o+".txt",success:function(e,t,s){i.EulaLanguage(o),a()},error:function(e,t,s){a()}})}UpdateCurrentVersion(a){let o=this.EulaCurrentVersion()+1,i=this;jQuery.ajax({type:"HEAD",url:this.EulaPath+o+"_en.txt",success:function(e,t,s){i.EulaCurrentVersion(o),i.UpdateCurrentVersion(a)},error:function(e,t,s){a()}})}}class EventDetailViewModel extends BaseViewModel{constructor(e){super(),this.Dates=ko.observableArray(),this.UniqueKey=e.UniqueKey||"",this.LoginName=GetLoginNameFromUniqueKey(this.UniqueKey),this.CreationTicks=GetTicksFromUniqueKey(this.UniqueKey),this.Entity=new EventDto({UniqueKey:this.UniqueKey}),this.NoseDto=new NoseDto({LoginName:this.LoginName}),this.IsOnlineEvent=16==(16&e.EventOptions)}OnAddDates(e){}AddDates(e){if(null!=e){for(const t in e)this.Dates.push(new EventDateDto(t,e[t]));this.OnAddDates&&this.OnAddDates(this.Dates())}}}class GipViewModel extends BaseViewModel{constructor(){super(),this.CacheGip=new Array,this.Rectangle=ko.observable(null),this.Gip=ko.observable(null),this.IsGipAutoUpdate=ko.observable(!1),this.SearchQuery=ko.observable(null),this.Latitude=ko.observable(0).extend({numeric:5}),this.Longitude=ko.observable(0).extend({numeric:5}),this.Zoom=ko.observable(12),this.ZoomPreview=ko.observable(12),this.PreventZoomInOnRefresh=ko.observable(!1),this.RequestActive=ko.observable(!1),this.ShareUrl=ko.computed(()=>"https://www.gpsnose.com/gip/"+this.Gip()),this.Warning=ko.observable(null),this.HasWarning=ko.computed(()=>null!=this.Warning()),this.Gip.subscribe(e=>{var t=e.replace(/[^0-9A-HYJKWMNXPR-VZ.]+/gi,"");t!=e?this.Gip(t):(this.IsGipAutoUpdate()||0==this.Latitude()&&0==this.Longitude())&&this.GetMapRectFromGip()}),this.Zoom.subscribe(e=>{e<2?this.Zoom(2):28<e?this.Zoom(28):this.PreventZoomInOnRefresh(!1),this.ZoomPreview(e),this.GetGipFromLatLng()}),this.Rectangle.subscribe(e=>{this.Latitude(e.Center.Latitude),this.Longitude(e.Center.Longitude),this.Zoom(e.Zoom),this.OnRefresh&&this.OnRefresh(this.PreventZoomInOnRefresh())}),this.IsGipAutoUpdate.subscribe(e=>{e&&this.GetMapRectFromGip()})}OnSearch(e){}OnRefresh(e){}GetGpxBox(){var e=this.Rectangle();return null!=e&&e.Vertex0?[{type:"Feature",properties:{type:"track"},geometry:{type:"LineString",coordinates:[[e.Vertex0.Longitude,e.Vertex0.Latitude],[e.Vertex1.Longitude,e.Vertex1.Latitude],[e.Vertex2.Longitude,e.Vertex2.Latitude],[e.Vertex3.Longitude,e.Vertex3.Latitude],[e.Vertex0.Longitude,e.Vertex0.Latitude]]}}]:null}GetMapRectFromGip(){var e,t=this.Gip()?this.Gip().replace(/\.$/,""):null;!t||t.length<1?this.UseUserLocation():(e=this.CacheGip.filter(e=>e[0]==t))[0]?this.Rectangle(e[0][1]):this.RequestActive()||(this.RequestActive(!0),jQuery.ajax({type:"POST",url:"/Gip/GetRectFromGip",cache:!1,data:{gip:t},dataType:"json",success:e=>{e&&e.Center&&(this.CacheGip.push([t,e]),this.Rectangle(e)),this.RequestActive(!1)},error:e=>{this.RequestActive(!1),this.UseUserLocation()}}))}GetGipFromLatLng(){this.RequestActive()||(this.RequestActive(!0),jQuery.ajax({type:"POST",url:"/Gip/GetGipFromLatLng",cache:!1,data:{lat:this.Latitude(),lon:this.Longitude(),zoom:this.Zoom()},dataType:"json",success:e=>{e&&e.Rect&&(this.Rectangle(e.Rect),this.Gip(e.Gip)),this.RequestActive(!1)},error:e=>{this.RequestActive(!1),this.UseUserLocation()}}))}UseUserLocation(){this.UserLocationCallback&&this.UserLocationCallback()}Search(){this.OnSearch&&this.OnSearch(this.SearchQuery())}}class ImportedKeywordsViewModel extends BaseViewModel{constructor(){super(),this.ImportedKeywordsUrl="/Home/GetAllImportedKeywords",this.BaseDataUrl="https://gpsnose.blob.core.windows.net",this.CurrentKeyword=ko.observable(null),this.KeywordScopes=ko.observableArray([]),this.ImportedKeywords=ko.observableArray([]),this.ImportedKeywordsRequestActive=ko.observable(!1),this.CurrentKeyword.subscribe(e=>{this.SelectKeyword(e.Keyword)}),this.ImportedKeywords.subscribe(e=>{var t=ko.utils.arrayMap(this.ImportedKeywords(),e=>e.Scope);this.KeywordScopes(ko.utils.arrayGetDistinctValues(t).sort());let s=this.findGetParameter("keyword");s&&0<s.length&&(t=ko.utils.arrayFilter(this.ImportedKeywords(),e=>e.Keyword==s))[0]?this.CurrentKeyword(t[0]):this.CurrentKeyword(e[0])})}OnSelectKeyword(e,t,s){}SelectKeyword(t){let a=ko.utils.arrayFirst(this.ImportedKeywords(),e=>e.Keyword==t);jQuery.ajax({url:this.BaseDataUrl+"/impkeysgsjon/"+encodeURI(t),dataType:"json",success:e=>{this.OnSelectKeyword&&this.OnSelectKeyword(this,a,e)},error:(e,t,s)=>{this.OnSelectKeyword&&this.OnSelectKeyword(this,a,[])}})}ImportedKeywordsWithScope(t){return ko.utils.arrayFilter(this.ImportedKeywords(),e=>e.Scope==t)}LoadImportedKeywords(){this.ImportedKeywordsRequestActive()||(this.ImportedKeywordsRequestActive(!0),jQuery.ajax({type:"POST",url:this.ImportedKeywordsUrl,cache:!1,dataType:"json",success:e=>{e?this.ImportedKeywords(e):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null),this.ImportedKeywordsRequestActive(!1)},error:()=>{this.ImportedKeywordsRequestActive(!1),dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)}}))}findGetParameter(t){var s,a=null;return location.search.substr(1).split("&").forEach(function(e){(s=e.split("="))[0]===t&&(a=decodeURIComponent(s[1]))}),a}}class IndexViewModel extends BaseViewModel{constructor(){super(),this.CommunityTag=ko.observable(""),this.MashupPageUrl="/Home/Page_Mashups",this.CommunityDetailUrl="/Community/GetDetail",this.MashupsPageSize=gnSettings.MashupsPageSize,this.ShowMashups=ko.observable(!0),this.PublicMashups=ko.observableArray(),this.PublicMashupsLastKnownTagName="%",this.HasMorePublicMashups=ko.observable(!0),this.PublicMashupsRequestActive=ko.observable(!1),this.ClosedMashups=ko.observableArray(),this.ClosedMashupsLastKnownTagName="@",this.HasMoreClosedMashups=ko.observable(!0),this.ClosedMashupsRequestActive=ko.observable(!1),this.NosePageUrl="/Home/Page_Noses",this.Noses=ko.observableArray(),this.NosesPageSize=gnSettings.NosesPageSize,this.NosesLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreNoses=ko.observable(!0),this.NosesRequestActive=ko.observable(!1),this.ShowNoses=ko.observable(!0),this.NosesCurrentPage=ko.observable(0),this.NewsPageUrl="/Home/Page_News",this.News=ko.observableArray(),this.NewsPageSize=gnSettings.NewsPageSize,this.NewsLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreNews=ko.observable(!0),this.NewsRequestActive=ko.observable(!1),this.ShowNews=ko.observable(!0),this.NewsCurrentPage=ko.observable(0),this.CommunityEntity=new CommunityDto({},new NoseDto({})),this.CommunityTag.subscribe(e=>{this.CommunityEntity=new CommunityDto({TagName:e},new NoseDto({}))})}OnAddPublicMashups(){}AddPublicMashups(e){if(null!=e){if(0<e.length){for(var t in this.PublicMashupsLastKnownTagName=e[e.length-1],e)this.PublicMashups.push(new CommunityDto({TagName:e[t]},new NoseDto({})));e.length%this.MashupsPageSize!=0&&this.HasMorePublicMashups(!1)}else this.HasMorePublicMashups(!1);this.OnAddPublicMashups&&this.OnAddPublicMashups()}}PagePublicMashups(){this.ShowMashups()&&!this.PublicMashupsRequestActive()&&this.HasMorePublicMashups()&&(this.PublicMashupsRequestActive(!0),jQuery.ajax({type:"POST",url:this.MashupPageUrl,cache:!1,data:{lastKnownMashup:this.PublicMashupsLastKnownTagName,pageSize:this.MashupsPageSize},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddPublicMashups(e):this.HasMorePublicMashups(!1),this.PublicMashupsRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.PublicMashupsRequestActive(!1)}}))}OnAddClosedMashups(){}AddClosedMashups(e){if(null!=e){if(0<e.length){for(var t in this.ClosedMashupsLastKnownTagName=e[e.length-1],e)this.ClosedMashups.push(new CommunityDto({TagName:e[t]},new NoseDto({})));e.length%this.MashupsPageSize!=0&&this.HasMoreClosedMashups(!1)}else this.HasMoreClosedMashups(!1);this.OnAddClosedMashups&&this.OnAddClosedMashups()}}PageClosedMashups(){this.ShowMashups()&&!this.ClosedMashupsRequestActive()&&this.HasMoreClosedMashups()&&(this.ClosedMashupsRequestActive(!0),jQuery.ajax({type:"POST",url:this.MashupPageUrl,cache:!1,data:{lastKnownMashup:this.ClosedMashupsLastKnownTagName,pageSize:this.MashupsPageSize},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddClosedMashups(e):this.HasMoreClosedMashups(!1),this.ClosedMashupsRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.ClosedMashupsRequestActive(!1)}}))}OnAddNoses(){}AddNoses(e){if(null!=e){if(0<e.length){for(var t in this.NosesLastKnownTicks=e[e.length-1].CreationTicks,e)this.Noses.push(new NoseDto(e[t]));e.length%this.NosesPageSize!=0&&this.HasMoreNoses(!1)}else this.HasMoreNoses(!1);this.OnAddNoses&&this.OnAddNoses()}}PageNoses(){this.ShowNoses()&&!this.NosesRequestActive()&&this.HasMoreNoses()&&(this.NosesRequestActive(!0),this.NosesCurrentPage(this.NosesCurrentPage()+1),jQuery.ajax({type:"POST",url:this.NosePageUrl,cache:!1,data:{lastKnownTicks:this.NosesLastKnownTicks,pageSize:this.NosesPageSize,community:this.CommunityTag()},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddNoses(e):this.HasMoreNoses(!1),this.NosesRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.NosesRequestActive(!1)}}))}OnAddNews(){}AddNews(e){if(null!=e){if(0<e.length){for(var t in this.NewsLastKnownTicks=e[e.length-1].CreationTicks,e)this.News.push(new NewsDto(e[t]));e.length%this.NewsPageSize!=0&&this.HasMoreNews(!1)}else this.HasMoreNews(!1);this.OnAddNews&&this.OnAddNews()}}PageNews(){this.ShowNews()&&!this.NewsRequestActive()&&this.HasMoreNews()&&(this.NewsRequestActive(!0),this.NewsCurrentPage(this.NewsCurrentPage()+1),jQuery.ajax({type:"POST",url:this.NewsPageUrl,cache:!1,data:{lastKnownTicks:this.NewsLastKnownTicks,pageSize:this.NewsPageSize,community:this.CommunityTag()},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddNews(e):this.HasMoreNews(!1),this.NewsRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.NewsRequestActive(!1)}}))}}class BaseNavigableItem{constructor(e){e&&jQuery.extend(this,e),!this.LoginName&&e.Creator&&(this.LoginName=e.Creator),this.UniqueKey?(this.LoginName=GetLoginNameFromUniqueKey(this.UniqueKey),this.CreationTicks=GetTicksFromUniqueKey(this.UniqueKey)):this.CreationTicks&&(this.UniqueKey=GetUniqueKey(this.LoginName,this.CreationTicks))}}class CarouselItemDto{constructor(e,t){this.Title=ko.observable(""),this.Text=ko.observable(""),this.Title(e),this.Text(t)}}class CommentDto{constructor(e){this.HasText=()=>this.Text&&0<this.Text.length,e&&jQuery.extend(this,e),e.CreatedByUserName&&!this.Creator&&(this.Creator=e.CreatedByUserName),this.NoseDto=new NoseDto({LoginName:this.Creator})}}class CommunityDto{constructor(e,t){this.TagName=ko.observable(""),this.Description=ko.observable(""),this.CreatorLoginName=ko.observable(""),this.CreationTicks=ko.observable("0"),this.MembersCount=ko.observable(0),this.Acls=ko.observable(0),this.Admins=ko.observableArray([]),this.IsInCommunity=ko.observable(!1),this.HasRequested=ko.observable(!1),this.IsRequestActive=ko.observable(!1),this.LoginName=ko.observable(""),this.NoseDto=ko.observable(),this.ThumbSize="@200",this.ImageUrl=()=>gnSettings.BaseDataUrl+"/commimg/"+encodeURIComponent(this.TagName()),this.ThumbUrl=()=>this.ImageUrl()+this.ThumbSize,this.PreviewUrl=()=>"/community/preview?profileTag="+encodeURIComponent(this.TagName()),this.DetailUrl=()=>(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/community/index?profileTag="+encodeURIComponent(this.TagName())+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"&lid="+gnSettings.LoginId:""),this.ShareUrl=()=>gnSettings.BaseUrl+"/community/index?profileTag="+encodeURIComponent(this.TagName()),this.JoinUrl=()=>gnSettings.BaseUrl+"/tag/"+encodeURIComponent(this.TagName()),this.IsLoginNameAdmin=()=>this.LoginName()==this.CreatorLoginName()||-1!=jQuery.inArray(this.LoginName(),this.Admins()),this.WebMashupUrl=()=>{if(-1!=this.TagName().indexOf(".")){var e=this.TagName().substring(1).split("@");if(0<e.length)return"http://"+e[0]}return null},this.IsAclListMembers=()=>(this.Acls()&CommunityAcl.ListMembers)==CommunityAcl.ListMembers,this.IsMembersListAllowed=()=>this.IsAclListMembers()||this.IsLoginNameAdmin(),this.IsAclMembersInviteMembers=()=>(this.Acls()&CommunityAcl.MembersInviteMembers)==CommunityAcl.MembersInviteMembers,this.IsInviteMembersAllowed=()=>this.IsAclMembersInviteMembers()&&(this.IsInCommunity()||this.NoseDto().IsInCommunity(this.TagName()))||this.IsLoginNameAdmin(),this.IsAclCommentsFromMembers=()=>(this.Acls()&CommunityAcl.CommentsFromMembers)==CommunityAcl.CommentsFromMembers,this.CommentItemType=CommentItemType.Community,this.IsCommentsAllowed=()=>this.IsAclCommentsFromMembers()&&(this.IsInCommunity()||this.NoseDto().IsInCommunity(this.TagName())||!this.LoginName())||this.IsLoginNameAdmin(),this.IsUserAdmin=e=>this.CreatorLoginName()==e||-1!=jQuery.inArray(e,this.Admins()),this.Update(e),this.LoginName(t.LoginName),this.NoseDto(new NoseDto(t))}Update(e){e.TagName&&this.TagName(e.TagName),e.Description&&this.Description(e.Description),e.CreatorLoginName&&this.CreatorLoginName(e.CreatorLoginName),e.CreationTicks&&this.CreationTicks(e.CreationTicks),e.MembersCount&&this.MembersCount(e.MembersCount),e.Acls&&this.Acls(e.Acls),e.Admins&&this.Admins(e.Admins),e.IsInCommunity&&this.IsInCommunity(e.IsInCommunity),e.LoginName&&this.LoginName(e.LoginName),e.HasRequested&&this.HasRequested(e.HasRequested)}DisplayName(){return new KeywordDto(this.TagName()).GetHtml()}}class CommunityMemberDto{constructor(e){e&&jQuery.extend(this,e),this.NoseDto=new NoseDto({LoginName:this.LoginName})}}class Coordinate{constructor(e){this.PercentageX=0,this.PercentageY=0,this.Distance=0,this.AgeString="0m",e&&jQuery.extend(this,e),this.Location=L.latLng(this.lat,this.lon,this.alt)}}class EventDateDto{constructor(e,t){this.Ticks=e,this.Count=t}}class EventDto extends BaseNavigableItem{constructor(e){super(e),this.ThumbSize="@200",this.ImageUrl=()=>gnSettings.BaseDataUrl+"/eventsimg/"+encodeURIComponent(this.UniqueKey),this.ThumbUrl=()=>this.ImageUrl()+this.ThumbSize,this.PreviewUrl=()=>"/event/preview/"+encodeURIComponent(this.UniqueKey),this.DetailUrl=()=>(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/event/detail/"+encodeURIComponent(this.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:""),this.ShareUrl=()=>gnSettings.BaseUrl+"/event/detail/"+encodeURIComponent(this.UniqueKey)}}class GeoDataGeometry{}class GeoDataItem{}class GeoDataProperties{}class GnGip{}class GnMapPoint{constructor(e,t){this.Latitude=e,this.Longitude=t}}class GnMapRectangle{}class ImportedKeywordDto{constructor(){this.Keyword="",this.LastUpdatedTicks="",this.DataSourceInfo="",this.Scope="",this.Count=0}}class KeywordDto{constructor(e){this.Name=ko.observable(""),this.IsSelected=ko.observable(!1),this.Name(e),this.Community=new CommunityDto({TagName:e},new NoseDto({}))}IsCommunity(){return""!=this.GetIcon()}GetHtml(){var e=this.Name(),t=this.GetIcon();return""!=t&&e&&2<e.length?'<i class="'+t+'"></i> <span class="keyword-label">'+e.substr(1,e.length)+"</span>":e}GetIcon(){var e=this.Name();if(!e||e.length<1)return"";var t="";switch(e.charAt(0)){case"@":t="glyphicon glyphicon-lock fas fa-lock";break;case"*":t="glyphicon glyphicon-eye-close fas fa-eye-slash";break;case"%":t="glyphicon glyphicon-globe fas fa-globe-americas"}return t}Toggle(){this.IsSelected(!this.IsSelected())}}class NavBarDto{constructor(e,t,s,a){this.Url=ko.observable(""),this.Text=ko.observable(""),this.Icon=ko.observable(""),this.IsActive=ko.observable(!1),this.Url(e),this.Text(t),this.Icon(s),window.location.pathname.match(a)&&this.IsActive(!0)}}class NearbyItem{constructor(e,t){this.Items=ko.observableArray(),this.TagName=e,this.NewItem=t}NewItem(e){return null}OnAddItems(){}AddItems(e){if(null!=e){if(0<e.length)for(var t in e)this.Items.push(this.NewItem(e[t]));this.OnAddItems&&this.OnAddItems()}}}class NewsDto{constructor(e){switch(this.PoiPublished_Name=34,this.TemplateName=()=>{switch(this.NewsType){case NewsType.ProfileAbout:return"AboutNewsTemplate";case NewsType.ProfileImage:return"ProfileImageNewsTemplate";case NewsType.NewGuestUser:return"NewGuestUserNewsTemplate";case NewsType.ProfileActivated:return"ProfileActivatedTemplate";case NewsType.PhotoBlog:return"PhotoBlogNewsTemplate";case NewsType.PoI:return"PoIPublishedNewsTemplate";case NewsType.Tour:return"TourNewsTemplate";case NewsType.Comment:return"CommentNewsTemplate";case NewsType.Rating:return"RatingNewsTemplate";case NewsType.Event:return"EventNewsTemplate";case NewsType.Mashup:return"MashupNewsTemplate";default:return"UnknownTemplate"}},this.ThumbUrl=()=>this.ImageUrl()+this.Entity.ThumbSize,this.DetailInlineUrl=()=>this.PreviewUrl(),this.PhotoBlogText=()=>this.IsNowDeleted?GetLangRes("NewsPart_Load_lblBlogWasDeleted","Impression was deleted"):this.Title,this.CommentText=()=>{return this.IsNowDeleted?GetLangRes("NewsPart_Load_lblCommentWasDeleted","Comment was deleted"):null!=this.Description&&""!=this.Description?this.Description:(null!=this.Comment_Text?this.Comment_Text:"")+(null!=this.Comment_Mood?" "+this.Comment_Mood:"")},this.ThumbSize="@600",this.ImageUrl=()=>this.Entity.ImageUrl(),this.PreviewUrl=()=>this.Entity.PreviewUrl(),this.DetailUrl=()=>this.Entity.DetailUrl(),this.ShareUrl=()=>this.Entity.ShareUrl(),e&&jQuery.extend(this,e),this.UniqueKey=GetUniqueKey(this.Creator,this.CreationTicks),this.NoseDto=new NoseDto({LoginName:this.Creator}),this.Entity=new NoseDto({LoginName:this.Creator}),this.NewsType){case NewsType.PhotoBlog:this.UniqueKey=GetUniqueKey(this.Creator,this.Impression_CreationTicks),this.Entity=new PhotoBlogDto(this);break;case NewsType.PoI:this.UniqueKey=GetUniqueKey(this.Creator,this.PoiPublished_CreationTicks),this.Entity=new PoiDto(this);break;case NewsType.Tour:this.UniqueKey=GetUniqueKey(this.Creator,this.Track_CreationTicks),this.Entity=new TourDto(this);break;case NewsType.Event:this.UniqueKey=GetUniqueKey(this.Creator,this.Event_CreationTicks),this.Entity=new EventDto(this);break;case NewsType.Comment:switch(this.UniqueKey=this.Comment_CommentItemId,this.Comment_CommentItemType){case"PhotoBlog":this.Entity=new PhotoBlogDto({UniqueKey:this.UniqueKey});break;case"FavoriteLocation":this.Entity=new PoiDto({UniqueKey:this.UniqueKey});break;case"Track":case"Tour":this.Entity=new TourDto({UniqueKey:this.UniqueKey,Latitude:this.Comment_CommentItemLatitude,Longitude:this.Comment_CommentItemLongitude});break;case"Community":this.Entity=new CommunityDto({TagName:this.Comment_CommentItemId},new NoseDto({}))}break;case NewsType.Rating:switch(this.UniqueKey=this.Rating_RatedItemId,this.Rating_RatedItemType){case"FavoriteLocation":this.Entity=new PoiDto({UniqueKey:this.UniqueKey});break;case"PhotoBlog":this.Entity=new PhotoBlogDto({UniqueKey:this.UniqueKey});break;case"Track":case"Tour":this.Entity=new TourDto({UniqueKey:this.UniqueKey,Latitude:this.Rating_RatedItemLatitude,Longitude:this.Rating_RatedItemLongitude})}break;case NewsType.Mashup:this.UniqueKey=this.Mashup_CommunityTag,this.Entity=new CommunityDto({TagName:this.Mashup_CommunityTag},new NoseDto({}))}}}class NoseDto extends BaseNavigableItem{constructor(e){super(e),this.IsInCommunity=e=>this.Communities&&-1!=jQuery.inArray(e,this.Communities),this.ThumbSize="@200",this.ImageUrl=()=>gnSettings.BaseDataUrl+"/profimg/"+encodeURIComponent(this.LoginName),this.ThumbUrl=()=>this.ImageUrl()+this.ThumbSize,this.PreviewUrl=()=>"/nose/preview/"+encodeURIComponent(this.LoginName),this.DetailUrl=()=>(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/n/"+encodeURIComponent(this.LoginName)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:""),this.ShareUrl=()=>gnSettings.BaseUrl+"/n/"+encodeURIComponent(this.LoginName)}}class PhotoBlogDto extends BaseNavigableItem{constructor(e){super(e),this.GroupName=ko.observable(""),this.GroupCount=ko.observable(1),this.GroupType=ko.observable(GroupTypeEnum.None),this.IsGrouped=ko.observable(!1),this.IsLastIncompleteGroup=ko.observable(!1),this.DateString=ko.computed(()=>{var e=GetDateFromTicks(this.CreationTicks);return this.GroupType()==GroupTypeEnum.ByDay?moment(e).format("LL"):this.GroupType()==GroupTypeEnum.ByWeek?GetLangRes("Common_lblCalendarWeekFormat","CW %cw%").replace("%cw%",moment(e).format("w"))+" "+moment(e).format("YYYY"):this.GroupType()==GroupTypeEnum.ByMonth?moment(e).format("MMMM YYYY"):moment(e).format("LLL")}),this.ThumbSize="@600",this.ImageUrl=()=>gnSettings.BaseDataUrl+"/pbimg/"+encodeURIComponent(this.UniqueKey),this.ThumbUrl=()=>this.ImageUrl()+this.ThumbSize,this.PreviewUrl=()=>"/impression/preview/"+encodeURIComponent(this.UniqueKey),this.DetailUrl=()=>(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/impression/detail/"+encodeURIComponent(this.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:""),this.ShareUrl=()=>gnSettings.BaseUrl+"/impression/detail/"+encodeURIComponent(this.UniqueKey),this.CommentItemType=CommentItemType.PhotoBlog,this.IsCommentsAllowed=()=>!0,this.IsUserAdmin=e=>this.LoginName==e}}class PoiDto extends BaseNavigableItem{constructor(e){super(e),this.ThumbSize="@200",this.ImageUrl=()=>gnSettings.BaseDataUrl+"/locimg/"+encodeURIComponent(this.UniqueKey),this.ThumbUrl=()=>this.ImageUrl()+this.ThumbSize,this.PreviewUrl=()=>"/poi/preview/"+encodeURIComponent(this.UniqueKey),this.DetailUrl=()=>(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/poi/detail/"+encodeURIComponent(this.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:""),this.ShareUrl=()=>gnSettings.BaseUrl+"/poi/detail/"+encodeURIComponent(this.UniqueKey),this.CommentItemType=CommentItemType.FavoriteLocation,this.IsCommentsAllowed=()=>!0,this.IsUserAdmin=e=>this.LoginName==e}}class SecurityToken{constructor(){this.Token=ko.observable(null),this.CreatorUserName=ko.observable(null),this.CreatedTicks=ko.observable(null),this.ScannedTicks=ko.observable(null),this.IsValid=ko.observable(!1),this.IsPending=ko.observable(!1)}}class TourDto extends BaseNavigableItem{constructor(e){super(e),this.ThumbSize="",this.ImageUrl=()=>gnSettings.BaseDataUrl+"/toursimg/"+encodeURIComponent(this.UniqueKey),this.ThumbUrl=()=>this.ImageUrl()+this.ThumbSize,this.PreviewUrl=()=>"/track/preview/"+encodeURIComponent(this.UniqueKey),this.DetailUrl=()=>(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/track/detail/"+encodeURIComponent(this.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:""),this.ShareUrl=()=>gnSettings.BaseUrl+"/track/detail/"+encodeURIComponent(this.UniqueKey),this.CommentItemType=CommentItemType.Tour,this.IsCommentsAllowed=()=>!0,this.IsUserAdmin=e=>this.LoginName==e,!this.StartLatitude&&this.Latitude&&(this.StartLatitude=this.Latitude),!this.StartLongitude&&this.Longitude&&(this.StartLongitude=this.Longitude),!this.StartLatitude&&e.Track_StartLatitude&&(this.StartLatitude=e.Track_StartLatitude),!this.StartLongitude&&e.Track_StartLongitude&&(this.StartLongitude=e.Track_StartLongitude)}}class UserDto{constructor(e){this.ImageUrl=()=>gnSettings.BaseDataUrl+"/profimg/"+encodeURIComponent(this.LoginName),this.LoginName=e.LoginName,this.IsActivated=e.IsActivated}}class NearbyViewModel extends BaseViewModel{constructor(e,t){super(),this.Entity=new CommunityDto(e,t),this.TagName=this.Entity.TagName(),this.NoseDto=new NoseDto({LoginName:this.Entity.CreatorLoginName()}),this.PageableNoses=new NearbyItem(this.Entity.TagName(),e=>{e=new NoseDto(e);return e.IsAdmin=e.LoginName==this.Entity.CreatorLoginName()||this.Entity.Admins()&&-1!=jQuery.inArray(e.LoginName,this.Entity.Admins()),e}),this.PageablePois=new NearbyItem(this.Entity.TagName(),e=>new PoiDto(e)),this.PageableImpressions=new NearbyItem(this.Entity.TagName(),e=>new PhotoBlogDto(e)),this.PageableTracks=new NearbyItem(this.Entity.TagName(),e=>new TourDto(e)),this.PageableEvents=new NearbyItem(this.Entity.TagName(),e=>new EventDto(e))}DisplayName(){return new KeywordDto(this.TagName).GetHtml()}}class OverviewViewModel extends BaseViewModel{constructor(){super(),this.CommunityTag=ko.observable(""),this.MashupPageUrl="/Home/Page_Mashups",this.CommunityDetailUrl="/Community/GetDetail",this.MashupsPageSize=gnSettings.MashupsPageSize,this.ShowMashups=ko.observable(!0),this.PublicMashups=ko.observableArray(),this.PublicMashupsLastKnownTagName="%",this.HasMorePublicMashups=ko.observable(!0),this.PublicMashupsRequestActive=ko.observable(!1),this.ClosedMashups=ko.observableArray(),this.ClosedMashupsLastKnownTagName="@",this.HasMoreClosedMashups=ko.observable(!0),this.ClosedMashupsRequestActive=ko.observable(!1),this.NosePageUrl="/Home/Page_Noses",this.Noses=ko.observableArray(),this.NosesPageSize=gnSettings.NosesPageSize,this.NosesLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreNoses=ko.observable(!0),this.NosesRequestActive=ko.observable(!1),this.ShowNoses=ko.observable(!0),this.NosesCurrentPage=ko.observable(0),this.NewsPageUrl="/Home/Page_News",this.News=ko.observableArray(),this.NewsPageSize=gnSettings.NewsPageSize,this.NewsLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreNews=ko.observable(!0),this.NewsRequestActive=ko.observable(!1),this.ShowNews=ko.observable(!0),this.NewsCurrentPage=ko.observable(0),this.CommunityEntity=new CommunityDto({},new NoseDto({})),this.CommunityTag.subscribe(e=>{this.CommunityEntity=new CommunityDto({TagName:e},new NoseDto({}))})}OnAddPublicMashups(){}AddPublicMashups(e){if(null!=e){if(0<e.length){for(var t in this.PublicMashupsLastKnownTagName=e[e.length-1],e)this.PublicMashups.push(new CommunityDto({TagName:e[t]},new NoseDto({})));e.length%this.MashupsPageSize!=0&&this.HasMorePublicMashups(!1)}else this.HasMorePublicMashups(!1);this.OnAddPublicMashups&&this.OnAddPublicMashups()}}PagePublicMashups(){this.ShowMashups()&&!this.PublicMashupsRequestActive()&&this.HasMorePublicMashups()&&(this.PublicMashupsRequestActive(!0),jQuery.ajax({type:"POST",url:this.MashupPageUrl,cache:!1,data:{lastKnownMashup:this.PublicMashupsLastKnownTagName,pageSize:this.MashupsPageSize},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddPublicMashups(e):this.HasMorePublicMashups(!1),this.PublicMashupsRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.PublicMashupsRequestActive(!1)}}))}OnAddClosedMashups(){}AddClosedMashups(e){if(null!=e){if(0<e.length){for(var t in this.ClosedMashupsLastKnownTagName=e[e.length-1],e)this.ClosedMashups.push(new CommunityDto({TagName:e[t]},new NoseDto({})));e.length%this.MashupsPageSize!=0&&this.HasMoreClosedMashups(!1)}else this.HasMoreClosedMashups(!1);this.OnAddClosedMashups&&this.OnAddClosedMashups()}}PageClosedMashups(){this.ShowMashups()&&!this.ClosedMashupsRequestActive()&&this.HasMoreClosedMashups()&&(this.ClosedMashupsRequestActive(!0),jQuery.ajax({type:"POST",url:this.MashupPageUrl,cache:!1,data:{lastKnownMashup:this.ClosedMashupsLastKnownTagName,pageSize:this.MashupsPageSize},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddClosedMashups(e):this.HasMoreClosedMashups(!1),this.ClosedMashupsRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.ClosedMashupsRequestActive(!1)}}))}OnAddNoses(){}AddNoses(e){if(null!=e){if(0<e.length){for(var t in this.NosesLastKnownTicks=e[e.length-1].CreationTicks,e)this.Noses.push(new NoseDto(e[t]));e.length%this.NosesPageSize!=0&&this.HasMoreNoses(!1)}else this.HasMoreNoses(!1);this.OnAddNoses&&this.OnAddNoses()}}PageNoses(){this.ShowNoses()&&!this.NosesRequestActive()&&this.HasMoreNoses()&&(this.NosesRequestActive(!0),this.NosesCurrentPage(this.NosesCurrentPage()+1),jQuery.ajax({type:"POST",url:this.NosePageUrl,cache:!1,data:{lastKnownTicks:this.NosesLastKnownTicks,pageSize:this.NosesPageSize,community:this.CommunityTag()},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddNoses(e):this.HasMoreNoses(!1),this.NosesRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.NosesRequestActive(!1)}}))}OnAddNews(){}AddNews(e){if(null!=e){if(0<e.length){for(var t in this.NewsLastKnownTicks=e[e.length-1].CreationTicks,e)this.News.push(new NewsDto(e[t]));e.length%this.NewsPageSize!=0&&this.HasMoreNews(!1)}else this.HasMoreNews(!1);this.OnAddNews&&this.OnAddNews()}}PageNews(){this.ShowNews()&&!this.NewsRequestActive()&&this.HasMoreNews()&&(this.NewsRequestActive(!0),this.NewsCurrentPage(this.NewsCurrentPage()+1),jQuery.ajax({type:"POST",url:this.NewsPageUrl,cache:!1,data:{lastKnownTicks:this.NewsLastKnownTicks,pageSize:this.NewsPageSize,community:this.CommunityTag()},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddNews(e):this.HasMoreNews(!1),this.NewsRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.NewsRequestActive(!1)}}))}}class PhotoBlogDetailViewModel extends BaseViewModel{constructor(e){super(),this.Tour=null,this.UniqueKey=e||"",this.LoginName=GetLoginNameFromUniqueKey(this.UniqueKey),this.CreationTicks=GetTicksFromUniqueKey(this.UniqueKey),this.Entity=new PhotoBlogDto({UniqueKey:this.UniqueKey}),this.NoseDto=new NoseDto({LoginName:this.LoginName})}SetTourById(e){this.Tour=new TourDto({UniqueKey:e})}}class PoiDetailViewModel extends BaseViewModel{constructor(e){super(),this.Tour=null,this.UniqueKey=e||"",this.LoginName=GetLoginNameFromUniqueKey(this.UniqueKey),this.CreationTicks=GetTicksFromUniqueKey(this.UniqueKey),this.Entity=new PoiDto({UniqueKey:this.UniqueKey}),this.NoseDto=new NoseDto({LoginName:this.LoginName})}SetTourById(e){this.Tour=new TourDto({UniqueKey:e})}}class SecurityTokenValidatorViewModel extends BaseViewModel{constructor(){super(),this.ValidateUrl="/WebApi/IsSecurityTokenValid",this.ValidationRequestActive=ko.observable(!1),this.CurrentSecurityToken=ko.observable(null),this.SecurityTokens=ko.observableArray([]),this.MessageError=ko.observable(null),this.MessageSuccess=ko.observable(null),this.HasMessage=ko.computed(()=>null!=this.MessageError()||null!=this.MessageSuccess()),this.IsCameraOn=ko.observable(!1),this.IsCameraPending=ko.observable(!1),this.IsScanFinished=ko.observable(!1),this.IsCameraOn.subscribe(e=>{e?(this.OnCameraOn&&this.OnCameraOn(this.Decoder),this.CurrentSecurityToken(null),this.MessageError(null),this.MessageSuccess(null),this.IsScanFinished(!1)):this.OnCameraOff&&this.OnCameraOff(this.Decoder),this.ValidationRequestActive(!1),this.IsCameraPending(e)}),this.CurrentSecurityToken.subscribe(e=>{null!=e&&this.SecurityTokens.push(e)})}OnCameraOn(e){}OnCameraOff(e){}OnValidateComplete(e,t){}ToggleCamera(){this.IsCameraOn(!this.IsCameraOn())}CameraIsNowReady(){this.IsCameraPending(!1)}ValidateResultCode(e){var t,s,a;this.ValidationRequestActive()||(this.ValidationRequestActive(!0),t=this,s=GetLangRes("SecurityTokenValidator_invalideQrCode","Wrong type of QR-Code, please scan a SecurityToken"),null==(e=new URL(e))?(this.MessageError(s),this.ValidationRequestActive(!1)):((a=new SecurityToken).Token(e.searchParams.get("t")),a.CreatorUserName(e.searchParams.get("u")),a.CreatedTicks(e.searchParams.get("c")),a.ScannedTicks(GetTicksFromDate(new Date)),a.IsPending(!0),this.CurrentSecurityToken(a),null==a.Token()||a.Token().length<1?(this.MessageError(s),this.ValidationRequestActive(!1)):(this.IsCameraOn(!1),jQuery.ajax({type:"POST",url:t.ValidateUrl,data:{token:a.Token()},cache:!1,dataType:"json",success:function(e){a.IsValid(e.IsOk),t.IsScanFinished(!0)},error:function(){},complete:function(){a.IsPending(!1),t.OnValidateComplete(a.IsValid(),a.CreatorUserName())}}))))}setDefaultDecoder(e,t){this.Decoder=e.WebCodeCamJQuery({zoom:1,beep:null,resultFunction:e=>{this.ValidateResultCode(e.code)},cameraSuccess:e=>{this.CameraIsNowReady()},canPlayFunction:()=>{},getDevicesError:e=>{this.IsCameraOn(!1),this.MessageError(e.message)},getUserMediaError:e=>{this.IsCameraOn(!1),this.MessageError(e.message)},cameraError:e=>{this.IsCameraOn(!1),this.MessageError(e.message)},constraints:{video:{mandatory:{maxWidth:960,maxHeight:540}},audio:!1},flipHorizontal:!0,decoderWorker:t}).data().plugin_WebCodeCamJQuery,this.OnCameraOn=e=>{e.play()},this.OnCameraOff=e=>{e.stop()}}}class TourDetailViewModel extends BaseViewModel{constructor(e){if(super(),this.ALTITUDE_UNKNOWN=32768,this.ALTITUDE_FROM_MISSING_QUADRANT=32769,this.ALTITUDE_SEA_LEVEL=.001,this.CurrentTourIndex=ko.observable(-1),this.TourItems=ko.observableArray([]),this.Coordinates=ko.observableArray([]),this.NiceTourCoordinates=ko.observableArray([]),this.ElevationMax=ko.observable(0),this.ElevationMaxString=ko.computed(()=>0!=this.ElevationMax()?Math.round(this.ElevationMax())+"m":""),this.ElevationMin=ko.observable(0),this.ElevationMinString=ko.computed(()=>0!=this.ElevationMin()?Math.round(this.ElevationMin())+"m":""),this.MetaElapsedTime=ko.observable(0),this.MetaDistanceTravelled=ko.observable(0),this.MetaAverageSpeed=ko.observable(0),this.MetaElevationUp=ko.observable(0),this.MetaElevationDown=ko.observable(0),this.MetaEffectiveDistance=ko.observable(0),this.CoordinateRequestActive=ko.observable(!1),this.cWidth=3e3,this.cHeight=1e3,this.cMargin=5,this.ElevationCanvasIdentifier=ko.observable(null),this.ElevationMousemoveIndex=ko.observable(-1),this.ElevationClickedIndex=ko.observable(-1),this.UniqueKey=e.UniqueKey||"",this.LoginName=GetLoginNameFromUniqueKey(this.UniqueKey),this.CreationTicks=GetTicksFromUniqueKey(this.UniqueKey),this.Entity=e,this.NoseDto=new NoseDto({LoginName:this.LoginName}),this.ElevationMousemoveIndex.subscribe(e=>{this.DrawElevation()}),this.ElevationClickedIndex.subscribe(e=>{this.DrawElevation()}),this.Entity&&this.Entity.GeoData){var t,s=this.Entity.GeoData;let e=new Array;for(t in s){var a,o=s[t];o.properties&&(o.geometry?(a={UniqueKey:o.properties.identifier,Latitude:o.geometry.coordinates[1],Longitude:o.geometry.coordinates[0]},"poi"==o.properties.type?e.push(new PoiDto(a)):"blog"==o.properties.type&&e.push(new PhotoBlogDto(a))):"blog"==o.properties.type&&e.push(new PhotoBlogDto({UniqueKey:o.properties.identifier})))}ko.utils.arrayPushAll(this.TourItems(),e.sort((e,t)=>e.CreationTicks<t.CreationTicks?-1:e.CreationTicks>t.CreationTicks?1:0))}}UpdateMetaInformations(){this.MetaElapsedTime(this.GetElapsedTime()),this.MetaDistanceTravelled(this.GetDistanceTravelled()),this.MetaAverageSpeed(this.GetAverageSpeed()),this.MetaElevationUp(this.GetElevationUp()),this.MetaElevationDown(this.GetElevationDown()),this.MetaEffectiveDistance(this.GetEffectiveDistance())}OnLoadCoordinates(){}LoadCoordinates(){this.CoordinateRequestActive()||(this.CoordinateRequestActive(!0),jQuery.ajax({type:"GET",url:"/Tour/Coordinates",cache:!1,data:{id:this.UniqueKey},dataType:"json",success:e=>{if(e)for(var t of e){t=new Coordinate(t);t.type==CoordinateTypeEnum.Touch&&this.Coordinates.push(t)}this.DrawElevation(),this.OnLoadCoordinates(),this.UpdateMetaInformations(),this.CoordinateRequestActive(!1)},error:()=>{dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorLoadCoordinates","Coordinates cannot be loaded!"),null),this.CoordinateRequestActive(!1)}}))}DrawElevation(){var e=this.ElevationCanvasIdentifier()||"",s=$(e)[0];if(s.getContext){s.width=this.cWidth+2*this.cMargin,s.height=this.cHeight+2*this.cMargin;var m=s.getContext("2d"),c=(m.fillStyle="#eeeeee",m.rect(this.cMargin,this.cMargin,this.cWidth,this.cHeight),m.fill(),m.lineWidth=10,m.strokeStyle="#dddddd",m.stroke(),this.GetDistanceTravelled());let a=this.AnyCoordinatesWithAlt(this.NiceTourCoordinates())?this.NiceTourCoordinates():this.Coordinates();var u,g=a[0].ticks;let o=this.ALTITUDE_UNKNOWN,i=0;for(u of a)o>u.alt&&0!=u.alt&&(o=u.alt),i<u.alt&&u.alt!=this.ALTITUDE_UNKNOWN&&u.alt!=this.ALTITUDE_FROM_MISSING_QUADRANT&&(i=u.alt);let t;s=i-o;t=s<50?(o-=20,i+=20,10):s<100?(o-=20,i+=20,20):(o-=50,i+=50,100),this.ElevationMin(o),this.ElevationMax(i);for(let e=Math.floor(o/t)+1;e<Math.floor(i/t);e++){var p=this.cHeight/Math.abs(i-o),p=this.cHeight-(e*t-o)*p;m.beginPath(),m.moveTo(this.cMargin,p+this.cMargin),m.lineTo(this.cWidth+this.cMargin,p+this.cMargin),m.lineWidth=5,m.strokeStyle="#dddddd",m.stroke()}m.beginPath();let n=null,r=0,l=-1,d=-1;let h=-1;for(let s=0;s<a.length;s++){let e=a[s],t=this.cMargin;null!=n&&(0!=e.alt&&e.alt!=this.ALTITUDE_UNKNOWN||(e.alt=n.alt),r+=Math.abs(e.Location.distanceTo(n.Location)),t+=this.cWidth/c*r,e.AgeString=GetAgeString(g,e.ticks,!0,!0));var b=this.cHeight-this.cHeight/(i-o)*(e.alt-o)+this.cMargin;null!=n?m.lineTo(t,b):m.moveTo(t,b),s==this.ElevationClickedIndex()&&(l=t,d=b,e.alt),s==this.ElevationMousemoveIndex()&&(h=t,e.alt),e.Distance=r,e.PercentageX=0<r?r/c:0,n=e}m.lineWidth=20,m.strokeStyle="#ff0000",m.stroke(),0<=h&&this.DrawVerticalLine(m,h,-1,"#0077dd","#ffff00"),0<=l&&this.DrawVerticalLine(m,l,d,"#ff0000","#ffff00"),$(e).off(),$(e).on("mouseout",e=>{this.OnElevationMouseOut(),this.ElevationMousemoveIndex(-1)}),$(e).on("mousemove",e=>{this.HandleElevationEvent(a,e)}),$(e).on("click",e=>{this.HandleElevationEvent(a,e)})}}DrawVerticalLine(e,t,s,a,o){e.beginPath(),e.moveTo(t,this.cMargin),e.lineTo(t,this.cHeight+this.cMargin),e.lineWidth=10,e.strokeStyle=a,e.stroke(),0<=s&&(e.beginPath(),e.arc(t,s,30,0,2*Math.PI,!0),e.lineWidth=20,e.strokeStyle=a,e.stroke(),e.fillStyle=o,e.fill())}OnElevationMouseMove(e){}OnElevationMouseOut(){}OnElevationClick(e){}HandleElevationEvent(a,e){e.preventDefault(),e.stopPropagation();var o=e.type;try{let t=-1;var i,n=(e.clientX-$(e.target).offset().left)/$(e.target).width();let s=1e4;for(let e=0;e<a.length;e++){var r=a[e],l=Math.abs(n-r.PercentageX);l<s&&(s=l,t=e)}0<=t&&(i=a[t],"click"==o?(this.ElevationClickedIndex(t),this.OnElevationClick(i)):"mousemove"==o&&(this.ElevationMousemoveIndex(t),this.OnElevationMouseMove(i)))}catch(e){console&&console.log(e)}}AnyCoordinatesWithAlt(e){for(var t of e)if(t.alt!=this.ALTITUDE_UNKNOWN&&t.alt!=this.ALTITUDE_FROM_MISSING_QUADRANT)return!0;return!1}GetElapsedTime(){var e=this.Coordinates();if(0<e.length){var t=e[0],e=e[e.length-1];if(null!=t&&null!=e)return e=GetDateFromTicks(e.ticks).getTime()-GetDateFromTicks(t.ticks).getTime(),Math.floor(Math.abs(e/1e3))}return 0}GetDistanceTravelled(){let e=0;var t;let s=null;for(t of 0<this.NiceTourCoordinates().length?this.NiceTourCoordinates():this.Coordinates())null!=s&&(e+=Math.abs(t.Location.distanceTo(s.Location))),s=t;return e}GetElevationUp(){return this.GetElevation(1,0)}GetElevationDown(){return this.GetElevation(-1,0)}GetElevation(e,t){let s=0;return s=(s=0<this.NiceTourCoordinates().length?this.GetElevationFromCoordinates(this.NiceTourCoordinates(),e,t):s)<1?this.GetElevationFromCoordinates(this.Coordinates(),e,t):s}GetElevationFromCoordinates(e,s,a){let o=!1,i=0;if(null!=e){let t=null;for(var n of e)if(Math.abs(n.alt)>this.ALTITUDE_SEA_LEVEL&&n.alt!=this.ALTITUDE_UNKNOWN&&(o=!0),null==t)t=n;else if(Math.abs(t.alt)>this.ALTITUDE_SEA_LEVEL&&Math.abs(n.alt)>this.ALTITUDE_SEA_LEVEL&&t.alt!=this.ALTITUDE_UNKNOWN&&n.alt!=this.ALTITUDE_UNKNOWN){let e=!1;var r,l=n.alt-t.alt;0<a&&!(0<(r=Math.abs(t.Location.distanceTo(n.Location)))&&a<=Math.abs(l)/r*100)||(e=!0),(0==s||s<0&&l<0||0<s&&0<l)&&e&&(i+=Math.abs(l)),t=n}}return o?i:-1}GetEffectiveDistance(){let e=this.GetDistanceTravelled();var t=Math.floor(Math.max(this.GetElevation(1,0),0)/100),t=(1<=t&&(e+=1e3*t),Math.floor(Math.max(this.GetElevation(-1,20),0)/150));return 1<=t&&(e+=1e3*t),e}GetAverageSpeed(){let e=0;var t=this.GetElapsedTime(),s=this.GetDistanceTravelled();return e=0<t&&0<s?s/t*3.6:e}}class UserDetailViewModel extends BaseViewModel{constructor(e){super(),this.loginName=e,this.PhotoBlogs=ko.observableArray([]),this.PhotoBlogsPageSize=gnSettings.PhotoBlogsPageSize,this.PhotoBlogsLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMorePhotoBlogs=ko.observable(!0),this.PhotoBlogsRequestActive=ko.observable(!1),this.PhotoBlogsGroupValueTemp=ko.observable(0),this.PhotoBlogsGroupValue=ko.observable(0).extend({notify:"always"}),this.PhotoBlogsGroupCount=0,this.RequestUntilPhotoBlogsGroup=0,this.LoadNextGroupClicked=!1,this.LoadNextGroupRequestCount=0,this.PhotoBlogsGroupType=ko.observable(GroupTypeEnum.None),this.PhotoBlogsGroupTypeString=ko.computed(()=>this.PhotoBlogsGroupType()==GroupTypeEnum.ByDay?GetLangRes("Common_lblGroupTypeByDay","Group by day"):this.PhotoBlogsGroupType()==GroupTypeEnum.ByWeek?GetLangRes("Common_lblGroupTypeByWeek","Group by week"):this.PhotoBlogsGroupType()==GroupTypeEnum.ByMonth?GetLangRes("Common_lblGroupTypeByMonth","Group by month"):this.PhotoBlogsGroupType()==GroupTypeEnum.Custom?GetLangRes("Common_lblGroupTypeCustom","Smart group"):GetLangRes("Common_lblGroupTypeNone","No grouping")),this.PhotoBlogsGroupValueLabel=ko.computed(()=>60<=this.PhotoBlogsGroupValueTemp()?this.PhotoBlogsGroupValueTemp()/60+"h":1<=this.PhotoBlogsGroupValueTemp()?this.PhotoBlogsGroupValueTemp()+"min":GetLangRes("Common_lblNoGrouping","No Grouping")),this.PhotoBlogsScrollAutoLoad=ko.computed(()=>{var e=this.PhotoBlogsGroupType(),t=this.PhotoBlogsGroupValue();return e==GroupTypeEnum.None||e==GroupTypeEnum.Custom&&t<1}),this.PhotoBlogsStartTicksValue=ko.observable(window.MAX_DATE_TIME_TICKS),this.PhotoBlogsStartDate=ko.observable(""),this.ShareUrl=ko.pureComputed(()=>{let e=new Array;return 0<this.PhotoBlogsGroupValue()&&e.push("bg="+this.PhotoBlogsGroupValue()),this.PhotoBlogsStartTicksValue()!=window.MAX_DATE_TIME_TICKS&&e.push("bs="+this.PhotoBlogsStartTicksValue()),this.PhotoBlogsGroupType()!=GroupTypeEnum.None&&e.push("bgt="+this.PhotoBlogsGroupType()),this.NoseDto?this.NoseDto.ShareUrl()+(0<e.length?"?"+e.join("&"):""):""},this),this.Pois=ko.observableArray(),this.PoisPageSize=gnSettings.PoisPageSize,this.PoisLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMorePois=ko.observable(!0),this.PoisRequestActive=ko.observable(!1),this.Tours=ko.observableArray(),this.ToursPageSize=gnSettings.ToursPageSize,this.ToursLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreTours=ko.observable(!0),this.ToursRequestActive=ko.observable(!1),this.Events=ko.observableArray(),this.EventsPageSize=gnSettings.EventsPageSize,this.EventsLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreEvents=ko.observable(!0),this.EventsRequestActive=ko.observable(!1),this.PhotoBlogsRequestActive.subscribe(e=>{ShowPreviewPageLoad(e)}),this.PoisRequestActive.subscribe(e=>{ShowPreviewPageLoad(e)}),this.ToursRequestActive.subscribe(e=>{ShowPreviewPageLoad(e)}),this.NoseDto=new NoseDto({LoginName:this.loginName}),this.PhotoBlogsGroupType.subscribe(e=>{e!=GroupTypeEnum.Custom?(this.PhotoBlogsStartDate(""),this.PhotoBlogsGroupValue(0)):this.UpdatePhotoBlogGroup()}),this.PhotoBlogsGroupValue.subscribe(e=>{this.PhotoBlogsGroupValueTemp(e),this.UpdatePhotoBlogGroup()}),this.PhotoBlogsStartTicksValue.subscribe(e=>{this.PhotoBlogsLastKnownTicks=e,this.PhotoBlogs.removeAll(),this.HasMorePhotoBlogs(!0),this.PageBlogs()}),this.PhotoBlogsStartDate.subscribe(e=>{e?(e=moment(e).tz("UTC").add(1,"d").startOf("day").toDate(),e=GetTicksFromDate(e),this.PhotoBlogsStartTicksValue(e)):this.PhotoBlogsStartTicksValue(window.MAX_DATE_TIME_TICKS)})}LengthBasedContent(e){return e?200<e.length?"<p>"+this.GetHtmlFromString(e)+"</p>":100<e.length?'<h5 class="text-center">'+this.GetHtmlFromString(e)+"</h5>":50<e.length?'<h4 class="text-center">'+this.GetHtmlFromString(e)+"</h4>":'<h3 class="text-center">'+this.GetHtmlFromString(e)+"</h3>":""}UpdatePhotoBlogsGroupValue(e,t){var s=0,s=e<15?e:e<18?15+15*(e-15):60+60*(e-18);t?this.PhotoBlogsGroupValue(s):this.PhotoBlogsGroupValueTemp(s)}GetPhotoBlogsGroupSliderVal(e){return e<=15?e:e<=60?(e-15)/15+15:(e-60)/60+18}OnUpdatePhotoBlogGroup(){}UpdatePhotoBlogGroup(){let a=0,o=0,i,n,r=this.PhotoBlogsGroupValue(),l=new BigNumber(r).multiply(6e8);ko.utils.arrayForEach(this.PhotoBlogs(),(s,e)=>{s.GroupType(this.PhotoBlogsGroupType()),s.IsLastIncompleteGroup(!1);var t=new BigNumber(s.CreationTicks);new BigNumber(this.PhotoBlogsStartTicksValue());if(this.PhotoBlogsScrollAutoLoad()&&this.PhotoBlogsGroupValue()<1&&this.PhotoBlogsStartTicksValue()==window.MAX_DATE_TIME_TICKS)o++,s.IsGrouped(!1),s.GroupCount(1),s.GroupName("");else if(this.PhotoBlogsGroupType()==GroupTypeEnum.Custom)a=5,0<r?(void 0!==i&&-1==n.subtract(t).compare(l)?(s.IsGrouped(!0),i.GroupCount(i.GroupCount()+1)):(o++,(i=s).IsGrouped(!1),i.GroupCount(1)),n=new BigNumber(s.CreationTicks),s.GroupName(i.CreationTicks)):(o++,s.IsGrouped(!1),s.GroupCount(1),s.GroupName(""));else if(a=this.PhotoBlogsGroupType()==GroupTypeEnum.ByWeek?4:this.PhotoBlogsGroupType()==GroupTypeEnum.ByMonth?3:5,void 0===i)o++,(i=s).IsGrouped(!1),i.GroupCount(1),i.GroupName(s.CreationTicks);else{let e=GetDateFromTicks(i.CreationTicks),t=GetDateFromTicks(s.CreationTicks);this.PhotoBlogsGroupType()==GroupTypeEnum.ByDay&&e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()||this.PhotoBlogsGroupType()==GroupTypeEnum.ByWeek&&moment(e).week()==moment(t).week()||this.PhotoBlogsGroupType()==GroupTypeEnum.ByMonth&&e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()?(s.IsGrouped(!0),i.GroupCount(i.GroupCount()+1)):(o++,(i=s).IsGrouped(!1),i.GroupCount(1)),s.GroupName(i.CreationTicks)}i&&(e===this.PhotoBlogs().length-1&&this.HasMorePhotoBlogs()&&!this.PhotoBlogsScrollAutoLoad()?i.IsLastIncompleteGroup(!0):i.IsLastIncompleteGroup(!1))}),this.PhotoBlogsGroupCount=o,!this.PhotoBlogsScrollAutoLoad()&&o<Math.max(a,this.RequestUntilPhotoBlogsGroup)&&this.HasMorePhotoBlogs()&&this.PageBlogs(),this.OnUpdatePhotoBlogGroup&&this.OnUpdatePhotoBlogGroup()}OnAddPhotoBlogs(e){}AddPhotoBlogs(e){if(null!=e){if(0<e.length){this.PhotoBlogsLastKnownTicks=e[e.length-1].CreationTicks;for(var t of e)this.PhotoBlogs.push(new PhotoBlogDto(t));e.length%this.PhotoBlogsPageSize!=0&&this.HasMorePhotoBlogs(!1)}else this.HasMorePhotoBlogs(!1);this.UpdatePhotoBlogGroup(),this.OnAddPhotoBlogs&&this.OnAddPhotoBlogs(e)}}PageBlogs(){if(this.LoadNextGroupClicked){if(10<this.LoadNextGroupRequestCount)return this.LoadNextGroupClicked=!1,void(this.LoadNextGroupRequestCount=0);this.LoadNextGroupRequestCount++}!this.PhotoBlogsRequestActive()&&this.HasMorePhotoBlogs()&&(this.PhotoBlogsRequestActive(!0),jQuery.ajax({type:"POST",url:"/Nose/Page_Blogs",cache:!1,data:{loginName:this.loginName,lastKnownBlogTicks:this.PhotoBlogsLastKnownTicks,pageSize:this.PhotoBlogsPageSize},dataType:"json",success:e=>{this.PhotoBlogsRequestActive(!1),"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddPhotoBlogs(e):this.HasMorePhotoBlogs(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.PhotoBlogsRequestActive(!1)}}))}LoadNextGroup(){this.LoadNextGroupClicked=!0,this.LoadNextGroupRequestCount=0,this.RequestUntilPhotoBlogsGroup=this.PhotoBlogsGroupCount+1,this.UpdatePhotoBlogGroup()}OnAddPois(e){}AddPois(e){if(null!=e){if(0<e.length){this.PoisLastKnownTicks=e[e.length-1].CreationTicks;for(var t of e)this.Pois.push(new PoiDto(t));e.length%this.PoisPageSize!=0&&this.HasMorePois(!1)}else this.HasMorePois(!1);this.OnAddPois&&this.OnAddPois(e)}}PagePois(){!this.PoisRequestActive()&&this.HasMorePois()&&(this.PoisRequestActive(!0),jQuery.ajax({type:"POST",url:"/Nose/Page_PoIs",cache:!1,data:{loginName:this.loginName,lastKnownPoITicks:this.PoisLastKnownTicks,pageSize:this.PoisPageSize},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddPois(e):this.HasMorePois(!1),this.PoisRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.PoisRequestActive(!1)}}))}OnAddTours(e){}AddTours(e){if(null!=e){if(0<e.length){this.ToursLastKnownTicks=e[e.length-1].CreationTicks;for(var t of e)this.Tours.push(new TourDto(t));e.length%this.ToursPageSize!=0&&this.HasMoreTours(!1)}else this.HasMoreTours(!1);this.OnAddTours&&this.OnAddTours(e)}}PageTours(){!this.ToursRequestActive()&&this.HasMoreTours()&&(this.ToursRequestActive(!0),jQuery.ajax({type:"POST",url:"/Nose/Page_Tours",cache:!1,data:{loginName:this.loginName,lastKnownTourTicks:this.ToursLastKnownTicks,pageSize:this.ToursPageSize},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddTours(e):this.HasMoreTours(!1),this.ToursRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.ToursRequestActive(!1)}}))}OnAddEvents(e){}AddEvents(e){if(null!=e){if(0<e.length){this.EventsLastKnownTicks=e[e.length-1].CreationTicks;for(var t of e)this.Events.push(new EventDto(t));e.length%this.EventsPageSize!=0&&this.HasMoreEvents(!1)}else this.HasMoreEvents(!1);this.OnAddEvents&&this.OnAddEvents(e)}}PageEvents(){!this.EventsRequestActive()&&this.HasMoreEvents()&&(this.EventsRequestActive(!0),jQuery.ajax({type:"POST",url:"/Nose/Page_Events",cache:!1,data:{loginName:this.loginName,lastKnownEventTicks:this.EventsLastKnownTicks,pageSize:this.EventsPageSize},dataType:"json",success:e=>{"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?this.AddEvents(e):this.HasMoreEvents(!1),this.EventsRequestActive(!1)},error:e=>{429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),this.EventsRequestActive(!1)}}))}}