var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),BaseViewModel=function(){this.GetQrCodeUrl=function(e){return gnSettings.BaseUrl+"/Components/QrCode?tag="+encodeURIComponent(e)},this.getLoginUrl=function(e){return(e||"/Account/Login")+"?returnUrl="+encodeURIComponent("/"+window.location.href.replace(/^(?:\/\/|[^\/]+)*\//,""))}},BaseComponentsViewModel=function(e){this.getLoginUrl=function(e){return(e||"/Account/Login")+"?returnUrl="+encodeURIComponent("/"+window.location.href.replace(/^(?:\/\/|[^\/]+)*\//,""))},this.imagePath=ko.observable(e||"/Content/Mashup/Images")},MAX_DATE_TIME_TICKS="3155378975999999999";ko.bindingHandlers.modal={init:function(e,t){$(e).modal({show:!1});var o=t();"function"==typeof o&&$(e).on("hide.bs.modal",function(){o(!1)}),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){$(e).modal("destroy")})},update:function(e,t){var o=t();ko.utils.unwrapObservable(o)?$(e).modal("show"):$(e).modal("hide")}},ko.bindingHandlers.enterkey={init:function(t,e,o,n){var a=e();$(t).keypress(function(e){return 13!==(e.which?e.which:e.keyCode)||($(t).blur(),a.call(n),!1)})}},ko.bindingHandlers.bsChecked={init:function(e,t,o,n,a){var i=t(),s=null;o.has("checkedValue")?s=ko.utils.unwrapObservable(o.get("checkedValue")):o.has("value")&&(s=ko.utils.unwrapObservable(o.get("value")));ko.bindingHandlers.event.init(e,function(){return{change:function(){i(s)}}},o,n,a)},update:function(e,t,o,n,a){$(e).val()==ko.unwrap(t())&&setTimeout(function(){$(e).closest(".btn").button("toggle")},10)}},ko.bindingHandlers.fancyboxAttr={update:function(e,t,o,n,a){var i=t(),s=o.get("group")||"",r=o.get("external");o.get("disabled");if(!o.get("disabled"))if(r)$(e).attr("data-external",""),$(e).attr("href",i.detailUrl());else{$(e).attr("data-fancybox",s);var l=o.get("fancyboxType");l&&$(e).attr("data-type",l),$(e).attr("data-src")||$(e).attr("data-src",i.previewUrl())}}};var GroupTypeEnum,CoordinateTypeEnum,CommentItemType,CommunityAcl,NewsType,CommunityDetailViewModel=function(o){function e(e,t){var n=o.call(this)||this;return n.displayName=function(){return new KeywordDto(n.TagName).getHtml()},n.membersPageUrl="/Community/Page_Members",n.members=ko.observableArray(),n.membersPageSize=gnSettings.CommunityMembersPageSize,n.membersLastJoinTicks=MAX_DATE_TIME_TICKS,n.hasMoreMembers=ko.observable(!0),n.membersRequestActive=ko.observable(!1),n.onAddMembers=function(e){},n.addMembers=function(e){if(null!=e){if(0<e.length){for(var t in n.membersLastJoinTicks=e[e.length-1].JoinTicks,e){var o=new CommunityMemberDto(e[t]);o.IsAdmin=o.LoginName==n.Entity.CreatorLoginName||n.Entity.Admins&&-1!=$.inArray(o.LoginName,n.Entity.Admins),n.members.push(o)}e.length%n.membersPageSize!=0&&n.hasMoreMembers(!1)}else n.hasMoreMembers(!1);n.onAddMembers&&n.onAddMembers(e)}},n.pageMembers=function(){!n.membersRequestActive()&&n.hasMoreMembers()&&(n.membersRequestActive(!0),$.ajax({type:"POST",url:n.membersPageUrl,cache:!1,data:{lastKnownTicks:n.membersLastJoinTicks,profileTag:n.TagName,pageSize:n.membersPageSize},dataType:"json",success:function(e){e&&0<e.length?n.addMembers(e):n.hasMoreMembers(!1),n.membersRequestActive(!1)},error:function(e){429!=e.status&&dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),n.membersRequestActive(!1)}}))},n.membersRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),n.TagName=e.TagName,n.NoseDto=new NoseDto({LoginName:e.CreatorLoginName}),n.Entity=new CommunityDto(e,t),n}return __extends(e,o),e}(BaseViewModel);!function(e){e[e.None=0]="None",e[e.ByDay=1]="ByDay",e[e.ByWeek=2]="ByWeek",e[e.ByMonth=3]="ByMonth",e[e.ByYear=4]="ByYear",e[e.Custom=5]="Custom"}(GroupTypeEnum||(GroupTypeEnum={})),function(e){e[e.touch=0]="touch",e[e.poi=1]="poi",e[e.blog=2]="blog"}(CoordinateTypeEnum||(CoordinateTypeEnum={})),function(e){e[e.PhotoBlog=1]="PhotoBlog",e[e.FavoriteLocation=2]="FavoriteLocation",e[e.Tour=3]="Tour",e[e.Event=4]="Event",e[e.Community=5]="Community"}(CommentItemType||(CommentItemType={})),function(e){e[e.NoOptions=0]="NoOptions",e[e.ListMembers=1]="ListMembers",e[e.MembersInviteMembers=2]="MembersInviteMembers",e[e.CommentsFromMembers=4]="CommentsFromMembers"}(CommunityAcl||(CommunityAcl={})),function(e){e[e.Unknown=0]="Unknown",e[e.NewGuestUser=1]="NewGuestUser",e[e.ProfileActivated=2]="ProfileActivated",e[e.ProfileAbout=3]="ProfileAbout",e[e.ProfileImage=4]="ProfileImage",e[e.Comment=5]="Comment",e[e.Rating=6]="Rating",e[e.PhotoBlog=7]="PhotoBlog",e[e.PoI=8]="PoI",e[e.Tour=9]="Tour",e[e.Event=10]="Event",e[e.Mashup=11]="Mashup"}(NewsType||(NewsType={}));var EventDetailViewModel=function(t){function e(e){var o=t.call(this)||this;return o.possibleDates=ko.observableArray(),o.onAddPossibleDates=function(e){},o.addPossibleDates=function(e){if(null!=e){for(var t in e)o.possibleDates.push(new EventDateDto(t,e[t]));o.onAddPossibleDates&&o.onAddPossibleDates(o.possibleDates())}},o.UniqueKey=e.UniqueKey||"",o.LoginName=GetLoginNameFromUniqueKey(o.UniqueKey),o.CreationTicks=GetTicksFromUniqueKey(o.UniqueKey),o.Entity=new EventDto({UniqueKey:o.UniqueKey}),o.NoseDto=new NoseDto({LoginName:o.LoginName}),o}return __extends(e,t),e}(BaseViewModel),IndexViewModel=function(e){function t(){var o=e.call(this)||this;return o.communityTag=ko.observable(""),o.nosePageUrl="/Home/Page_Noses",o.noses=ko.observableArray(),o.nosesPageSize=gnSettings.NosesPageSize,o.nosesLastKnownTicks=MAX_DATE_TIME_TICKS,o.hasMoreNoses=ko.observable(!0),o.nosesRequestActive=ko.observable(!1),o.showNoses=ko.observable(!0),o.onAddNoses=function(){},o.addNoses=function(e){if(null!=e){if(0<e.length){for(var t in o.nosesLastKnownTicks=e[e.length-1].CreationTicks,e)o.noses.push(new NoseDto(e[t]));e.length%o.nosesPageSize!=0&&o.hasMoreNoses(!1)}else o.hasMoreNoses(!1);o.onAddNoses&&o.onAddNoses()}},o.pageNoses=function(){o.showNoses()&&!o.nosesRequestActive()&&o.hasMoreNoses()&&(o.nosesRequestActive(!0),$.ajax({type:"POST",url:o.nosePageUrl,cache:!1,data:{lastKnownTicks:o.nosesLastKnownTicks,pageSize:o.nosesPageSize,community:o.communityTag()},dataType:"json",success:function(e){e&&0<e.length?o.addNoses(e):o.hasMoreNoses(!1),o.nosesRequestActive(!1)},error:function(e){429!=e.status&&dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),o.nosesRequestActive(!1)}}))},o.newsPageUrl="/Home/Page_News",o.news=ko.observableArray(),o.newsPageSize=gnSettings.NewsPageSize,o.newsLastKnownTicks=MAX_DATE_TIME_TICKS,o.hasMoreNews=ko.observable(!0),o.newsRequestActive=ko.observable(!1),o.showNews=ko.observable(!0),o.onAddNews=function(){},o.addNews=function(e){if(null!=e){if(0<e.length){for(var t in o.newsLastKnownTicks=e[e.length-1].CreationTicks,e)o.news.push(new NewsDto(e[t]));e.length%o.newsPageSize!=0&&o.hasMoreNews(!1)}else o.hasMoreNews(!1);o.onAddNews&&o.onAddNews()}},o.pageNews=function(){o.showNews()&&!o.newsRequestActive()&&o.hasMoreNews()&&(o.newsRequestActive(!0),$.ajax({type:"POST",url:o.newsPageUrl,cache:!1,data:{lastKnownTicks:o.newsLastKnownTicks,pageSize:o.nosesPageSize,community:o.communityTag()},dataType:"json",success:function(e){e&&0<e.length?o.addNews(e):o.hasMoreNews(!1),o.newsRequestActive(!1)},error:function(e){429!=e.status&&dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),o.newsRequestActive(!1)}}))},o.nosesRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),o.newsRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),o.communityEntity=new CommunityDto({},new NoseDto({})),o.communityTag.subscribe(function(e){o.communityEntity=new CommunityDto({TagName:e},new NoseDto({}))}),o}return __extends(t,e),t}(BaseViewModel),NearbyViewModel=function(n){function e(e,t){var o=n.call(this)||this;return o.displayName=function(){return new KeywordDto(o.TagName).getHtml()},o.TagName=e.TagName,o.NoseDto=new NoseDto({LoginName:e.CreatorLoginName}),o.Entity=new CommunityDto(e,t),o.pageableNoses=new PageableItem(e.TagName,"/Nearby/Noses",gnSettings.NearbyNosesPageSize,function(e){var t=new NoseDto(e);return t.IsAdmin=t.LoginName==o.Entity.CreatorLoginName||o.Entity.Admins&&-1!=$.inArray(t.LoginName,o.Entity.Admins),t}),o.pageablePois=new PageableItem(e.TagName,"/Nearby/Pois",gnSettings.NearbyPoisPageSize,function(e){return new PoiDto(e)}),o.pageableImpressions=new PageableItem(e.TagName,"/Nearby/Impressions",gnSettings.NearbyImpressionsPageSize,function(e){return new PhotoBlogDto(e)}),o.pageableTracks=new PageableItem(e.TagName,"/Nearby/Tracks",gnSettings.NearbyToursPageSize,function(e){return new TourDto(e)}),o.pageableEvents=new PageableItem(e.TagName,"/Nearby/Events",gnSettings.NearbyEventsPageSize,function(e){return new EventDto(e)}),o}return __extends(e,n),e}(BaseViewModel),PhotoBlogDetailViewModel=function(o){function e(e){var t=o.call(this)||this;return t.Tour=null,t.setTourById=function(e){t.Tour=new TourDto({UniqueKey:e})},t.UniqueKey=e||"",t.LoginName=GetLoginNameFromUniqueKey(t.UniqueKey),t.CreationTicks=GetTicksFromUniqueKey(t.UniqueKey),t.Entity=new PhotoBlogDto({UniqueKey:t.UniqueKey}),t.NoseDto=new NoseDto({LoginName:t.LoginName}),t}return __extends(e,o),e}(BaseViewModel),PoiDetailViewModel=function(o){function e(e){var t=o.call(this)||this;return t.Tour=null,t.setTourById=function(e){t.Tour=new TourDto({UniqueKey:e})},t.UniqueKey=e||"",t.LoginName=GetLoginNameFromUniqueKey(t.UniqueKey),t.CreationTicks=GetTicksFromUniqueKey(t.UniqueKey),t.Entity=new PoiDto({UniqueKey:t.UniqueKey}),t.NoseDto=new NoseDto({LoginName:t.LoginName}),t}return __extends(e,o),e}(BaseViewModel),TourDetailViewModel=function(s){function e(e){var m=s.call(this)||this;if(m.ALTITUDE_UNKNOWN=32768,m.ALTITUDE_FROM_MISSING_QUADRANT=32769,m.ALTITUDE_SEA_LEVEL=.001,m.currentTourIndex=ko.observable(-1),m.tourItems=ko.observableArray([]),m.coordinates=ko.observableArray([]),m.niceTourCoordinates=ko.observableArray([]),m.elevationMax=ko.observable(0),m.elevationMaxString=ko.computed(function(){return 0!=m.elevationMax()?Math.round(m.elevationMax())+"m":""}),m.elevationMin=ko.observable(0),m.elevationMinString=ko.computed(function(){return 0!=m.elevationMin()?Math.round(m.elevationMin())+"m":""}),m.metaElapsedTime=ko.observable(0),m.metaDistanceTravelled=ko.observable(0),m.metaAverageSpeed=ko.observable(0),m.metaElevationUp=ko.observable(0),m.metaElevationDown=ko.observable(0),m.metaEffectiveDistance=ko.observable(0),m.updateMetaInformations=function(){m.metaElapsedTime(m.getElapsedTime()),m.metaDistanceTravelled(m.getDistanceTravelled()),m.metaAverageSpeed(m.getAverageSpeed()),m.metaElevationUp(m.getElevationUp()),m.metaElevationDown(m.getElevationDown()),m.metaEffectiveDistance(m.getEffectiveDistance())},m.coordinateRequestActive=ko.observable(!1),m.onLoadCoordinates=function(){},m.loadCoordinates=function(){m.coordinateRequestActive()||(m.coordinateRequestActive(!0),$.ajax({type:"GET",url:"/Tour/Coordinates",cache:!1,data:{id:m.UniqueKey},dataType:"json",success:function(e){if(e)for(var t=0,o=e;t<o.length;t++){var n=o[t],a=new Coordinate(n);a.type==CoordinateTypeEnum.touch&&m.coordinates.push(a)}m.DrawElevation(),m.onLoadCoordinates(),m.updateMetaInformations(),m.coordinateRequestActive(!1)},error:function(){dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorLoadCoordinates","Coordinates cannot be loaded!"),null),m.coordinateRequestActive(!1)}}))},m.cWidth=3e3,m.cHeight=1e3,m.cMargin=5,m.elevationCanvasIdentifier=ko.observable(null),m.elevationMousemoveIndex=ko.observable(-1),m.elevationClickedIndex=ko.observable(-1),m.onElevationMouseMove=function(e){},m.onElevationMouseOut=function(){},m.onElevationClick=function(e){},m.getElapsedTime=function(){var e=m.coordinates();if(0<e.length){var t=e[0],o=e[e.length-1];if(null!=t&&null!=o){var n=GetDateFromTicks(o.ticks).getTime()-GetDateFromTicks(t.ticks).getTime();return Math.floor(Math.abs(n/1e3))}}return 0},m.getDistanceTravelled=function(){for(var e=0,t=null,o=0,n=0<m.niceTourCoordinates().length?m.niceTourCoordinates():m.coordinates();o<n.length;o++){var a=n[o];null!=t&&(e+=Math.abs(a.location.distanceTo(t.location))),t=a}return e},m.getElevationUp=function(){return m.getElevation(1,0)},m.getElevationDown=function(){return m.getElevation(-1,0)},m.getElevation=function(e,t){var o=0;return 0<m.niceTourCoordinates().length&&(o=m.getElevationFromCoordinates(m.niceTourCoordinates(),e,t)),o<1&&(o=m.getElevationFromCoordinates(m.coordinates(),e,t)),o},m.getElevationFromCoordinates=function(e,t,o){var n=!1,a=0;if(null!=e)for(var i=null,s=0,r=e;s<r.length;s++){var l=r[s];if(Math.abs(l.alt)>m.ALTITUDE_SEA_LEVEL&&l.alt!=m.ALTITUDE_UNKNOWN&&(n=!0),null==i)i=l;else if(Math.abs(i.alt)>m.ALTITUDE_SEA_LEVEL&&Math.abs(l.alt)>m.ALTITUDE_SEA_LEVEL&&i.alt!=m.ALTITUDE_UNKNOWN&&l.alt!=m.ALTITUDE_UNKNOWN){var d=!1,c=l.alt-i.alt;if(0<o){var u=Math.abs(i.location.distanceTo(l.location));if(0<u)o<=Math.abs(c)/u*100&&(d=!0)}else d=!0;(0==t||t<0&&c<0||0<t&&0<c)&&d&&(a+=Math.abs(c)),i=l}}return n?a:-1},m.getEffectiveDistance=function(){var e=m.getDistanceTravelled(),t=Math.floor(Math.max(m.getElevation(1,0),0)/100);1<=t&&(e+=1e3*t);var o=Math.floor(Math.max(m.getElevation(-1,20),0)/150);return 1<=o&&(e+=1e3*o),e},m.getAverageSpeed=function(){var e=0,t=m.getElapsedTime(),o=m.getDistanceTravelled();return 0<t&&0<o&&(e=o/t*3.6),e},m.UniqueKey=e.UniqueKey||"",m.LoginName=GetLoginNameFromUniqueKey(m.UniqueKey),m.CreationTicks=GetTicksFromUniqueKey(m.UniqueKey),m.Entity=e,m.NoseDto=new NoseDto({LoginName:m.LoginName}),m.elevationMousemoveIndex.subscribe(function(e){m.DrawElevation()}),m.elevationClickedIndex.subscribe(function(e){m.DrawElevation()}),m.Entity&&m.Entity.GeoData){var t=m.Entity.GeoData,o=new Array;for(var n in t){var a=t[n];if(a.properties&&a.geometry){var i={UniqueKey:a.properties.identifier,Latitude:a.geometry.coordinates[1],Longitude:a.geometry.coordinates[0]};"poi"==a.properties.type?o.push(new PoiDto(i)):"blog"==a.properties.type&&o.push(new PhotoBlogDto(i))}}ko.utils.arrayPushAll(m.tourItems(),o.sort(function(e,t){return e.CreationTicks<t.CreationTicks?-1:e.CreationTicks>t.CreationTicks?1:0}))}return m}return __extends(e,s),e.prototype.DrawElevation=function(){var t=this,e=this.elevationCanvasIdentifier()||"",o=$(e)[0];if(o.getContext){o.width=this.cWidth+2*this.cMargin,o.height=this.cHeight+2*this.cMargin;var n=o.getContext("2d");n.fillStyle="#eeeeee",n.rect(this.cMargin,this.cMargin,this.cWidth,this.cHeight),n.fill(),n.lineWidth=10,n.strokeStyle="#dddddd",n.stroke();for(var a=this.getDistanceTravelled(),i=this.AnyCoordinatesWithAlt(this.niceTourCoordinates())?this.niceTourCoordinates():this.coordinates(),s=i[0].ticks,r=this.ALTITUDE_UNKNOWN,l=0,d=0,c=i;d<c.length;d++){r>(f=c[d]).alt&&0!=f.alt&&(r=f.alt),l<f.alt&&f.alt!=this.ALTITUDE_UNKNOWN&&f.alt!=this.ALTITUDE_FROM_MISSING_QUADRANT&&(l=f.alt)}this.elevationMin(r),this.elevationMax(l);for(var u=Math.floor(r/100)+1;u<Math.floor(l/100);u++){var m=this.cHeight/Math.abs(l-r),g=this.cHeight-(100*u-r)*m;n.beginPath(),n.moveTo(this.cMargin,g+this.cMargin),n.lineTo(this.cWidth+this.cMargin,g+this.cMargin),n.lineWidth=5,n.strokeStyle="#dddddd",n.stroke()}n.beginPath();var h=null,p=0,v=-1,b=-1,y=-1;for(u=0;u<i.length;u++){var f=i[u],C=this.cMargin;null!=h&&(0!=f.alt&&f.alt!=this.ALTITUDE_UNKNOWN||(f.alt=h.alt),p+=Math.abs(f.location.distanceTo(h.location)),C+=this.cWidth/a*p,f.ageString=GetAgeString(s,f.ticks,!0,!0));var T=this.cHeight-this.cHeight/(l-r)*(f.alt-r)+this.cMargin;null!=h?n.lineTo(C,T):n.moveTo(C,T),u==this.elevationClickedIndex()&&(v=C,b=T,f.alt),u==this.elevationMousemoveIndex()&&(y=C,T,f.alt),f.distance=p,f.percentageX=0<p?p/a:0,h=f}n.lineWidth=20,n.strokeStyle="#ff0000",n.stroke(),0<=y&&this.DrawVerticalLine(n,y,-1,"#0077dd","#ffff00"),0<=v&&this.DrawVerticalLine(n,v,b,"#ff0000","#ffff00"),$(e).off(),$(e).on("mouseout",function(e){t.onElevationMouseOut(),t.elevationMousemoveIndex(-1)}),$(e).on("mousemove",function(e){t.handleElevationEvent(i,e)}),$(e).on("click",function(e){t.handleElevationEvent(i,e)})}},e.prototype.DrawVerticalLine=function(e,t,o,n,a){e.beginPath(),e.moveTo(t,this.cMargin),e.lineTo(t,this.cHeight+this.cMargin),e.lineWidth=10,e.strokeStyle=n,e.stroke(),0<=o&&(e.beginPath(),e.arc(t,o,30,0,2*Math.PI,!0),e.lineWidth=20,e.strokeStyle=n,e.stroke(),e.fillStyle=a,e.fill())},e.prototype.handleElevationEvent=function(e,t){t.preventDefault(),t.stopPropagation();var o=t.type;try{for(var n=-1,a=(t.clientX-$(t.target).offset().left)/$(t.target).width(),i=1e4,s=0;s<e.length;s++){var r=e[s],l=Math.abs(a-r.percentageX);l<i&&(i=l,n=s)}if(0<=n){var d=e[n];"click"==o?(this.elevationClickedIndex(n),this.onElevationClick(d)):"mousemove"==o&&(this.elevationMousemoveIndex(n),this.onElevationMouseMove(d))}}catch(t){console&&console.log(t)}},e.prototype.AnyCoordinatesWithAlt=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];if(n.alt!=this.ALTITUDE_UNKNOWN&&n.alt!=this.ALTITUDE_FROM_MISSING_QUADRANT)return!0}return!1},e}(BaseViewModel),UserDetailViewModel=function(t){function e(e){var u=t.call(this)||this;return u.loginName=e,u.lengthBasedContent=function(e){return e?200<e.length?"<p>"+e+"</p>":100<e.length?'<h5 class="text-center">'+e+"</h5>":50<e.length?'<h4 class="text-center">'+e+"</h4>":'<h3 class="text-center">'+e+"</h3>":""},u.photoBlogs=ko.observableArray([]),u.photoBlogsPageSize=gnSettings.PhotoBlogsPageSize,u.photoBlogsLastKnownTicks=MAX_DATE_TIME_TICKS,u.hasMorePhotoBlogs=ko.observable(!0),u.photoBlogsRequestActive=ko.observable(!1),u.photoBlogsGroupValueTemp=ko.observable(0),u.photoBlogsGroupValue=ko.observable(0).extend({notify:"always"}),u.photoBlogsGroupCount=0,u.requestUntilPhotoBlogsGroup=0,u.loadNextGroupClicked=!1,u.loadNextGroupRequestCount=0,u.photoBlogsGroupType=ko.observable(GroupTypeEnum.None),u.photoBlogsGroupTypeString=ko.computed(function(){return u.photoBlogsGroupType()==GroupTypeEnum.ByDay?GetLangRes("Common_lblGroupTypeByDay","Group by day"):u.photoBlogsGroupType()==GroupTypeEnum.ByWeek?GetLangRes("Common_lblGroupTypeByWeek","Group by week"):u.photoBlogsGroupType()==GroupTypeEnum.ByMonth?GetLangRes("Common_lblGroupTypeByMonth","Group by month"):u.photoBlogsGroupType()==GroupTypeEnum.Custom?GetLangRes("Common_lblGroupTypeCustom","Smart group"):GetLangRes("Common_lblGroupTypeNone","No grouping")}),u.photoBlogsGroupValueLabel=ko.computed(function(){return 60<=u.photoBlogsGroupValueTemp()?u.photoBlogsGroupValueTemp()/60+"h":1<=u.photoBlogsGroupValueTemp()?u.photoBlogsGroupValueTemp()+"min":GetLangRes("Common_lblNoGrouping","No Grouping")}),u.updatePhotoBlogsGroupValue=function(e,t){var o=0;o=e<15?e:e<18?15+15*(e-15):60+60*(e-18),t?u.photoBlogsGroupValue(o):u.photoBlogsGroupValueTemp(o)},u.getPhotoBlogsGroupSliderVal=function(e){return e<=15?e:e<=60?(e-15)/15+15:(e-60)/60+18},u.onUpdatePhotoBlogGroup=function(){},u.updatePhotoBlogGroup=function(){var i,s,r=0,l=0,d=u.photoBlogsGroupValue(),c=new BigNumber(d).multiply(6e8);ko.utils.arrayForEach(u.photoBlogs(),function(e,t){e.groupType(u.photoBlogsGroupType()),e.isLastIncompleteGroup(!1);var o=new BigNumber(e.CreationTicks);new BigNumber(u.photoBlogsStartTicksValue());if(u.photoBlogsScrollAutoLoad()&&u.photoBlogsGroupValue()<1&&u.photoBlogsStartTicksValue()==MAX_DATE_TIME_TICKS)l++,e.isGrouped(!1),e.groupCount(1),e.groupName("");else if(u.photoBlogsGroupType()==GroupTypeEnum.Custom)if(r=5,0<d){if(void 0===i)l++,(i=e).isGrouped(!1),i.groupCount(1);else-1==s.subtract(o).compare(c)?(e.isGrouped(!0),i.groupCount(i.groupCount()+1)):(l++,(i=e).isGrouped(!1),i.groupCount(1));s=new BigNumber(e.CreationTicks),e.groupName(i.CreationTicks)}else l++,e.isGrouped(!1),e.groupCount(1),e.groupName("");else if(r=u.photoBlogsGroupType()==GroupTypeEnum.ByWeek?4:u.photoBlogsGroupType()==GroupTypeEnum.ByMonth?3:5,void 0===i)l++,(i=e).isGrouped(!1),i.groupCount(1),i.groupName(e.CreationTicks);else{var n=GetDateFromTicks(i.CreationTicks),a=GetDateFromTicks(e.CreationTicks);u.photoBlogsGroupType()==GroupTypeEnum.ByDay&&n.getFullYear()==a.getFullYear()&&n.getMonth()==a.getMonth()&&n.getDate()==a.getDate()||u.photoBlogsGroupType()==GroupTypeEnum.ByWeek&&moment(n).week()==moment(a).week()||u.photoBlogsGroupType()==GroupTypeEnum.ByMonth&&n.getFullYear()==a.getFullYear()&&n.getMonth()==a.getMonth()?(e.isGrouped(!0),i.groupCount(i.groupCount()+1)):(l++,(i=e).isGrouped(!1),i.groupCount(1)),e.groupName(i.CreationTicks)}i&&(t===u.photoBlogs().length-1&&u.hasMorePhotoBlogs()&&!u.photoBlogsScrollAutoLoad()?i.isLastIncompleteGroup(!0):i.isLastIncompleteGroup(!1))}),u.photoBlogsGroupCount=l,!u.photoBlogsScrollAutoLoad()&&l<Math.max(r,u.requestUntilPhotoBlogsGroup)&&u.hasMorePhotoBlogs()&&u.pageBlogs(),u.onUpdatePhotoBlogGroup&&u.onUpdatePhotoBlogGroup()},u.photoBlogsScrollAutoLoad=ko.computed(function(){var e=u.photoBlogsGroupType(),t=u.photoBlogsGroupValue();return e==GroupTypeEnum.None||e==GroupTypeEnum.Custom&&t<1}),u.photoBlogsStartTicksValue=ko.observable(MAX_DATE_TIME_TICKS),u.photoBlogsStartDate=ko.observable(""),u.shareUrl=ko.pureComputed(function(){var e=new Array;return 0<u.photoBlogsGroupValue()&&e.push("bg="+u.photoBlogsGroupValue()),u.photoBlogsStartTicksValue()!=MAX_DATE_TIME_TICKS&&e.push("bs="+u.photoBlogsStartTicksValue()),u.photoBlogsGroupType()!=GroupTypeEnum.None&&e.push("bgt="+u.photoBlogsGroupType()),u.NoseDto?u.NoseDto.shareUrl()+(0<e.length?"?"+e.join("&"):""):""},u),u.onAddPhotoBlogs=function(e){},u.addPhotoBlogs=function(e){if(null!=e){if(0<e.length){u.photoBlogsLastKnownTicks=e[e.length-1].CreationTicks;for(var t=0,o=e;t<o.length;t++){var n=o[t];u.photoBlogs.push(new PhotoBlogDto(n))}e.length%u.photoBlogsPageSize!=0&&u.hasMorePhotoBlogs(!1)}else u.hasMorePhotoBlogs(!1);u.updatePhotoBlogGroup(),u.onAddPhotoBlogs&&u.onAddPhotoBlogs(e)}},u.pageBlogs=function(){if(u.loadNextGroupClicked){if(10<u.loadNextGroupRequestCount)return u.loadNextGroupClicked=!1,void(u.loadNextGroupRequestCount=0);u.loadNextGroupRequestCount++}!u.photoBlogsRequestActive()&&u.hasMorePhotoBlogs()&&(u.photoBlogsRequestActive(!0),$.ajax({type:"POST",url:"/Nose/Page_Blogs",cache:!1,data:{loginName:u.loginName,lastKnownBlogTicks:u.photoBlogsLastKnownTicks,pageSize:u.photoBlogsPageSize},dataType:"json",success:function(e){u.photoBlogsRequestActive(!1),e&&0<e.length?u.addPhotoBlogs(e):u.hasMorePhotoBlogs(!1)},error:function(e){429!=e.status&&dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),u.photoBlogsRequestActive(!1)}}))},u.loadNextGroup=function(){u.loadNextGroupClicked=!0,u.loadNextGroupRequestCount=0,u.requestUntilPhotoBlogsGroup=u.photoBlogsGroupCount+1,u.updatePhotoBlogGroup()},u.pois=ko.observableArray(),u.poisPageSize=gnSettings.PoisPageSize,u.poisLastKnownTicks=MAX_DATE_TIME_TICKS,u.hasMorePois=ko.observable(!0),u.poisRequestActive=ko.observable(!1),u.onAddPois=function(e){},u.addPois=function(e){if(null!=e){if(0<e.length){u.poisLastKnownTicks=e[e.length-1].CreationTicks;for(var t=0,o=e;t<o.length;t++){var n=o[t];u.pois.push(new PoiDto(n))}e.length%u.poisPageSize!=0&&u.hasMorePois(!1)}else u.hasMorePois(!1);u.onAddPois&&u.onAddPois(e)}},u.pagePois=function(){!u.poisRequestActive()&&u.hasMorePois()&&(u.poisRequestActive(!0),$.ajax({type:"POST",url:"/Nose/Page_PoIs",cache:!1,data:{loginName:u.loginName,lastKnownPoITicks:u.poisLastKnownTicks,pageSize:u.poisPageSize},dataType:"json",success:function(e){e&&0<e.length?u.addPois(e):u.hasMorePois(!1),u.poisRequestActive(!1)},error:function(e){429!=e.status&&dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),u.poisRequestActive(!1)}}))},u.tours=ko.observableArray(),u.toursPageSize=gnSettings.ToursPageSize,u.toursLastKnownTicks=MAX_DATE_TIME_TICKS,u.hasMoreTours=ko.observable(!0),u.toursRequestActive=ko.observable(!1),u.onAddTours=function(e){},u.addTours=function(e){if(null!=e){if(0<e.length){u.toursLastKnownTicks=e[e.length-1].CreationTicks;for(var t=0,o=e;t<o.length;t++){var n=o[t];u.tours.push(new TourDto(n))}e.length%u.toursPageSize!=0&&u.hasMoreTours(!1)}else u.hasMoreTours(!1);u.onAddTours&&u.onAddTours(e)}},u.pageTours=function(){!u.toursRequestActive()&&u.hasMoreTours()&&(u.toursRequestActive(!0),$.ajax({type:"POST",url:"/Nose/Page_Tours",cache:!1,data:{loginName:u.loginName,lastKnownTourTicks:u.toursLastKnownTicks,pageSize:u.toursPageSize},dataType:"json",success:function(e){e&&0<e.length?u.addTours(e):u.hasMoreTours(!1),u.toursRequestActive(!1)},error:function(e){429!=e.status&&dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),u.toursRequestActive(!1)}}))},u.events=ko.observableArray(),u.eventsPageSize=gnSettings.EventsPageSize,u.eventsLastKnownTicks=MAX_DATE_TIME_TICKS,u.hasMoreEvents=ko.observable(!0),u.eventsRequestActive=ko.observable(!1),u.onAddEvents=function(e){},u.addEvents=function(e){if(null!=e){if(0<e.length){u.eventsLastKnownTicks=e[e.length-1].CreationTicks;for(var t=0,o=e;t<o.length;t++){var n=o[t];u.events.push(new EventDto(n))}e.length%u.eventsPageSize!=0&&u.hasMoreEvents(!1)}else u.hasMoreEvents(!1);u.onAddEvents&&u.onAddEvents(e)}},u.pageEvents=function(){!u.eventsRequestActive()&&u.hasMoreEvents()&&(u.eventsRequestActive(!0),$.ajax({type:"POST",url:"/Nose/Page_Events",cache:!1,data:{loginName:u.loginName,lastKnownEventTicks:u.eventsLastKnownTicks,pageSize:u.eventsPageSize},dataType:"json",success:function(e){e&&0<e.length?u.addEvents(e):u.hasMoreEvents(!1),u.eventsRequestActive(!1)},error:function(e){429!=e.status&&dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),u.eventsRequestActive(!1)}}))},u.photoBlogsRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),u.poisRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),u.toursRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),u.NoseDto=new NoseDto({LoginName:u.loginName}),u.photoBlogsGroupType.subscribe(function(e){e!=GroupTypeEnum.Custom?(u.photoBlogsStartDate(""),u.photoBlogsGroupValue(0)):u.updatePhotoBlogGroup()}),u.photoBlogsGroupValue.subscribe(function(e){u.photoBlogsGroupValueTemp(e),u.updatePhotoBlogGroup()}),u.photoBlogsStartTicksValue.subscribe(function(e){u.photoBlogsLastKnownTicks=e,u.photoBlogs.removeAll(),u.hasMorePhotoBlogs(!0),u.pageBlogs()}),u.photoBlogsStartDate.subscribe(function(e){if(e){var t=GetTicksFromDate(moment.utc(e).add(1,"d").toDate());u.photoBlogsStartTicksValue(t)}else u.photoBlogsStartTicksValue(MAX_DATE_TIME_TICKS)}),u}return __extends(e,t),e}(BaseViewModel),CarouselViewModel=function(i){function e(e){var t=i.call(this,e&&e.imagePath||null)||this;if(t.isHidden=ko.observable(!1),t.hasCarousel=ko.observable(!1),t.slides=ko.observableArray(),t.isHidden(e&&e.isHidden),t.hasCarousel(e&&e.hasCarousel),t.slides.push(new CarouselItemDto(GetLangRes("Shared_HomePageCarouselView1_Title","GpsNose"),GetLangRes("Shared_HomePageCarouselView1_Text","Know your area."))),t.hasCarousel()){var o=[{title:GetLangRes("Shared_HomePageCarouselView2_Title","Find new people"),text:GetLangRes("Shared_HomePageCarouselView2_Text","The innovative GpsNose system allows you to meet new people nearby.")},{title:GetLangRes("Shared_HomePageCarouselView3_Title","Stay anonymous"),text:GetLangRes("Shared_HomePageCarouselView3_Text","GpsNose can be used without any registration: you can stay anonymous and provide your email address later to use your login also from other devices.")},{title:GetLangRes("Shared_HomePageCarouselView4_Title","Write messages"),text:GetLangRes("Shared_HomePageCarouselView4_Text","Direct communication without disclosing your email or phone number as we don't use the classic communication channels.")},{title:GetLangRes("Shared_HomePageCarouselView5_Title","Chat within your area"),text:GetLangRes("Shared_HomePageCarouselView5_Text","You can chat within your area, meet new people and find new places")},{title:GetLangRes("Shared_HomePageCarouselView6_Title","Save your favorite places"),text:GetLangRes("Shared_HomePageCarouselView6_Text","You can save a favorite location to be able to find it later again.")},{title:GetLangRes("Shared_HomePageCarouselView7_Title","Create and share tours"),text:GetLangRes("Shared_HomePageCarouselView7_Text","You can record tours and share them with others.")},{title:GetLangRes("Shared_HomePageCarouselView8_Title","Share your location"),text:GetLangRes("Shared_HomePageCarouselView8_Text","Your location is visible only for allowed users. You can share your location with somebody or send the location once per SMS/Email.")}];for(var n in o){var a=o[n];t.slides.push(new CarouselItemDto(a.title,a.text))}}return t}return __extends(e,i),e}(BaseComponentsViewModel);ko.components.register("ma-gpsnose-carousel",{viewModel:CarouselViewModel,template:'<header class="header-carousel" data-bind="visible: ! isHidden()"><div id="carousel1" class="carousel" data-ride="carousel" data-interval="10000" data-keyboard="true"><ol class="carousel-indicators" data-bind="foreach: slides, visible: slides().length > 1"><li data-target="#carousel1" data-bind="attr: { \'data-slide-to\': $index() }, css: { active: $index() == 0 }"></li></ol><div class="carousel-inner" role="listbox" data-bind="foreach: slides"><div class="item" data-bind="css: { active: $index() == 0 }"><img data-bind="attr: { src: $parent.imagePath() + \'/bg\' + ($index() > 0 ? $index() : \'\') + \'.png\', atr: text }"><div class="container"><div class="carousel-caption"><div class="row"><div class="col-xs-4"><img class="intropage"data-bind="attr: { src: $parent.imagePath() + \'/fg\' + ($index() > 0 ? $index() : \'\') + \'.png\', atr: text }"></div><div class="col-xs-8"><h2 data-bind="text: title"></h2><p data-bind="text: text"></p></div></div></div></div></div></div><a class="left carousel-control" href="#carousel1" role="button" data-slide="prev" data-bind="visible: slides().length > 1"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="right carousel-control" href="#carousel1" role="button" data-slide="next" data-bind="visible: slides().length > 1"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></header>'});var CommentsViewModel=function(t){function e(e){var a=t.call(this,e&&e.imagePath||null)||this;return a.commentPageUrl="/Comment/Page_Comment",a.commentSaveUrl="/WebApi/SaveComment",a.comments=ko.observableArray(),a.commentsPageSize=gnSettings.CommentsPageSize,a.commentsLastKnownTicks=MAX_DATE_TIME_TICKS,a.hasMoreComments=ko.observable(!0),a.commentsRequestActive=ko.observable(!1),a.loginName=ko.observable(""),a.isActivated=ko.observable(!1),a.isAddAllowed=ko.observable(!1),a.isLoggedIn=ko.observable(!1),a.commentAddText=ko.observable(""),a.commentAddMood=ko.observable(""),a.commentEditText=ko.observable(""),a.commentEditMood=ko.observable(""),a.saveCommentRequestActive=ko.observable(!1),a.onChangeComments=function(e){},a.addComments=function(e){if(null!=e){if(0<e.length){for(var t in a.commentsLastKnownTicks=e[e.length-1].CreationTicks,e)a.comments.push(new CommentDto(e[t]));e.length%a.commentsPageSize!=0&&a.hasMoreComments(!1)}else a.hasMoreComments(!1);a.onChangeComments&&a.onChangeComments($("#commentsContainer"))}},a.pageComments=function(){!a.commentsRequestActive()&&a.hasMoreComments()&&(a.commentsRequestActive(!0),$.ajax({type:"POST",url:a.commentPageUrl,cache:!1,data:{lastKnownTicks:a.commentsLastKnownTicks,uniqueKey:a.uniqueKey,pageSize:a.commentsPageSize,itemType:a.itemType},dataType:"json",success:function(e){e&&0<e.length?a.addComments(e):a.hasMoreComments(!1),a.commentsRequestActive(!1)},error:function(e){429!=e.status&&dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),a.commentsRequestActive(!1)}}))},a.addComment=function(){if(0==a.commentAddText().length&&0==a.commentAddMood().length)dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Comment_lblErrorTextRequired","Text is required!"),null);else{var e=new CommentDto({Creator:a.loginName(),Text:a.commentAddText(),Mood:a.commentAddMood(),CreationTicks:GetTicksFromDate(new Date)});a.saveComment(e,!1,function(){a.commentAddText(""),a.commentAddMood("")})}},a.longComment=function(){$(document).off("gn.dialog.show").on("gn.dialog.show",function(){setTimeout(function(){$("#CommentLongField").select()},500)}),dialog.show(GetLangRes("Common_lblCommentAdd","Add comment"),'<textarea id="CommentLongField" rows="4" cols="50" maxlength="5000" type="text" class="form-control" placeholder="'+GetLangRes("Common_lblCommentAddHint","Write comment")+'">'+a.commentAddText()+"</textarea>",function(){var e=String($("#CommentLongField").val());if(e&&0<e.length){var t=new CommentDto({Creator:a.loginName(),Text:e,CreationTicks:GetTicksFromDate(new Date)});a.saveComment(t,!1,function(){dialog.hide(),a.commentAddText(""),a.commentAddMood(""),$("#CommentLongField").val("");var e=a.comments();a.comments([]),a.comments(e),a.onChangeComments&&a.onChangeComments($("#commentsContainer"))})}})},a.editComment=function(t){$(document).off("gn.dialog.show").on("gn.dialog.show",function(){setTimeout(function(){$("#CommentEditField").select()},500)}),dialog.show(GetLangRes("Common_lblCommentEdit","Edit comment"),'<textarea id="CommentEditField" rows="4" cols="50" maxlength="5000" type="text" class="form-control" placeholder="'+GetLangRes("Common_lblCommentEditHint","Remove comment")+'">'+t.Text+"</textarea>",function(){var e=String($("#CommentEditField").val());e&&0<e.length?(t.Text=e,a.saveComment(t,!0,function(){dialog.hide();var e=a.comments();a.comments([]),a.comments(e),a.onChangeComments&&a.onChangeComments($("#commentsContainer"))})):a.deleteComment(t)})},a.deleteComment=function(e){dialog.show(GetLangRes("Common_lblAreYouSureTitle","Are you sure?"),GetLangRes("Common_lblAreYouSureMessage","This can not be undone, proceed anyway?"),function(){e.Text=null,e.Mood=null,a.saveComment(e,!0,function(){a.comments.remove(e)}),dialog.hide()})},a.saveComment=function(o,e,n){a.saveCommentRequestActive()||(a.saveCommentRequestActive(!0),$.ajax({type:"POST",url:a.commentSaveUrl,cache:!1,data:{uniqueKey:a.uniqueKey,text:o.Text,mood:o.Mood,itemType:a.itemType,creationTicks:o.CreationTicks,isUpdate:e},dataType:"json",success:function(e){if(e&&0<e.ErrorCode)dialog.show(GetLangRes("Common_lblError","Error"),e.Message,null);else{e&&"string"==typeof e&&e.match(/^-{0,1}\d+$/)&&(o.CreationTicks=e);var t=ko.utils.arrayFirst(a.comments(),function(e){return o.CreationTicks===e.CreationTicks});null==o.Text&&null===o.Mood&&t?(a.comments.remove(t),a.onChangeComments&&a.onChangeComments($("#commentsContainer"))):t?(t.Text=o.Text,t.Mood=o.Mood):(a.comments.splice(0,0,o),a.onChangeComments&&a.onChangeComments($("#commentsContainer"))),n&&n()}a.saveCommentRequestActive(!1)},error:function(){dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Comment_lblErrorCannotSave","The comment could not be saved!"),null),a.saveCommentRequestActive(!1)}}))},a.uniqueKey=e&&e.uniqueKey||"",a.hideTitle=e&&e.hideTitle||!1,e&&e.commentPageUrl&&(a.commentPageUrl=e.commentPageUrl),e&&e.commentSaveUrl&&(a.commentSaveUrl=e.commentSaveUrl),e&&e.loginUrl&&(a.loginUrl=e.loginUrl),e&&e.onChangeComments&&(a.onChangeComments=e.onChangeComments),e&&e.loginName&&a.loginName(e.loginName),e&&e.isActivated&&a.isActivated(e.isActivated),e&&e.entity&&(a.Entity=e.entity,a.itemType=a.Entity.commentItemType,a.isAddAllowed(a.Entity.isCommentsAllowed())),a.isLoggedIn(0<a.loginName().length),a.moods=ko.observableArray(["😊","😁","❤","💤","😱","😔","😭","😠"]),a.commentAddMood.subscribe(function(e){0<e.length&&(0<a.commentAddText().length?(a.commentAddText(a.commentAddText().trim()+"  "+e),a.commentAddMood("")):a.addComment())}),e&&e.comments&&0<e.comments.length?a.addComments(e.comments):e&&e.comments?a.hasMoreComments(!1):a.pageComments(),a}return __extends(e,t),e}(BaseComponentsViewModel);ko.components.register("ma-gpsnose-comments",{viewModel:CommentsViewModel,template:'<div id="commentsContainer"><h3 data-bind="text: GetLangRes(\'Common_lblComments\', \'Comments\'), visible: ! hideTitle"></h3><div data-bind="if: isAddAllowed() && isLoggedIn() && !isActivated()"><div class="alert alert-info"><span class="glyphicon glyphicon-info-sign"></span><span data-bind="text: \' \' + GetLangRes(\'Comment_lblActivationRequired\', \'To add comments, it is required to validate your account, please validate your account in the GpsNose-App!\')"></span></div></div><div data-bind="if: Entity && Entity.isCommentsAllowed && !isLoggedIn()"><div class="alert alert-info"><span class="glyphicon glyphicon-info-sign"></span><span data-bind="text: \' \' + GetLangRes(\'Community_loginRequired\', \'Login first to interact\')"></span><button type="button" class="btn btn-info btn-xs pull-right" data-bind="click: function() { document.location.href = $data.getLoginUrl($data.loginUrl); }"><span class="glyphicon glyphicon-user"></span><span data-bind="text: \' \' + GetLangRes(\'Common_btnLogin\', \'Login\')"></span></button></div></div><div data-bind="if: isAddAllowed() && isLoggedIn() && isActivated()"><form onsubmit="addComment()"><div class="form-group row"><div class="col-sm-12"><div class="input-group"><span class="input-group-btn"><div class="btn btn-default" type="button" style="letter-spacing:-2px;" data-fancybox data-src="#moods-dialog" data-bind="attr: { \'data-remove\': MA_GPSNOSE_IS_MASHUP }">&#x1F60A;&#x1F601;&#x1F631;&#x1F614;</div><button type="button" class="btn btn-default" data-bind="click: function() { longComment() }"><span class="glyphicon glyphicon-align-left"></span> </button></span><input type="text" maxlength="1000" class="form-control" data-bind="textInput: commentAddText, attr: { \'placeholder\': GetLangRes(\'Common_lblCommentAddHint\', \'Write comment\') }" /><span class="input-group-btn"><button class="btn btn-primary" type="submit" data-bind="attr: { \'disabled\': saveCommentRequestActive() }, click: function(){ addComment() }"><span class="glyphicon glyphicon-comment" data-bind="visible: ! saveCommentRequestActive()"></span> <span class="glyphicon glyphicon-repeat gly-spin" data-bind="visible: saveCommentRequestActive()"></span> <span data-bind="text: GetLangRes(\'Common_btnSend\', \'Send\')"></span></button></span></div></div></div></form><div id="moods-dialog" data-bind="foreach: moods" style="display:none;" class="moods-dialog"><div class="btn btn-default" data-bind="text: $data, click: function() { if (jQuery().fancybox) $.fancybox.close(true); $parent.commentAddMood($data); }"></div></div></div><div data-bind="if: comments().length == 0"><div class="alert alert-info" data-bind="text: GetLangRes(\'Common_lblNoCommentsAvailable\', \'Currently there are no comments available for this item.\')"></div></div><div class="comments" data-bind="if: comments().length > 0"><div class="grid"><div class="grid-sizer col-md-4 col-sm-6 col-xs-12"></div><div data-bind="foreach: comments.sort(function (l, r) { return l.CreationTicks < r.CreationTicks ? 1 : -1 })"><div class="grid-item col-md-4 col-sm-6 col-xs-12"><div class="outer"><div class="media"><div class="media-left"><img class="media-object img-circle" width="32px" data-bind="attr: { src: $data.NoseDto.imageUrl() + \'@100\', onerror: \'ImageErrorHandler(this, \\\'\' + $parent.imagePath() + \'/EmptyUser.png\\\')\' }" /></div><div class="media-body middle" data-bind="text: $data.Creator"></div><div class="media-body middle mood" data-bind="text: $data.Mood"></div><div class="media-right middle" data-bind="text: GetAgeStringFromTicks($data.CreationTicks)"></div></div><div data-bind="text: $data.Text, visible: hasText(), css: ($data.Text && $data.Text.length > 20 ? \'text\' : \'text-big\')"></div><div class="clearfix"><img class="ma-crown" data-bind="attr: { src: $parent.imagePath() + \'/IcActionCrown.png\' }, visible: $parent.Entity.isUserAdmin($data.Creator)" /><div class="btn-group btn-group-xs pull-right" role="group" aria-label="share"><a class="btn btn-default" data-popup data-bind="attr: { href: $data.NoseDto.detailUrl(), title: GetLangRes(\'Common_btnShowProfile\', \'Show profile\') }"><span aria-hidden="true" class="glyphicon glyphicon-user"></span><span data-bind="text: \' \' + GetLangRes(\'Common_btnShowProfile\', \'Show profile\')"></span></a><div class="btn btn-default" data-bind="visible: $data.hasText(), click: function() { if (! $parent.saveCommentRequestActive()) { if (jQuery().fancybox) $.fancybox.close(true); $parent.editComment($data); } }, attr: { \'disabled\': $parent.saveCommentRequestActive(), \'data-remove\': $parent.loginName() != $data.Creator, title: GetLangRes(\'Common_btnEdit\', \'Edit\') }"><span aria-hidden="true" class="glyphicon glyphicon-edit"></span><span data-bind="text: \' \' + GetLangRes(\'Common_btnEdit\', \'Edit\')"></span></div><div class="btn btn-danger" data-bind="click: function() { if (! $parent.saveCommentRequestActive()) $parent.deleteComment($data); }, attr: { \'disabled\': $parent.saveCommentRequestActive(), \'data-remove\': $parent.loginName() != $data.Creator, title: GetLangRes(\'Common_btnDelete\', \'Delete\') }"><span aria-hidden="true" class="glyphicon glyphicon-remove"></span></div></div></div></div></div></div></div></div></div><div class="text-center"><div class="btn btn-default btn-lg" data-bind="click: function(){ pageComments() }, visible: hasMoreComments(), attr: { disabled: commentsRequestActive() }"><div data-bind="visible: ! commentsRequestActive()"><span class="glyphicon glyphicon-cloud-download"></span><span data-bind="text: \' \' + GetLangRes(\'Common_lblLoadMore\', \'more..\')"></span></div><div data-bind="visible: commentsRequestActive()"><span class="glyphicon glyphicon-repeat gly-spin"></span>'+"<span data-bind=\"text: ' ' + GetLangRes('Common_lblRequestInProgress', 'Request in progress')\"></span></div></div></div></div>"});var DialogViewModel=function(){var i=this;this.title=ko.observable(""),this.message=ko.observable(""),this.okCallback=null,this.okClicked=ko.observable(!1),this.hasOkCallback=ko.observable(!1),this.showDialog=ko.observable(!1),this.show=function(e,t,o){i.title(e),i.message(t),i.okCallback=o,i.hasOkCallback(null!=o),i.showDialog(0<e.length||0<t.length),i.okClicked(!1),$(document).trigger("gn.dialog.show")},this.hide=function(){i.showDialog(!1),$(document).trigger("gn.dialog.hide")},this.clickOkButton=function(){i.okClicked(!0),i.okCallback&&i.okCallback(),$(document).trigger("gn.dialog.click.ok")},this.hasTitle=function(){return null!=i.title()||0<i.title().length},this.joinCommunity=function(e,t,o){i.okClicked(!1);var n=new KeywordDto(e);if(n.isCommunity){var a=GetLangRes("Common_lblJoinCommunityAreYouSure","Would you like to join the community %community%?").replace("%community%",n.getHtml());dialog.show(GetLangRes("Common_lblJoinTitle","Join a community"),a,function(){$.ajax({type:"POST",url:"/WebApi/JoinCommunity",cache:!1,data:{tag:e},dataType:"json",success:function(e){e&&0==e.ErrorCode?(dialog.hide(),o&&o()):dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_loginRequired","Please login first."),null)},error:function(){dialog.show(GetLangRes("Common_lblError","Error"),"",null)}})})}},this.leaveCommunity=function(e,t,o){i.okClicked(!1);var n=new KeywordDto(e);if(n.isCommunity){var a=GetLangRes("Common_lblLeaveCommunityAreYouSure","Would you like to leave the community %community%?").replace("%community%",n.getHtml());dialog.show(GetLangRes("Common_lblLeaveTitle","Leave community"),a,function(){$.ajax({type:"POST",url:"/WebApi/LeaveCommunity",cache:!1,data:{tag:e},dataType:"json",success:function(e){e&&0==e.ErrorCode?(dialog.hide(),o&&o()):dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_loginRequired","Please login first."),null)},error:function(){dialog.show(GetLangRes("Common_lblError","Error"),"",null)}})})}}},dialog=new DialogViewModel;ko.components.register("ma-gpsnose-dialog",{viewModel:{instance:dialog},template:'<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="dialogModalLabel" data-bind="modal: showDialog"><div class="modal-dialog" role="document"><form data-bind="submit: function(){ clickOkButton() }"><div class="modal-content"><div class="modal-header" data-bind="visible: title().length > 0"><button type="button" class="close" data-dismiss="modal" aria-label="Close" data-bind="attr: { \'aria-label\': GetLangRes(\'Common_btnClose\', \'Close\') }"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" data-bind="text: $data.title"></h4></div><div class="modal-body"><span data-bind="html: message"></span></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal"><span aria-hidden="true" class="glyphicon glyphicon-remove"></span><span data-bind="text: \' \' + GetLangRes(\'Common_btnClose\', \'Close\')"></span></button><button type="button" class="btn btn-primary" data-bind="visible: hasOkCallback(), click: function(){ clickOkButton() }, attr: { \'disabled\': okClicked() }"><span aria-hidden="true" class="glyphicon glyphicon-ok"></span>'+"<span data-bind=\"text: ' ' + GetLangRes('Common_btnOk', 'OK')\"></span></button></div></div></form></div></div>"});var FooterViewModel=function(n){function e(e){var t=n.call(this,e&&e.imagePath||null)||this;t.isHidden=ko.observable(e&&e.isHidden);var o=new Date;return t.copyright="&copy; "+o.getFullYear()+" "+GetLangRes("Common_lblCompanyName","Nemanicnedanic, Inc."),t.hideCopyright=ko.observable(e&&e.hideCopyright),t.hideSupportMail=ko.observable(e&&e.hideSupportMail),t}return __extends(e,n),e}(BaseComponentsViewModel);ko.components.register("ma-gpsnose-footer",{viewModel:FooterViewModel,template:'<div class="container marketing" data-bind="ifnot: isHidden()"><div class="row"><div class="col-md-3 col-sm-2"></div><div class="col-md-3 col-sm-4"><p class="text-center"><a href="https://itunes.apple.com/us/app/gpsnose/id892215768" data-external role="button"><img alt="App Store" data-bind="attr: { src: imagePath() + \'/badge_app_store.png\' }"></a><span data-bind="if:!hideSupportMail()"><br /><a href="mailto:iphone@gpsnose.com"><span aria-hidden="true" class="glyphicon glyphicon-envelope"></span><span data-bind="text: \' \' + GetLangRes(\'Shared_Footer_lblSupportIos\', \'iOS support\')"></span></a></span></p></div><div class="col-md-3 col-sm-4"><p class="text-center"><a href="https://goo.gl/4q4TGl" data-external role="button"><img alt="Google Play" data-bind="attr: { src: imagePath() + \'/badge_google_play.png\' }"></a><span data-bind="if:!hideSupportMail()"><br /><a href="mailto:android@gpsnose.com"><span aria-hidden="true" class="glyphicon glyphicon-envelope"></span><span data-bind="text: \' \' + GetLangRes(\'Shared_Footer_lblSupportAndroid\', \'Android support\') "></span></a></span></p></div><div class="col-md-3 col-sm-2"></div></div><div data-bind="if: ! hideCopyright()"><hr class="divider"><footer><p class="text-center" data-bind="html: copyright"></p></footer></div></div>'});var KeepAliveViewModel=function(){function e(e){this.isLoggedIn=ko.observable(!0);var t=600;null!=e&&0<=e.interval&&(t=Math.max(60,e.interval)),this.StartInterval(t)}return e.prototype.IsStillLoggedIn=function(t){$.ajax({type:"POST",url:"/Login/IsStillLoggedIn",cache:!1,data:{},dataType:"json",success:function(e){null!=t&&t(e)},error:function(){null!=t&&t(!1)}})},e.prototype.StartInterval=function(e){var t=this;setInterval(function(){t.IsStillLoggedIn(function(e){t.isLoggedIn(e)})},1e3*e)},e}();ko.components.register("ma-gpsnose-keepalive",{viewModel:KeepAliveViewModel,template:'<div data-bind="if: ! isLoggedIn()"><div class="alert alert-danger"><span class="glyphicon glyphicon-info-sign"></span><span data-bind="text: \' \' + GetLangRes(\'Common_lblLoggedOut\', \'You have been logged out. To continue with your work, you have to sign in again.\')"></span><button type="button" class="btn btn-danger btn-xs pull-right" data-bind="click: function() { location.reload(); }"><span class="glyphicon glyphicon-user"></span>'+"<span data-bind=\"text: ' ' + GetLangRes('Common_btnLogin', 'Login')\"></span></button></div></div>"});var keywordsViewModel=function(e){var i=this;this.keywords=ko.observableArray(),this.selectedKeywords=ko.observableArray(),this.newKeyword=ko.observable(""),this.addKeywords=function(e,a){ko.utils.arrayForEach(e,function(t){var o=!0;if(ko.utils.arrayForEach(i.keywords()||[],function(e){t==e.name()&&(o=!1)}),o){var n=a;ko.utils.arrayForEach(i.selectedKeywords(),function(e){e==t&&(n=!0)});var e=new KeywordDto(t.toLowerCase());i.keywords.push(e),e.isSelected.subscribe(function(e){i.selectedKeywords.removeAll(),ko.utils.arrayForEach(i.keywords()||[],function(e){e.isSelected()&&i.selectedKeywords.push(e.name())})}),e.isSelected(n)}})},this.addKeyword=function(){if(0<i.newKeyword().length){var e=i.newKeyword().replace(/[^a-zA-Z0-9\ \.\-_]/gi,""),t=[],o=0;ko.utils.arrayForEach(e.split(" "),function(e){e&&0<e.length&&(t[o]=e,o++)}),0<t.length?(i.addKeywords(t,!0),i.newKeyword("")):dialog.show("",GetLangRes("Common_lblCharsNotAllowed","To add a keyword you have to enter a valid character"),null)}},this.onSelectionChange=e&&e.onSelectionChange||null,this.onKeywordFieldChange=e&&e.onKeywordFieldChange||null,this.searchClasses=e&&e.searchClasses||"input-group col-lg-3 col-md-6",this.isEditable=ko.observable(e&&e.isEditable||!1),this.noEntryLabel=ko.observable(e&&e.noEntryLabel||null),this.selectedKeywords.subscribe(function(e){i.onSelectionChange&&i.onSelectionChange(i.selectedKeywords())}),this.newKeyword.subscribe(function(e){i.onKeywordFieldChange&&i.onKeywordFieldChange(e)}),this.addKeywords(e&&e.keywords||[],!1),e&&e.keywordString&&this.addKeywords(e.keywordString.split(";"),!1),ko.utils.arrayForEach(e&&e.selectedKeywords||[],function(e){i.selectedKeywords.push(e)})};ko.components.register("ma-gpsnose-keywords",{viewModel:keywordsViewModel,template:'<div class="keywords"><div data-bind="if: isEditable()"><div data-bind="attr : { \'class\': searchClasses }"><input type="text" name="NewKeyword" class="form-control" data-bind="textInput: newKeyword, attr: { placeholder: GetLangRes(\'Common_lblAddKeyword\', \'Add new keyword...\') }, enterkey: addKeyword, event: { blur: addKeyword }" /><span class="input-group-btn"><div class="btn btn-primary" data-bind="text: GetLangRes(\'Common_btnAdd\', \'Add\'), click: addKeyword"></div></span></div><div data-bind="foreach: selectedKeywords"><input type="hidden" name="Keywords[]" data-bind="value: $data" /></div></div><div class="alert alert-info" data-bind="visible: keywords().length == 0 && noEntryLabel()"><span class="glyphicon glyphicon-info-sign"></span><span data-bind="html: \' \' + noEntryLabel()"></span></div><div data-bind="foreach: keywords"><a href="javascript:;" data-type="ajax" data-bind="attr: { \'data-external\': MA_GPSNOSE_IS_MASHUP ? true : null, \'data-src\': (isCommunity() && ! $parent.isEditable() && ! MA_GPSNOSE_IS_MASHUP) ? Community.previewUrl() : null, \'data-fancybox\': (isCommunity() && ! $parent.isEditable() && ! MA_GPSNOSE_IS_MASHUP) ? \'community\' : null }, html: getHtml(), css: { selected: isSelected() }, click: function() { if ($parent.isEditable()) toggle(); else return true; }"></a></div><div class="clearfix"></div></div>'});var MoodsControlViewModel=function(e){var t=this;this.selectedMood=ko.observable(""),this.moodIndex=ko.observable(e&&e.index||"0"),this.moods=ko.observableArray(e&&e.moods||["😊","😁","😂","😆","😉","😋","😍","😜","😠","😔","😥","😫","😓","😖","😷","😢","😭","😱","❤","💔","👼","👿","💀","👻","👽","🙈","🙉","🙊","💩","💣","🔥","💤","🐶","🐱","🐎","🐭","🐧","🐟","🐌","🎠","🎢","🎪","🎭","🎼","🎨","🌹","🌼","🌴","🌵","🍉","🍎","🍔","🍕","🍲","🍪","🍰","🍫","🍬","🍷","🍸","🍺","🍴","🚌","🚗","🚲","⛵","✈","🚀","☀","⭐","☁","⛅","⚡","❄","🎃","🎄","🎆","✨","🎈","🎉","🎁","⚽","⚾","🏀","🏈","🎾","🎱","🎳","⛳","🎿","🏂","🏄","🏊","🎮"]),this.onSelectionChange=e&&e.onSelectionChange||null,this.selectedMood.subscribe(function(e){t.onSelectionChange&&t.onSelectionChange(t.selectedMood())}),this.selectedMood(e&&e.selectedMood||"😊")};ko.components.register("ma-gpsnose-moods-control",{viewModel:MoodsControlViewModel,template:'<div class="moods-control"><div class="btn btn-default mood" data-fancybox data-bind="attr: { \'data-src\': \'#moods-dialog-\' + moodIndex() }"><span data-bind="text: selectedMood() + \' \'"></span><span class="caret"></span></div><input type="hidden" name="Mood" data-bind="value: selectedMood()" /><div data-bind="foreach: moods, attr: { \'id\': \'moods-dialog-\' + moodIndex() }" style="display: none;" class="moods-dialog"><div class="btn btn-default" data-bind="text: $data, css: { active: $data == $parent.selectedMood() }, click: function() { $parent.selectedMood($data); $.fancybox.close(true); }"></div></div></div>'});var NavbarViewModel=function(o){function e(e){var t=o.call(this)||this;return t.params=e,t.imagePath=ko.observable(t.params&&t.params.imagePath||"/Content/Mashup/Images"),t.isHidden=ko.observable(t.params&&t.params.isHidden),t.profile=t.params&&t.params.profile||{},t.noseDto=new NoseDto({LoginName:t.profile.LoginName}),t.languages=ko.observableArray(t.params&&t.params.languages||[]),t.navigation=ko.observableArray(),t.navigationAccount=ko.observableArray(),t.pokeMoods=ko.observableArray([]),ko.utils.arrayForEach(t.params&&t.params.navigation||{},function(e){e.IsAccount?t.navigationAccount.push(new NavBarDto(t.getLoginUrl(e.Url),e.Text,e.IsActive)):t.navigation.push(new NavBarDto(e.Url,e.Text,e.IsActive))}),t.user=new UserDto(e&&e.user||{}),t.pokeMoods=ko.observableArray(["😊","😁","😂","😆","😉","😋","😍","😜","😠","😔","😥","😫","😓","😖","😷","😢","😭","😱","❤","💔","👼","👿","👽","🙈","🙉","🙊","💤","🌹","🌼","☕️","🍷","🍸","🍺","🍴","⭐","🎁"]),t}return __extends(e,o),e.prototype.sendPoke=function(e,t){t.IsActivated?$.ajax({type:"POST",url:"/WebApi/SendMail",cache:!1,data:{toLoginName:this.noseDto.LoginName,body:e},dataType:"json",success:function(e){e&&0==e.ErrorCode?dialog.show(GetLangRes("Common_lblSuccess","Success"),GetLangRes("Common_lblMessageSendSuccess","Message sent successfully!"),null):dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)},error:function(){dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)}}):dialog.show(GetLangRes("Common_activationRequired","Validation required"),GetLangRes("Common_lblActivationRequired","To use this functionality, it is required to validate your account, please validate your account in the GpsNose-App!"),null)},e}(BaseViewModel);ko.components.register("ma-gpsnose-navbar",{viewModel:NavbarViewModel,template:'<nav class="navbar navbar-default navbar-static" data-bind="visible: ! isHidden()"><div class="container"><div class="navbar-header"><div class="navbar-toggle collapsed" data-toggle="collapse" data-target="#gn-navbar-collapse-1" aria-expanded="false"><span class="sr-only" data-bind="text: GetLangRes(\'Common_lblToggleNavigation\', \'Toggle navigation\')"></span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></div><a class="visible-xs visible-sm navbar-brand" href="/" data-bind="text: GetLangRes(\'Common_menuHome\', \'Home\')"></a></div><div class="collapse navbar-collapse" id="gn-navbar-collapse-1"><ul class="nav navbar-nav" data-bind="foreach: navigation"><li data-bind="css: { active: isActive }"><a data-bind="attr: { href: url }, text: text"></a></li></ul><span data-bind="foreach: navigationAccount"><a class="btn btn-default navbar-btn" data-bind="attr: { href: url }, text: text"></a></span><ul class="languages nav navbar-nav navbar-right" data-bind="foreach: languages"><li data-bind="css: { active: GetCurrentLang() == $data }"><a data-bind="attr: { href: \'javascript:\' + (GetCurrentLang() == $data ? \'\' : \'SwitchLanguage(\\\'\'+$data+\'\\\')\') + \';\' }, text: $data"></a></li></ul></div><div data-bind="if: profile.LoginName"><div class="nav navbar-nav navbar-userinfo" data-bind="if: profile.LoginName"><div class="row"><div class="col-sm-4 col-xs-5 col-left"><div class="media"><div class="media-left"><a data-bind="attr: { href: noseDto.imageUrl() }" data-fancybox><img class="media-object img-circle" data-bind="attr: { src: noseDto.imageUrl() + \'@100\', onerror: \'RemoveFancyboxForImage(this);ImageErrorHandler(this, \\\'\' + imagePath() + \'/EmptyUser.png\\\');\' }" /></a></div><div class="media-body nowrap"><h5 class="media-heading" data-bind="text: profile.LoginName"></h5><div data-bind="text: profile.FullName"></div><div data-bind="text: GetDistanceString(profile)"></div></div></div></div><div class="col-sm-4 col-xs-2 col-center"><div class="media text-center"><div class="media-body"><div class="btn-group-vertical btn-group-xs" role="group" aria-label="share"><div class="btn btn-default" data-src="#share" data-fancybox data-bind="attr: { title: GetLangRes(\'Common_btnShare\', \'Share\') }"><span class="glyphicon glyphicon-qrcode" aria-hidden="true"></span><span class="hidden-xs" data-bind="text: \' \' + GetLangRes(\'Common_btnShare\', \'Share\')"></span></div><div class="btn btn-default hidden" data-fancybox data-src="#poke-moods-dialog" data-bind="attr: { title: GetLangRes(\'Common_btnPoke\', \'Knock\'), \'data-remove\': !user.LoginName || profile.LoginName == user.LoginName }, css: { \'hidden\': !user.LoginName || profile.LoginName == user.LoginName }"><span class="glyphicon glyphicon-hand-left" aria-hidden="true"></span><span class="hidden-xs" data-bind="text: \' \' + GetLangRes(\'Common_btnPoke\', \'Knock\')"></span></div><a class="btn btn-default hidden" data-bind="attr: { href: getLoginUrl(null), title: GetLangRes(\'Common_loginToPoke\', \'Login to Knock\'), \'data-remove\': user.LoginName }, css: { \'hidden\': user.LoginName }"><span class="glyphicon glyphicon-hand-left" aria-hidden="true"></span><span class="hidden-xs" data-bind="text: \' \' + GetLangRes(\'Common_loginToPoke\', \'Login to Knock\')"></span></a><a class="btn btn-default hidden" data-external data-bind="attr: { href: GetGoogleMapsLink(profile.LastActivityLatitude, profile.LastActivityLongitude), title: GetLangRes(\'Common_showOnMap\', \'Show on map\'), \'data-remove\': !IsGeoValid(profile.LastActivityLatitude, profile.LastActivityLongitude) }, css: { \'hidden\': !IsGeoValid(profile.LastActivityLatitude, profile.LastActivityLongitude) }"><span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span><span class="hidden-xs" data-bind="text: \' \' + GetLangRes(\'Common_showOnMap\', \'Show on map\')"></span></a></div></div></div></div><div class="col-sm-4 col-xs-5 col-right"><div class="media text-right"><div class="media-body nowrap"><h5 class="media-heading" data-bind="text: GetLangRes(\'Nose_Profile_lblLastSeen\', \'Last seen\') + \':\'"></h5><div data-bind="text: GetDateStringFromTicks(profile.LastActivityUtcDateTime)"></div><div data-bind="ifnot: profile.LastActivityUtcDateTime"><a data-bind="attr: { href: getLoginUrl(null) }, text: GetLangRes(\'Common_loginRequired\', \'Please login first.\')" data-popup></a></div></div></div></div></div></div></div></div><div class="poke-moods-dialog"><div id="poke-moods-dialog" data-bind="foreach: pokeMoods" style="display:none;" class="moods-dialog"><div class="btn btn-default" data-bind="text: $data, click: function() { $.fancybox.getInstance(\'close\'); $parent.sendPoke($data, gn_data.User || {}); }"></div></div></div></nav>'});var RatingViewModel=function(a){function e(e){var t=a.call(this,e&&e.imagePath||null)||this;t.title=function(){return t.percent()+"%"+(0<t.count()?" ("+t.count()+")":"")},t.imageByPercent=function(e){return t.imagePath()+(t.percent()>e?"/StarOn":"/StarOff")+".png"};var o=0;e&&!isNaN(e.percent)&&(o=parseInt(e.percent)),t.percent=ko.observable(o);var n=0;return e&&!isNaN(e.count)&&(n=parseInt(e.count)),t.count=ko.observable(n),t}return __extends(e,a),e}(BaseComponentsViewModel);ko.components.register("ma-gpsnose-rating",{viewModel:RatingViewModel,template:'<div data-bind="if: count() != 0"><div class="rating" data-bind="attr: { title: title() }"><img class="star" data-bind="attr: { src: imageByPercent(-1) }" /><img class="star" data-bind="attr: { src: imageByPercent(20) }" /><img class="star" data-bind="attr: { src: imageByPercent(45) }" /><img class="star" data-bind="attr: { src: imageByPercent(70) }" /><img class="star" data-bind="attr: { src: imageByPercent(90) }" /></div></div>'});var BaseNavigableItem=function(e){e&&$.extend(this,e),!this.LoginName&&e.Creator&&(this.LoginName=e.Creator),this.UniqueKey?(this.LoginName=GetLoginNameFromUniqueKey(this.UniqueKey),this.CreationTicks=GetTicksFromUniqueKey(this.UniqueKey)):this.CreationTicks&&(this.UniqueKey=GetUniqueKey(this.LoginName,this.CreationTicks))},CarouselItemDto=function(e,t){this.title=ko.observable(""),this.text=ko.observable(""),this.title(e),this.text(t)},CommentDto=function(e){var t=this;this.hasText=function(){return t.Text&&0<t.Text.length},e&&$.extend(this,e),e.CreatedByUserName&&!this.Creator&&(this.Creator=e.CreatedByUserName),this.NoseDto=new NoseDto({LoginName:this.Creator})},CommunityDto=function(e,t){var o=this;this.thumbSize="@100",this.imageUrl=function(){return gnSettings.BaseDataUrl+"/commimg/"+encodeURIComponent(o.TagName)},this.previewUrl=function(){return"/community/preview?profileTag="+encodeURIComponent(o.TagName)},this.detailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/community/index?profileTag="+encodeURIComponent(o.TagName)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"&lid="+gnSettings.LoginId:"")},this.shareUrl=function(){return gnSettings.BaseUrl+"/community/index?profileTag="+encodeURIComponent(o.TagName)},this.isLoginNameAdmin=function(){return o.LoginName==o.CreatorLoginName||-1!=$.inArray(o.LoginName,o.Admins)},this.webMashupUrl=function(){if(-1!=o.TagName.indexOf(".")){var e=o.TagName.substring(1).split("@");if(0<e.length)return"http://"+e[0]}return null},this.isAclListMembers=function(){return(o.Acls&CommunityAcl.ListMembers)==CommunityAcl.ListMembers},this.isMembersListAllowed=function(){return o.isAclListMembers()||o.isLoginNameAdmin()},this.isAclMembersInviteMembers=function(){return(o.Acls&CommunityAcl.MembersInviteMembers)==CommunityAcl.MembersInviteMembers},this.isInviteMembersAllowed=function(){return o.isAclMembersInviteMembers()&&(o.IsInCommunity||o.NoseDto.IsInCommunity(o.TagName))||o.isLoginNameAdmin()},this.isAclCommentsFromMembers=function(){return(o.Acls&CommunityAcl.CommentsFromMembers)==CommunityAcl.CommentsFromMembers},this.commentItemType=CommentItemType.Community,this.isCommentsAllowed=function(){return o.isAclCommentsFromMembers()&&(o.IsInCommunity||o.NoseDto.IsInCommunity(o.TagName)||!o.LoginName)||o.isLoginNameAdmin()},this.isUserAdmin=function(e){return o.LoginName==e||-1!=$.inArray(e,o.Admins)},e&&$.extend(this,e),this.LoginName=t.LoginName,this.NoseDto=new NoseDto(t)},CommunityMemberDto=function(e){e&&$.extend(this,e),this.NoseDto=new NoseDto({LoginName:this.LoginName})},Coordinate=function(e){this.percentageX=0,this.percentageY=0,this.distance=0,this.ageString="0m",e&&$.extend(this,e),this.location=L.latLng(this.lat,this.lon,this.alt)},EventDateDto=function(e,t){this.ticks=e,this.count=t},EventDto=function(o){function e(e){var t=o.call(this,e)||this;return t.thumbSize="@100",t.imageUrl=function(){return gnSettings.BaseDataUrl+"/eventsimg/"+encodeURIComponent(t.UniqueKey)},t.previewUrl=function(){return"/event/preview/"+encodeURIComponent(t.UniqueKey)},t.detailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/event/detail/"+encodeURIComponent(t.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.shareUrl=function(){return gnSettings.BaseUrl+"/event/detail/"+encodeURIComponent(t.UniqueKey)},t}return __extends(e,o),e}(BaseNavigableItem),GeoDataGeometry=function(){},GeoDataItem=function(){},GeoDataProperties=function(){},KeywordDto=function(e){var o=this;this.name=ko.observable(""),this.isSelected=ko.observable(!1),this.isCommunity=function(){return""!=o.getIcon()},this.getHtml=function(){var e=o.name(),t=o.getIcon();return""!=t&&e&&2<e.length?'<span class="glyphicon glyphicon-'+t+'"></span><span class="keyword-label">'+e.substr(1,e.length)+"</span>":e},this.getIcon=function(){var e=o.name();if(!e||e.length<1)return"";var t="";switch(e.charAt(0)){case"@":t="lock";break;case"*":t="eye-close";break;case"%":t="globe"}return t},this.toggle=function(){o.isSelected(!o.isSelected())},this.name(e),this.Community=new CommunityDto({TagName:e},new NoseDto({}))},NavBarDto=function(e,t,o){this.url=e,this.text=t,this.isActive=o},NewsDto=function(e){var t=this;switch(this.PoiPublished_Name=34,this.templateName=function(){switch(t.NewsType){case NewsType.ProfileAbout:return"AboutNewsTemplate";case NewsType.ProfileImage:return"ProfileImageNewsTemplate";case NewsType.NewGuestUser:return"NewGuestUserNewsTemplate";case NewsType.ProfileActivated:return"ProfileActivatedTemplate";case NewsType.PhotoBlog:return"PhotoBlogNewsTemplate";case NewsType.PoI:return"PoIPublishedNewsTemplate";case NewsType.Tour:return"TourNewsTemplate";case NewsType.Comment:return"CommentNewsTemplate";case NewsType.Rating:return"RatingNewsTemplate";case NewsType.Event:return"EventNewsTemplate";case NewsType.Mashup:return"MashupNewsTemplate";default:return"UnknownTemplate"}},this.thumbUrl=function(){return t.imageUrl()+t.Entity.thumbSize},this.detailInlineUrl=function(){return t.previewUrl()},this.photoBlogText=function(){return t.IsNowDeleted?GetLangRes("NewsPart_Load_lblBlogWasDeleted","Impression was deleted"):t.Title},this.commentText=function(){return t.IsNowDeleted?GetLangRes("NewsPart_Load_lblCommentWasDeleted","Comment was deleted"):null!=t.Description&&""!=t.Description?t.Description:(null!=t.Comment_Text?t.Comment_Text:"")+(null!=t.Comment_Mood?" "+t.Comment_Mood:"")},this.thumbSize="@400",this.imageUrl=function(){return t.Entity.imageUrl()},this.previewUrl=function(){return t.Entity.previewUrl()},this.detailUrl=function(){return t.Entity.detailUrl()},this.shareUrl=function(){return t.Entity.shareUrl()},e&&$.extend(this,e),this.UniqueKey=GetUniqueKey(this.Creator,this.CreationTicks),this.NoseDto=new NoseDto({LoginName:this.Creator}),this.Entity=new NoseDto({LoginName:this.Creator}),this.NewsType){case NewsType.PhotoBlog:this.UniqueKey=GetUniqueKey(this.Creator,this.Impression_CreationTicks),this.Entity=new PhotoBlogDto(this);break;case NewsType.PoI:this.UniqueKey=GetUniqueKey(this.Creator,this.PoiPublished_CreationTicks),this.Entity=new PoiDto(this);break;case NewsType.Tour:this.UniqueKey=GetUniqueKey(this.Creator,this.Track_CreationTicks),this.Entity=new TourDto(this);break;case NewsType.Event:this.UniqueKey=GetUniqueKey(this.Creator,this.Event_CreationTicks),this.Entity=new EventDto(this);break;case NewsType.Comment:switch(this.UniqueKey=this.Comment_CommentItemId,this.Comment_CommentItemType){case"PhotoBlog":this.Entity=new PhotoBlogDto({UniqueKey:this.UniqueKey});break;case"FavoriteLocation":this.Entity=new PoiDto({UniqueKey:this.UniqueKey});break;case"Track":case"Tour":this.Entity=new TourDto({UniqueKey:this.UniqueKey,Latitude:this.Comment_CommentItemLatitude,Longitude:this.Comment_CommentItemLongitude});break;case"Community":this.Entity=new CommunityDto({TagName:this.Comment_CommentItemId},new NoseDto({}))}break;case NewsType.Rating:switch(this.UniqueKey=this.Rating_RatedItemId,this.Rating_RatedItemType){case"FavoriteLocation":this.Entity=new PoiDto({UniqueKey:this.UniqueKey});break;case"PhotoBlog":this.Entity=new PhotoBlogDto({UniqueKey:this.UniqueKey});break;case"Track":case"Tour":this.Entity=new TourDto({UniqueKey:this.UniqueKey,Latitude:this.Rating_RatedItemLatitude,Longitude:this.Rating_RatedItemLongitude})}break;case NewsType.Mashup:this.UniqueKey=this.Mashup_CommunityTag,this.Entity=new CommunityDto({TagName:this.Mashup_CommunityTag},new NoseDto({}))}},NoseDto=function(o){function e(e){var t=o.call(this,e)||this;return t.thumbSize="@200",t.imageUrl=function(){return gnSettings.BaseDataUrl+"/profimg/"+encodeURIComponent(t.LoginName)},t.previewUrl=function(){return"/nose/preview/"+encodeURIComponent(t.LoginName)},t.detailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/"+encodeURIComponent(t.LoginName)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.shareUrl=function(){return gnSettings.BaseUrl+"/"+encodeURIComponent(t.LoginName)},t}return __extends(e,o),e.prototype.IsInCommunity=function(e){return this.Communities&&-1!=$.inArray(e,this.Communities)},e}(BaseNavigableItem),PageableItem=function(){function e(e,t,o,n){this.items=ko.observableArray(),this.itemLastKnownTicks=MAX_DATE_TIME_TICKS,this.hasMoreItems=ko.observable(!0),this.itemsRequestActive=ko.observable(!1),this.tagName=e,this.itemPageUrl=t,this.itemPageSize=o,this.newItem=n}return e.prototype.newItem=function(e){return null},e.prototype.onAddItems=function(){},e.prototype.addItems=function(e){if(null!=e){if(0<e.length){for(var t in this.itemLastKnownTicks=e[e.length-1].CreationTicks,e)this.items.push(this.newItem(e[t]));e.length%this.itemPageSize!=0&&this.hasMoreItems(!1)}else this.hasMoreItems(!1);this.onAddItems&&this.onAddItems()}},e.prototype.pageItems=function(){var t=this;!this.itemsRequestActive()&&this.hasMoreItems()&&(this.itemsRequestActive(!0),$.ajax({type:"POST",url:this.itemPageUrl,cache:!1,data:{lastKnownTicks:this.itemLastKnownTicks,pageSize:this.itemPageSize,community:this.tagName},dataType:"json",success:function(e){e&&0<e.length?t.addItems(e):t.hasMoreItems(!1),t.itemsRequestActive(!1)},error:function(e){429!=e.status&&dialog.show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.itemsRequestActive(!1)}}))},e}(),PhotoBlogDto=function(o){function e(e){var t=o.call(this,e)||this;return t.groupName=ko.observable(""),t.groupCount=ko.observable(1),t.groupType=ko.observable(GroupTypeEnum.None),t.isGrouped=ko.observable(!1),t.isLastIncompleteGroup=ko.observable(!1),t.dateString=ko.computed(function(){var e=GetDateFromTicks(t.CreationTicks);return t.groupType()==GroupTypeEnum.ByDay?moment(e).format("LL"):t.groupType()==GroupTypeEnum.ByWeek?GetLangRes("Common_lblCalendarWeekFormat","CW %cw%").replace("%cw%",moment(e).format("w"))+" "+moment(e).format("YYYY"):t.groupType()==GroupTypeEnum.ByMonth?moment(e).format("MMMM YYYY"):moment(e).format("LLL")}),t.thumbSize="@400",t.imageUrl=function(){return gnSettings.BaseDataUrl+"/pbimg/"+encodeURIComponent(t.UniqueKey)},t.previewUrl=function(){return"/impression/preview/"+encodeURIComponent(t.UniqueKey)},t.detailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/impression/detail/"+encodeURIComponent(t.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.shareUrl=function(){return gnSettings.BaseUrl+"/impression/detail/"+encodeURIComponent(t.UniqueKey)},t.commentItemType=CommentItemType.PhotoBlog,t.isCommentsAllowed=function(){return!0},t.isUserAdmin=function(e){return t.LoginName==e},t}return __extends(e,o),e}(BaseNavigableItem),PoiDto=function(o){function e(e){var t=o.call(this,e)||this;return t.thumbSize="@100",t.imageUrl=function(){return gnSettings.BaseDataUrl+"/locimg/"+encodeURIComponent(t.UniqueKey)},t.previewUrl=function(){return"/poi/preview/"+encodeURIComponent(t.UniqueKey)},t.detailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/poi/detail/"+encodeURIComponent(t.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.shareUrl=function(){return gnSettings.BaseUrl+"/poi/detail/"+encodeURIComponent(t.UniqueKey)},t.commentItemType=CommentItemType.FavoriteLocation,t.isCommentsAllowed=function(){return!0},t.isUserAdmin=function(e){return t.LoginName==e},t}return __extends(e,o),e}(BaseNavigableItem),TourDto=function(o){function e(e){var t=o.call(this,e)||this;return t.thumbSize="",t.imageUrl=function(){return""},t.previewUrl=function(){return"/track/preview/"+encodeURIComponent(t.UniqueKey)},t.detailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/track/detail/"+encodeURIComponent(t.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.shareUrl=function(){return gnSettings.BaseUrl+"/track/detail/"+encodeURIComponent(t.UniqueKey)},t.commentItemType=CommentItemType.Tour,t.isCommentsAllowed=function(){return!0},t.isUserAdmin=function(e){return t.LoginName==e},!t.StartLatitude&&t.Latitude&&(t.StartLatitude=t.Latitude),!t.StartLongitude&&t.Longitude&&(t.StartLongitude=t.Longitude),!t.StartLatitude&&e.Track_StartLatitude&&(t.StartLatitude=e.Track_StartLatitude),!t.StartLongitude&&e.Track_StartLongitude&&(t.StartLongitude=e.Track_StartLongitude),t}return __extends(e,o),e}(BaseNavigableItem),UserDto=function(e){this.LoginName=e.LoginName,this.IsActivated=e.IsActivated};