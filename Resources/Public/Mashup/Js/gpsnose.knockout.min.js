var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),BaseViewModel=function(){function e(){this.SupportedDefaultKeywords=["fireplace","pingpongtische-ch","osm-wc","osm-bicycle","osm-medi","osm-pets","osm-emobility"]}return e.prototype.GetQrCodeUrl=function(e){return gnSettings.BaseUrl+"/Components/QrCode?tag="+encodeURIComponent(e)},e.prototype.GetLoginUrl=function(e){return(e||"/Account/Login")+"?returnUrl="+encodeURIComponent("/"+window.location.href.replace(/^(?:\/\/|[^\/]+)*\//,""))},e.prototype.GetHtmlFromString=function(e){return e?e=(e=(e=(e=e.replace(/(?:\r\n|\r|\n)/g," <br> ")).replace(/(https?:\/\/[^\s]+)/g,function(e){return'<a href="'+e+'" data-external>'+decodeURI(e)+"</a>"})).replace(/( |^)www\.[^\s]+\.[^\s]+/g,function(e){return'<a href="https://'+e.trim()+'" data-external>'+decodeURI(e)+"</a>"})).replace(/[\w-\.]+@([\w-]+\.)+[\w-]{2,4}/g,function(e){return'<a href="mailto:'+e+'">'+decodeURI(e)+"</a>"}):""},e.prototype.GetKeywordDisplayName=function(e){return e?0===e.lastIndexOf("i-",0)&&2<e.length?e.substr(2):"grillstelle-ch"==e?"fireplace":e:""},e.prototype.GetDefaultImageFromKeywords=function(e){var o=this;if(Array.isArray(e)||null==e||(e=e.split(";")),Array.isArray(e)){e=e.map(function(e){var t=o.GetKeywordDisplayName(e);if(-1!=o.SupportedDefaultKeywords.indexOf(t))return t;e=t.lastIndexOf("-");if(0<e){t=t.substring(0,e);if(-1!=o.SupportedDefaultKeywords.indexOf(t))return t;e=t.lastIndexOf("-");if(0<e){e=t.substring(0,e);if(-1!=o.SupportedDefaultKeywords.indexOf(e))return e}}return null}).filter(function(e){return null!=e});if(0<e.length&&e[0])return gnSettings.ImagePath+"/default_"+e[0].replace(/\-/g,"_")+".png"}return""},e}(),BaseComponentsViewModel=function(){function e(e){this.ImagePath=ko.observable(e||"/Content/Mashup/Images")}return e.prototype.GetLoginUrl=function(e){return(e||"/Account/Login")+"?returnUrl="+encodeURIComponent("/"+window.location.href.replace(/^(?:\/\/|[^\/]+)*\//,""))},e}();window.MAX_DATE_TIME_TICKS="3155378975999999999",ko.bindingHandlers.modal={init:function(e,t){jQuery(e).modal();var o=t();"function"==typeof o&&jQuery(e).on("hide.bs.modal",function(){o(!1)}),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){jQuery(e).modal("hide")})},update:function(e,t){t=t();ko.utils.unwrapObservable(t)?jQuery(e).modal("show"):jQuery(e).modal("hide")}},ko.bindingHandlers.enterkey={init:function(t,e,o,n){var i=e();jQuery(t).on("keypress",function(e){return 13!==(e.which||e.keyCode)||(jQuery(t).trigger("blur"),i.call(n),!1)})}},ko.bindingHandlers.bsChecked={init:function(e,t,o,n,i){var a=t(),s=null;o.has("checkedValue")?s=ko.utils.unwrapObservable(o.get("checkedValue")):o.has("value")&&(s=ko.utils.unwrapObservable(o.get("value")));ko.bindingHandlers.event.init(e,function(){return{change:function(){a(s)}}},o,n,i)},update:function(e,t,o,n,i){jQuery(e).val()==ko.unwrap(t())&&setTimeout(function(){jQuery(e).closest(".btn").button("toggle")},10)}},ko.bindingHandlers.fancyboxAttr={update:function(e,t,o,n,i){var a=t(),s=o.get("group")||"",t=o.get("external");o.get("disabled");o.get("disabled")||(t?(jQuery(e).attr("data-external",""),jQuery(e).attr("href",a.DetailUrl())):(jQuery(e).attr("data-fancybox",s),(o=o.get("fancyboxType"))&&jQuery(e).attr("data-type",o),jQuery(e).attr("data-src")||jQuery(e).attr("data-src",a.PreviewUrl())))}},ko.bindingHandlers.dateTimePicker={init:function(e,o,t){var n=t().dateTimePickerOptions||{},t=ko.utils.unwrapObservable(o());t&&(n.date=t),jQuery(e).datetimepicker(n),ko.utils.registerEventHandler(e,"change.datetimepicker",function(e){var t=o();ko.isObservable(t)&&t(e.date||e.target.value||null)}),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){jQuery(e).datetimepicker("destroy")})},update:function(e,t){t=ko.utils.unwrapObservable(t());jQuery(e).datetimepicker&&jQuery(e).datetimepicker("date",t)}},ko.extenders.numeric=function(i,a){var e=ko.computed({read:i,write:function(e){var t=i(),o=Math.pow(10,a),n=isNaN(e)?0:+e,o=Math.round(n*o)/o;o!==t?i(o):e!==t&&i.notifySubscribers(o)}});return e(i()),e};var CommunityDetailViewModel=function(n){function e(e,t){var o=n.call(this)||this;return o.MembersPageUrl="/Community/Page_Members",o.Members=ko.observableArray(),o.MembersPageSize=gnSettings.CommunityMembersPageSize,o.MembersLastJoinTicks=window.MAX_DATE_TIME_TICKS,o.HasMoreMembers=ko.observable(!0),o.MembersRequestActive=ko.observable(!1),o.MembersRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),o.TagName=e.TagName,o.NoseDto=new NoseDto({LoginName:e.CreatorLoginName}),o.Entity=new CommunityDto(e,t),o}return __extends(e,n),e.prototype.DisplayName=function(){return this.Entity.DisplayName()},e.prototype.OnAddMembers=function(e){},e.prototype.AddMembers=function(e){if(null!=e){if(0<e.length){for(var t in this.MembersLastJoinTicks=e[e.length-1].JoinTicks,e){t=new CommunityMemberDto(e[t]);t.IsAdmin=t.LoginName==this.Entity.CreatorLoginName()||this.Entity.Admins()&&-1!=jQuery.inArray(t.LoginName,this.Entity.Admins()),this.Members.push(t)}e.length%this.MembersPageSize!=0&&this.HasMoreMembers(!1)}else this.HasMoreMembers(!1);this.OnAddMembers&&this.OnAddMembers(e)}},e.prototype.PageMembers=function(){var t=this;!this.MembersRequestActive()&&this.HasMoreMembers()&&(this.MembersRequestActive(!0),jQuery.ajax({type:"POST",url:this.MembersPageUrl,cache:!1,data:{lastKnownTicks:this.MembersLastJoinTicks,profileTag:this.TagName,pageSize:this.MembersPageSize},dataType:"json",success:function(e){e&&0<e.length?t.AddMembers(e):t.HasMoreMembers(!1),t.MembersRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.MembersRequestActive(!1)}}))},e}(BaseViewModel),CarouselViewModel=function(a){function e(e){var t=a.call(this,e&&e.imagePath||null)||this;if(t.IsHidden=ko.observable(!1),t.HasCarousel=ko.observable(!1),t.Slides=ko.observableArray(),t.IsHidden(e&&e.isHidden),t.HasCarousel(e&&e.hasCarousel),t.Slides.push(new CarouselItemDto(GetLangRes("Shared_HomePageCarouselView0_Title",""),GetLangRes("Shared_HomePageCarouselView0_Text",""))),t.HasCarousel()){var o,n=[{title:GetLangRes("Shared_HomePageCarouselView1_Title",""),text:GetLangRes("Shared_HomePageCarouselView1_Text","")},{title:GetLangRes("Shared_HomePageCarouselView2_Title",""),text:GetLangRes("Shared_HomePageCarouselView2_Text","")},{title:GetLangRes("Shared_HomePageCarouselView3_Title",""),text:GetLangRes("Shared_HomePageCarouselView3_Text","")},{title:GetLangRes("Shared_HomePageCarouselView4_Title",""),text:GetLangRes("Shared_HomePageCarouselView4_Text","")},{title:GetLangRes("Shared_HomePageCarouselView5_Title",""),text:GetLangRes("Shared_HomePageCarouselView5_Text","")},{title:GetLangRes("Shared_HomePageCarouselView6_Title",""),text:GetLangRes("Shared_HomePageCarouselView6_Text","")},{title:GetLangRes("Shared_HomePageCarouselView7_Title",""),text:GetLangRes("Shared_HomePageCarouselView7_Text","")},{title:GetLangRes("Shared_HomePageCarouselView8_Title",""),text:GetLangRes("Shared_HomePageCarouselView8_Text","")}];for(o in n){var i=n[o];t.Slides.push(new CarouselItemDto(i.title,i.text))}}return t}return __extends(e,a),e}(BaseComponentsViewModel);ko.components.register("ma-gpsnose-carousel",{viewModel:{createViewModel:function(e,t){return new CarouselViewModel(e)}},template:'\n<header class="header-carousel" data-bind="visible: ! IsHidden()">\n    <div id="carousel1" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="10000" data-bs-keyboard="true">\n        <div class="carousel-indicators" data-bind="foreach: Slides, visible: Slides().length > 1">\n            <button type="button" data-bs-target="#carouselExampleCaptions" data-bind="attr: { \'data-bs-slide-to\': $index() }, css: { active: $index() == 0 }"></button>\n        </div>\n        <div class="carousel-inner" data-bind="foreach: Slides">\n            <div class="carousel-item" data-bind="css: { active: $index() == 0 }">\n                <img data-bind="attr: { src: $parent.ImagePath() + \'/bg\' + $index() + \'.png\', atr: Text }">\n                <div class="container">\n                    <div class="carousel-caption">\n                        <div class="row">\n                            <div class="col-4">\n                                <img class="intropage"data-bind="attr: { src: $parent.ImagePath() + \'/fg\' + $index() + \'.png\', atr: Text }">\n                            </div>\n                            <div class="col-8">\n                                <h2 data-bind="text: Title"></h2>\n                                <p data-bind="text: Text"></p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <button class="carousel-control-prev" type="button" data-bs-target="#carousel1" data-bs-slide="prev" data-bind="visible: Slides().length > 1">\n            <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n            <span class="visually-hidden">Previous</span>\n        </button>\n        <button class="carousel-control-next" type="button" data-bs-target="#carousel1" data-bs-slide="next" data-bind="visible: Slides().length > 1">\n            <span class="carousel-control-next-icon" aria-hidden="true"></span>\n            <span class="visually-hidden">Next</span>\n        </button>\n    </div>\n</header>'});var CommentsViewModel=function(o){function e(e){var t=o.call(this,e&&e.imagePath||null)||this;return t.CommentPageUrl="/Comment/Page_Comment",t.CommentSaveUrl="/WebApi/SaveComment",t.Comments=ko.observableArray(),t.CommentsPageSize=gnSettings.CommentsPageSize,t.CommentsLastKnownTicks=window.MAX_DATE_TIME_TICKS,t.HasMoreComments=ko.observable(!0),t.CommentsRequestActive=ko.observable(!1),t.LoginName=ko.observable(""),t.IsActivated=ko.observable(!1),t.IsAddAllowed=ko.observable(!1),t.IsReadonly=ko.observable(!1),t.IsLoggedIn=ko.observable(!1),t.CommentAddText=ko.observable(""),t.CommentAddMood=ko.observable(""),t.CommentEditText=ko.observable(""),t.CommentEditMood=ko.observable(""),t.SaveCommentRequestActive=ko.observable(!1),t.UniqueKey=e&&e.uniqueKey||"",t.HideTitle=e&&e.hideTitle||!1,e&&e.commentPageUrl&&(t.CommentPageUrl=e.commentPageUrl),e&&e.commentSaveUrl&&(t.CommentSaveUrl=e.commentSaveUrl),e&&e.loginUrl&&(t.LoginUrl=e.loginUrl),e&&e.onChangeComments&&(t.OnChangeComments=e.onChangeComments),e&&e.loginName&&t.LoginName(e.loginName),e&&e.isActivated&&t.IsActivated(e.isActivated),e&&e.entity&&(t.Entity=e.entity,t.ItemType=t.Entity.CommentItemType,t.IsAddAllowed(t.Entity.IsCommentsAllowed())),e&&e.isReadonly&&t.IsReadonly(e.isReadonly),t.IsLoggedIn(0<t.LoginName().length),t.Moods=ko.observableArray(["😊","😁","❤","💤","😱","😔","😭","😠"]),t.CommentAddMood.subscribe(function(e){0<e.length&&(0<t.CommentAddText().length?(t.CommentAddText(t.CommentAddText().trim()+"  "+e),t.CommentAddMood("")):t.AddComment())}),e&&e.comments&&0<e.comments.length?t.AddComments(e.comments):e&&e.comments?t.HasMoreComments(!1):t.PageComments(),t}return __extends(e,o),e.prototype.OnChangeComments=function(e){},e.prototype.AddComments=function(e){if(null!=e){if(0<e.length){for(var t in this.CommentsLastKnownTicks=e[e.length-1].CreationTicks,e)this.Comments.push(new CommentDto(e[t]));e.length%this.CommentsPageSize!=0&&this.HasMoreComments(!1)}else this.HasMoreComments(!1);this.OnChangeComments&&this.OnChangeComments(jQuery("#commentsContainer"))}},e.prototype.PageComments=function(){var t=this;!this.CommentsRequestActive()&&this.HasMoreComments()&&(this.CommentsRequestActive(!0),jQuery.ajax({type:"POST",url:this.CommentPageUrl,cache:!1,data:{lastKnownTicks:this.CommentsLastKnownTicks,uniqueKey:this.UniqueKey,pageSize:this.CommentsPageSize,itemType:this.ItemType},dataType:"json",success:function(e){e&&0<e.length?t.AddComments(e):t.HasMoreComments(!1),t.CommentsRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.CommentsRequestActive(!1)}}))},e.prototype.AddComment=function(){var e,t=this;0==this.CommentAddText().length&&0==this.CommentAddMood().length?dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Comment_lblErrorTextRequired","Text is required!"),null):(e=new CommentDto({Creator:this.LoginName(),Text:this.CommentAddText(),Mood:this.CommentAddMood(),CreationTicks:GetTicksFromDate(new Date)}),this.SaveComment(e,!1,function(){t.CommentAddText(""),t.CommentAddMood("")}))},e.prototype.LongComment=function(){var t=this;jQuery(document).off("gn.dialog.show").on("gn.dialog.show",function(){setTimeout(function(){jQuery("#CommentLongField").trigger("select")},500)}),dialog.Show(GetLangRes("Common_lblCommentAdd","Add comment"),'<textarea id="CommentLongField" rows="4" cols="50" maxlength="5000" type="text" class="form-control" placeholder="'+GetLangRes("Common_lblCommentAddHint","Write comment")+'">'+this.CommentAddText()+"</textarea>",function(){var e=String(jQuery("#CommentLongField").val());e&&0<e.length?(e=new CommentDto({Creator:t.LoginName(),Text:e,CreationTicks:GetTicksFromDate(new Date)}),t.SaveComment(e,!1,function(){dialog.Hide(),t.CommentAddText(""),t.CommentAddMood(""),jQuery("#CommentLongField").val("");var e=t.Comments();t.Comments([]),t.Comments(e),t.OnChangeComments&&t.OnChangeComments(jQuery("#commentsContainer"))})):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Comment_lblErrorTextRequired","Text is required!"),null)})},e.prototype.EditComment=function(t){var o=this;jQuery(document).off("gn.dialog.show").on("gn.dialog.show",function(){setTimeout(function(){jQuery("#CommentEditField").trigger("select")},500)}),dialog.Show(GetLangRes("Common_lblCommentEdit","Edit comment"),'<textarea id="CommentEditField" rows="4" cols="50" maxlength="5000" type="text" class="form-control" placeholder="'+GetLangRes("Common_lblCommentEditHint","Remove comment")+'">'+t.Text+"</textarea>",function(){var e=String(jQuery("#CommentEditField").val());e&&0<e.length?(t.Text=e,o.SaveComment(t,!0,function(){dialog.Hide();var e=o.Comments();o.Comments([]),o.Comments(e),o.OnChangeComments&&o.OnChangeComments(jQuery("#commentsContainer"))})):o.DeleteComment(t)})},e.prototype.DeleteComment=function(e){var t=this;dialog.ShowDestructive(GetLangRes("Common_lblAreYouSureTitle","Are you sure?"),GetLangRes("Common_lblAreYouSureMessage","This can not be undone, proceed anyway?"),function(){e.Text=null,e.Mood=null,t.SaveComment(e,!0,function(){t.Comments.remove(e)}),dialog.Hide()})},e.prototype.SaveComment=function(t,e,o){var n=this;this.SaveCommentRequestActive()||(this.SaveCommentRequestActive(!0),jQuery.ajax({type:"POST",url:this.CommentSaveUrl,cache:!1,data:{uniqueKey:this.UniqueKey,text:t.Text,mood:t.Mood,itemType:this.ItemType,creationTicks:t.CreationTicks,isUpdate:e},dataType:"json",success:function(e){e&&0<e.ErrorCode?dialog.Show(GetLangRes("Common_lblError","Error"),e.Message,null):(e&&"string"==typeof e&&e.match(/^-{0,1}\d+$/)&&(t.CreationTicks=e),e=ko.utils.arrayFirst(n.Comments(),function(e){return t.CreationTicks===e.CreationTicks}),null==t.Text&&null===t.Mood&&e?(n.Comments.remove(e),n.OnChangeComments&&n.OnChangeComments(jQuery("#commentsContainer"))):e?(e.Text=t.Text,e.Mood=t.Mood):(n.Comments.splice(0,0,t),n.OnChangeComments&&n.OnChangeComments(jQuery("#commentsContainer"))),o&&o()),n.SaveCommentRequestActive(!1)},error:function(){dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Comment_lblErrorCannotSave","The comment could not be saved!"),null),n.SaveCommentRequestActive(!1)}}))},e}(BaseComponentsViewModel);ko.components.register("ma-gpsnose-comments",{viewModel:{createViewModel:function(e,t){return new CommentsViewModel(e)}},template:'<div id="commentsContainer"><h3 data-bind="text: GetLangRes(\'Common_lblComments\', \'Comments\'), visible: ! HideTitle"></h3><div data-bind="if: IsAddAllowed() && IsLoggedIn() && ! IsActivated() && ! IsReadonly()"><div class="alert alert-info"><i class="glyphicon glyphicon-info-sign fas fa-info-circle"></i><span data-bind="text: \' \' + GetLangRes(\'Comment_lblActivationRequired\', \'To add comments, it is required to validate your account, please validate your account in the GpsNose-App!\')"></span></div></div><div data-bind="if: IsAddAllowed() && ! IsLoggedIn() && ! IsReadonly()"><div class="alert alert-info"><i class="glyphicon glyphicon-info-sign fas fa-info-circle"></i><span data-bind="text: \' \' + GetLangRes(\'Community_loginRequired\', \'Login first to interact\')"></span><button type="button" class="btn btn-info btn-sm pull-right float-right float-end" data-bind="click: function() { document.location.href = $data.GetLoginUrl($data.LoginUrl); }"><i class="glyphicon glyphicon-user fas fa-user"></i><span data-bind="text: \' \' + GetLangRes(\'Common_btnLogin\', \'Login\')"></span></button></div></div><div data-bind="if: IsAddAllowed() && IsLoggedIn() && IsActivated() && ! IsReadonly()"><form onsubmit="AddComment()"><div class="form-group mb-3"><div class="input-group"><div class="input-group-btn input-group-prepend"><div class="btn btn-default btn-outline-secondary" type="button" style="letter-spacing:-2px;" data-fancybox data-src="#moods-dialog" data-bind="attr: { \'data-remove\': MA_GPSNOSE_IS_MASHUP }">&#x1F60A;&#x1F601;&#x1F631;&#x1F614;</div><button type="button" class="btn btn-default btn-outline-secondary" data-bind="click: function() { LongComment() }"><i class="glyphicon glyphicon-align-left fas fa-align-left"></i> </button></div><input type="text" maxlength="1000" class="form-control" data-bind="textInput: CommentAddText, attr: { \'placeholder\': GetLangRes(\'Common_lblCommentAddHint\', \'Write comment\') }" /><div class="input-group-btn input-group-append"><button class="btn btn-primary" type="submit" data-bind="attr: { \'disabled\': SaveCommentRequestActive() }, click: function(){ AddComment() }"><i class="glyphicon glyphicon-comment fas fa-comment-alt" data-bind="visible: ! SaveCommentRequestActive()"></i> <i class="glyphicon glyphicon-repeat gly-spin fas fa-redo-alt" data-bind="visible: SaveCommentRequestActive()"></i> <span data-bind="text: GetLangRes(\'Common_btnSend\', \'Send\')"></span></button></div></div></div></form><div id="moods-dialog" data-bind="foreach: Moods" style="display:none;" class="moods-dialog"><div class="btn btn-default btn-outline-secondary p-1" data-bind="text: $data, click: function() { if (jQuery().fancybox) jQuery.fancybox.close(true); $parent.CommentAddMood($data); }"></div></div></div><div data-bind="if: Comments().length == 0"><div class="alert alert-info" data-bind="text: GetLangRes(\'Common_lblNoCommentsAvailable\', \'Currently there are no comments available for this item.\')"></div></div><div class="comments" data-bind="if: Comments().length > 0"><div class="masonry row" data-bind="foreach: Comments.sort(function (l, r) { return l.CreationTicks < r.CreationTicks ? 1 : -1 })">\x3c!-- ko if: ($index() === 0) --\x3e<div class="masonry-sizer col-md-4 col-sm-6"></div>\x3c!-- /ko --\x3e<div class="masonry-item col-md-4 col-sm-6"><div class="outer"><div class="media d-flex mb-2"><div class="media-left mr-2 me-2"><img class="media-object img-circle rounded-circle" width="32px" data-bind="attr: { src: $data.NoseDto.ImageUrl() + \'@200\', onerror: \'ImageErrorHandler(this, \\\'\' + $parent.ImagePath() + \'/EmptyUser.png\\\')\' }" /></div><div class="media-body middle flex-grow-1" data-bind="text: $data.Creator"></div><div class="media-body middle flex-grow-1 mood" data-bind="text: $data.Mood"></div><div class="media-right middle" data-bind="text: GetAgeStringFromTicks($data.CreationTicks)"></div></div><div data-bind="text: $data.Text, visible: HasText(), css: ($data.Text && $data.Text.length > 20 ? \'text\' : \'text-big\')"></div><div class="clearfix" data-bind="if: ! $parent.IsReadonly()"><img class="ma-crown" data-bind="attr: { src: $parent.ImagePath() + \'/IcActionCrown.png\' }, visible: $parent.Entity.IsUserAdmin($data.Creator)" /><div class="btn-group btn-group-sm pull-right float-right float-end" role="group" aria-label="share"><a class="btn btn-default btn-outline-secondary" data-popup data-bind="attr: { href: $data.NoseDto.DetailUrl(), title: GetLangRes(\'Common_btnShowProfile\', \'Show profile\') }"><i class="glyphicon glyphicon-user fas fa-user"></i><span data-bind="text: \' \' + GetLangRes(\'Common_btnShowProfile\', \'Show profile\')"></span></a><div class="btn btn-default btn-outline-secondary" data-bind="visible: $data.HasText(), click: function() { if (! $parent.SaveCommentRequestActive()) { if (jQuery().fancybox) jQuery.fancybox.close(true); $parent.EditComment($data); } }, attr: { \'disabled\': $parent.SaveCommentRequestActive(), \'data-remove\': $parent.LoginName() != $data.Creator, title: GetLangRes(\'Common_btnEdit\', \'Edit\') }"><i class="glyphicon glyphicon-edit fas fa-edit"></i><span data-bind="text: \' \' + GetLangRes(\'Common_btnEdit\', \'Edit\')"></span></div><div class="btn btn-danger" data-bind="click: function() { if (! $parent.SaveCommentRequestActive()) $parent.DeleteComment($data); }, attr: { \'disabled\': $parent.SaveCommentRequestActive(), \'data-remove\': $parent.LoginName() != $data.Creator, title: GetLangRes(\'Common_btnDelete\', \'Delete\') }"><i class="glyphicon glyphicon-remove fas fa-times"></i></div></div></div></div></div></div></div><div class="text-center" data-bind="if: ! IsReadonly()"><div class="btn btn-default btn-outline-secondary btn-lg" data-bind="click: function(){ PageComments() }, visible: HasMoreComments(), attr: { disabled: CommentsRequestActive() }"><div data-bind="visible: ! CommentsRequestActive(), click: function () { PageComments(); }"><i class="glyphicon glyphicon-cloud-download fas fa-cloud-download-alt"></i><span data-bind="text: \' \' + GetLangRes(\'Common_lblLoadMore\', \'more..\')"></span></div><div data-bind="visible: CommentsRequestActive()"><i class="glyphicon glyphicon-repeat gly-spin fas fa-redo-alt"></i>'+"<span data-bind=\"text: ' ' + GetLangRes('Common_lblRequestInProgress', 'Request in progress')\"></span></div></div></div></div>"});var DialogViewModel=function(){function e(){this.Title=ko.observable(""),this.Message=ko.observable(""),this.IsDestructive=ko.observable(!1),this.OkCallback=null,this.OkClicked=ko.observable(!1),this.HasOkCallback=ko.observable(!1),this.ShowDialog=ko.observable(!1)}return e.prototype.Show=function(e,t,o){this.Title(e),this.Message(t),this.IsDestructive(!1),this.OkCallback=o,this.HasOkCallback(null!=o),this.ShowDialog(0<e.length||0<t.length),this.OkClicked(!1),jQuery(document).trigger("gn.dialog.show")},e.prototype.ShowDestructive=function(e,t,o){this.Title(e),this.Message(t),this.IsDestructive(!0),this.OkCallback=o,this.HasOkCallback(null!=o),this.ShowDialog(0<e.length||0<t.length),this.OkClicked(!1),jQuery(document).trigger("gn.dialog.show")},e.prototype.Hide=function(){this.ShowDialog(!1),jQuery(document).trigger("gn.dialog.hide")},e.prototype.ClickOkButton=function(){this.OkClicked(!0),this.OkCallback&&this.OkCallback(),jQuery(document).trigger("gn.dialog.click.ok")},e.prototype.HasTitle=function(){return null!=this.Title()||0<this.Title().length},e.prototype.JoinCommunity=function(e,t,o){this.OkClicked(!1);var n=new KeywordDto(e);n.IsCommunity&&(n=GetLangRes("Common_lblJoinCommunityAreYouSure","Would you like to join the community %community%?").replace("%community%",n.GetHtml()),dialog.Show(GetLangRes("Common_lblJoinTitle","Join a community"),n,function(){jQuery.ajax({type:"POST",url:"/WebApi/JoinCommunity",cache:!1,data:{tag:e},dataType:"json",success:function(e){e&&0==e.ErrorCode?(dialog.Hide(),o&&o()):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_loginRequired","Please login first."),null)},error:function(){dialog.Show(GetLangRes("Common_lblError","Error"),"",null)}})}))},e.prototype.LeaveCommunity=function(e,t,o){this.OkClicked(!1);var n=new KeywordDto(e);n.IsCommunity&&(n=GetLangRes("Common_lblLeaveCommunityAreYouSure","Would you like to leave the community %community%?").replace("%community%",n.GetHtml()),dialog.ShowDestructive(GetLangRes("Common_lblLeaveTitle","Leave community"),n,function(){jQuery.ajax({type:"POST",url:"/WebApi/LeaveCommunity",cache:!1,data:{tag:e},dataType:"json",success:function(e){e&&0==e.ErrorCode?(dialog.Hide(),o&&o()):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_loginRequired","Please login first."),null)},error:function(){dialog.Show(GetLangRes("Common_lblError","Error"),"",null)}})}))},e}(),dialog=new DialogViewModel;ko.components.register("ma-gpsnose-dialog",{viewModel:{instance:dialog},template:'<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="dialogModalLabel" data-show="false" data-bind="modal: ShowDialog"><div class="modal-dialog" role="document"><form data-bind="submit: function(){ ClickOkButton() }"><div class="modal-content"><div class="modal-header" data-bind="visible: Title().length > 0"><button type="button" class="close d-none" data-dismiss="modal" data-bind="attr: { \'aria-label\': GetLangRes(\'Common_btnClose\', \'Close\') }"><span>&times;</span></button><h4 class="modal-title" data-bind="text: $data.Title"></h4><button type="button" class="close btn-close hidden" data-dismiss="modal" data-bs-dismiss="modal" data-bind="attr: { \'aria-label\': GetLangRes(\'Common_btnClose\', \'Close\') }"><span class="visually-hidden">&times;</span></button></div><div class="modal-body"><span data-bind="html: Message"></span></div><div class="modal-footer"><button type="button" class="btn btn-default btn-outline-secondary" data-dismiss="modal" data-bs-dismiss="modal"><i class="glyphicon glyphicon-remove fas fa-times"></i><span data-bind="text: \' \' + GetLangRes(\'Common_btnClose\', \'Close\')"></span></button><button type="button" class="btn" data-bind="visible: HasOkCallback(), click: function(){ ClickOkButton() }, attr: { \'disabled\': OkClicked() }, css: { \'btn-danger\': IsDestructive(), \'btn-primary\': !IsDestructive() }"><i class="glyphicon glyphicon-ok fas fa-check"></i>'+"<span data-bind=\"text: ' ' + GetLangRes('Common_btnOk', 'OK')\"></span></button></div></div></form></div></div>"});var FooterViewModel=function(n){function e(e){var t=n.call(this,e&&e.imagePath||null)||this;t.IsHidden=ko.observable(e&&e.isHidden);var o=new Date;return t.Copyright="&copy; "+o.getFullYear()+" "+GetLangRes("Common_lblCompanyName","Nemanicnedanic, Inc."),t.HideCopyright=ko.observable(e&&e.hideCopyright),t.HideSupportMail=ko.observable(e&&e.hideSupportMail),t}return __extends(e,n),e}(BaseComponentsViewModel);ko.components.register("ma-gpsnose-footer",{viewModel:{createViewModel:function(e,t){return new FooterViewModel(e)}},template:'<div class="container marketing mt-auto" data-bind="ifnot: IsHidden()"><div class="row"><div class="col-md-3 col-sm-2"></div><div class="col-md-3 col-sm-4"><p class="text-center"><a href="https://itunes.apple.com/us/app/gpsnose/id892215768" data-external role="button"><img alt="App Store" data-bind="attr: { src: ImagePath() + \'/badge_app_store.png\' }"></a><span data-bind="if: ! HideSupportMail()"><br /><a href="mailto:iphone@gpsnose.com"><i class="glyphicon glyphicon-envelope fas fa-envelope"></i><span data-bind="text: \' \' + GetLangRes(\'Shared_Footer_lblSupportIos\', \'iOS support\')"></span></a></span></p></div><div class="col-md-3 col-sm-4"><p class="text-center"><a href="https://goo.gl/4q4TGl" data-external role="button"><img alt="Google Play" data-bind="attr: { src: ImagePath() + \'/badge_google_play.png\' }"></a><span data-bind="if: ! HideSupportMail()"><br /><a href="mailto:android@gpsnose.com"><i class="glyphicon glyphicon-envelope fas fa-envelope"></i><span data-bind="text: \' \' + GetLangRes(\'Shared_Footer_lblSupportAndroid\', \'Android support\') "></span></a></span></p></div><div class="col-md-3 col-sm-2"></div></div><div data-bind="if: ! HideCopyright()"><hr class="divider"><footer><p class="text-center" data-bind="html: Copyright"></p></footer></div></div>'});var KeepAliveViewModel=function(){function e(e){this.IsLoggedIn=ko.observable(!0);var t=600;null!=e&&0<=e.interval&&(t=Math.max(60,e.interval)),this.StartInterval(t)}return e.prototype.IsStillLoggedIn=function(t){jQuery.ajax({type:"POST",url:"/Login/IsStillLoggedIn",cache:!1,data:{},dataType:"json",success:function(e){null!=t&&t(e)},error:function(){null!=t&&t(!1)}})},e.prototype.StartInterval=function(e){var t=this;setInterval(function(){t.IsStillLoggedIn(function(e){t.IsLoggedIn(e)})},1e3*e)},e}();ko.components.register("ma-gpsnose-keepalive",{viewModel:{createViewModel:function(e,t){return new KeepAliveViewModel(e)}},template:'<div data-bind="if: ! IsLoggedIn()"><div class="alert alert-danger"><i class="glyphicon glyphicon-info-sign fas fa-info-circle"></i><span data-bind="text: \' \' + GetLangRes(\'Common_lblLoggedOut\', \'You have been logged out. To continue with your work, you have to sign in again.\')"></span><button type="button" class="btn btn-danger btn-sm pull-right float-right float-end" data-bind="click: function() { location.reload(); }"><i class="glyphicon glyphicon-user fas fa-user"></i>'+"<span data-bind=\"text: ' ' + GetLangRes('Common_btnLogin', 'Login')\"></span></button></div></div>"});var KeywordsViewModel=function(){function e(e){var t=this;this.Keywords=ko.observableArray(),this.SelectedKeywords=ko.observableArray(),this.NewKeyword=ko.observable(""),this.OnSelectionChange=e&&e.onSelectionChange||null,this.OnKeywordFieldChange=e&&e.onKeywordFieldChange||null,this.SearchClasses=e&&e.searchClasses||"input-group col-lg-3 col-md-6",this.IsEditable=ko.observable(e&&e.isEditable||!1),e&&ko.isObservable(e.isRequired)?this.IsRequired=e.isRequired:this.IsRequired=ko.observable(!0),this.NoEntryLabel=ko.observable(e&&e.noEntryLabel||null),this.SelectedKeywords.subscribe(function(e){t.OnSelectionChange&&t.OnSelectionChange(t.SelectedKeywords())}),this.NewKeyword.subscribe(function(e){t.OnKeywordFieldChange&&t.OnKeywordFieldChange(e)}),this.AddKeywords(e&&e.keywords||[],!1),e&&e.keywordString&&this.AddKeywords(e.keywordString.split(";"),!1),ko.utils.arrayForEach(e&&e.selectedKeywords||[],function(e){t.SelectedKeywords.push(e)})}return e.prototype.OnSelectionChange=function(e){},e.prototype.OnKeywordFieldChange=function(e){},e.prototype.AddKeywords=function(e,i){var a=this;ko.utils.arrayForEach(e,function(t){var o,e,n=!0;ko.utils.arrayForEach(a.Keywords()||[],function(e){t==e.Name()&&(n=!1)}),n&&(o=i,ko.utils.arrayForEach(a.SelectedKeywords(),function(e){e==t&&(o=!0)}),e=new KeywordDto(t.toLowerCase()),a.Keywords.push(e),e.IsSelected.subscribe(function(e){a.SelectedKeywords.removeAll(),ko.utils.arrayForEach(a.Keywords()||[],function(e){e.IsSelected()&&a.SelectedKeywords.push(e.Name())})}),e.IsSelected(o))})},e.prototype.AddKeyword=function(){var e,t,o;0<this.NewKeyword().length&&(e=this.NewKeyword().replace(/[^a-zA-Z0-9\ \.\-_]/gi,""),t=[],o=0,ko.utils.arrayForEach(e.split(" "),function(e){e&&0<e.length&&(t[o]=e,o++)}),0<t.length?(this.AddKeywords(t,!0),this.NewKeyword("")):dialog.Show("",GetLangRes("Common_lblCharsNotAllowed","To add a keyword you have to enter a valid character"),null))},e}();ko.components.register("ma-gpsnose-keywords",{viewModel:{createViewModel:function(e,t){return new KeywordsViewModel(e)}},template:'<div class="keywords"><div data-bind="if: IsEditable()"><div data-bind="attr : { \'class\': SearchClasses }"><input type="text" name="NewKeyword" class="form-control" data-bind="textInput: NewKeyword, attr: { placeholder: GetLangRes(\'Common_lblAddKeyword\', \'Add new keyword...\') }, enterkey: AddKeyword, event: { blur: AddKeyword }, css: { \'is-invalid\': IsRequired() && SelectedKeywords().length == 0 }" /><span class="input-group-btn"><div class="btn btn-primary" data-bind="text: GetLangRes(\'Common_btnAdd\', \'Add\'), click: AddKeyword"></div></span></div><div data-bind="foreach: SelectedKeywords"><input type="hidden" name="Keywords[]" data-bind="value: $data" /></div></div><div class="alert alert-info" data-bind="visible: Keywords().length == 0 && NoEntryLabel()"><i class="glyphicon glyphicon-info-sign fas fa-info-circle"></i><span data-bind="html: \' \' + NoEntryLabel()"></span></div><div data-bind="foreach: Keywords"><a href="javascript:void(0);" data-type="ajax" data-bind="attr: { \'data-external\': MA_GPSNOSE_IS_MASHUP ? true : null, \'data-src\': (IsCommunity() && ! $parent.IsEditable() && ! MA_GPSNOSE_IS_MASHUP) ? Community.PreviewUrl() : null, \'data-fancybox\': (IsCommunity() && ! $parent.IsEditable() && ! MA_GPSNOSE_IS_MASHUP) ? \'community\' : null }, html: GetHtml(), css: { selected: IsSelected() }, click: function() { if ($parent.IsEditable()) Toggle(); else return true; }"></a></div><div class="clearfix"></div></div>'});var MoodsControlViewModel=function(){function e(e){var t=this;this.SelectedMood=ko.observable(""),this.MoodIndex=ko.observable(e&&e.index||"0"),this.Moods=ko.observableArray(e&&e.moods||["😊","😁","😂","😆","😉","😋","😍","😜","😠","😔","😥","😫","😓","😖","😷","😢","😭","😱","❤","💔","👼","👿","💀","👻","👽","🙈","🙉","🙊","💩","💣","🔥","💤","🐶","🐱","🐎","🐭","🐧","🐟","🐌","🎠","🎢","🎪","🎭","🎼","🎨","🌹","🌼","🌴","🌵","🍉","🍎","🍔","🍕","🍲","🍪","🍰","🍫","🍬","🍷","🍸","🍺","🍴","🚌","🚗","🚲","⛵","✈","🚀","☀","⭐","☁","⛅","⚡","❄","🎃","🎄","🎆","✨","🎈","🎉","🎁","⚽","⚾","🏀","🏈","🎾","🎱","🎳","⛳","🎿","🏂","🏄","🏊","🎮"]),this.OnSelectionChange=e&&e.onSelectionChange||null,this.SelectedMood.subscribe(function(e){t.OnSelectionChange&&t.OnSelectionChange(t.SelectedMood())}),this.SelectedMood(e&&e.selectedMood||"😊")}return e.prototype.OnSelectionChange=function(e){},e}();ko.components.register("ma-gpsnose-moods-control",{viewModel:{createViewModel:function(e,t){return new MoodsControlViewModel(e)}},template:'<div class="moods-control"><div class="btn btn-outline-secondary mood" data-fancybox data-bind="attr: { \'data-src\': \'#moods-dialog-\' + MoodIndex() }"><span data-bind="text: SelectedMood() + \' \'"></span><span class="caret"></span></div><input type="hidden" name="Mood" data-bind="value: SelectedMood()" /><div data-bind="foreach: Moods, attr: { \'id\': \'moods-dialog-\' + MoodIndex() }" style="display: none;" class="moods-dialog"><div class="btn btn-outline-secondary p-1" data-bind="text: $data, css: { active: $data == $parent.SelectedMood() }, click: function() { $parent.SelectedMood($data); jQuery.fancybox.close(true); }"></div></div></div>'});var NavbarViewModel=function(o){function e(e){var t=o.call(this)||this;return t.params=e,t.ImagePath=ko.observable(t.params&&t.params.imagePath||"/Content/Mashup/Images"),t.IsHidden=ko.observable(t.params&&t.params.isHidden),t.Profile=t.params&&t.params.profile||{},t.NoseDto=new NoseDto({LoginName:t.Profile.LoginName}),t.Languages=ko.observableArray(t.params&&t.params.languages||[]),t.Navigation=ko.observableArray(),t.NavigationAccount=ko.observableArray(),t.PokeMoods=ko.observableArray([]),ko.utils.arrayForEach(t.params&&t.params.navigation||{},function(e){e.IsAccount?t.NavigationAccount.push(new NavBarDto(t.GetLoginUrl(e.Url),e.Text,e.IsActive)):t.Navigation.push(new NavBarDto(e.Url,e.Text,e.IsActive))}),t.User=new UserDto(e&&e.user||{}),t.PokeMoods=ko.observableArray(["😊","😁","😂","😆","😉","😋","😍","😜","😠","😔","😥","😫","😓","😖","😷","😢","😭","😱","❤","💔","👼","👿","👽","🙈","🙉","🙊","💤","🌹","🌼","☕️","🍷","🍸","🍺","🍴","⭐","🎁"]),t}return __extends(e,o),e.prototype.OpenUrl=function(e){location.href=e},e.prototype.SendPoke=function(e,t){t.IsActivated?jQuery.ajax({type:"POST",url:"/WebApi/SendMail",cache:!1,data:{toLoginName:this.NoseDto.LoginName,body:e},dataType:"json",success:function(e){e&&0==e.ErrorCode?dialog.Show(GetLangRes("Common_lblSuccess","Success"),GetLangRes("Common_lblMessageSendSuccess","Message sent successfully!"),null):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)},error:function(){dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)}}):dialog.Show(GetLangRes("Common_activationRequired","Validation required"),GetLangRes("Common_lblActivationRequired","To use this functionality, it is required to validate your account, please validate your account in the GpsNose-App!"),null)},e}(BaseViewModel);ko.components.register("ma-gpsnose-navbar",{viewModel:{createViewModel:function(e,t){return new NavbarViewModel(e)}},template:'\n<div id="navbar-sticky">\n    <nav class="navbar navbar-expand-lg navbar navbar-light bg-light" data-bind="visible: ! IsHidden()">\n        <div class="container">\n            <a class="d-inline d-lg-none navbar-brand" href="/" data-bind="text: GetLangRes(\'Common_menuHome\', \'Home\')"></a>\n            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#gn-navbar-collapse-1" aria-controls="gn-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">\n                <span class="navbar-toggler-icon"></span>\n            </button>\n            <div class="collapse navbar-collapse" id="gn-navbar-collapse-1">\n                <ul class="navbar-nav mb-2 mb-lg-0" data-bind="foreach: Navigation">\n                    <li class="nav-item">\n                        <a class="nav-link" aria-current="page" href="javascript:void(0);" data-bind="text: Text, click: function() { $parent.OpenUrl(Url) }", css: { active: IsActive }">Home</a>\n                    </li>\n                </ul>\n                <span data-bind="foreach: NavigationAccount" class="ms-md-4 me-auto">\n                    <a class="btn btn-outline-secondary navbar-btn" data-bind="attr: { href: Url }, text: Text"></a>\n                </span>\n                <ul class="languages navbar-nav" data-bind="foreach: Languages">\n                    <li class="nav-item">\n                        <a class="nav-link" aria-current="language" data-bind="attr: { href: \'javascript:\' + (GetCurrentLang() == $data ? \'\' : \'SwitchLanguage(\'+$data+\')\') + \';\' }, text: $data, css: { active: GetCurrentLang() == $data }"></a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n    <div class="bg-light" data-bind="if: Profile.LoginName">\n        <div class="container">\n            <div class="navbar-userinfo py-2" data-bind="if: Profile.LoginName">\n                <div class="row">\n                    <div class="col-sm-4 col-5">\n                        <div class="d-flex">\n                            <div class="me-2">\n                                <a data-bind="attr: { href: NoseDto.ImageUrl() }" data-fancybox>\n                                    <img class="media-object rounded-circle" data-bind="attr: { src: NoseDto.ImageUrl() + \'@200\', onerror: \'RemoveFancyboxForImage(this);ImageErrorHandler(this, ImagePath() + \\\'/EmptyUser.png\\\');\' }" />\n                                </a>\n                            </div>\n                            <div class="text-nowrap">\n                                <h5 class="m-0" data-bind="text: Profile.LoginName"></h5>\n                                <div data-bind="text: Profile.FullName"></div>\n                                <div data-bind="text: GetDistanceString(Profile)"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="col-sm-4 col-2">\n                        <div class="text-center">\n                            <div class="btn-group-vertical btn-group-sm" role="group" aria-label="share">\n                                <div class="btn btn-outline-secondary py-0" data-src="#share" data-fancybox data-bind="attr: { title: GetLangRes(\'Common_btnShare\', \'Share\') }">\n                                    <i class="fas fa-qrcode"></i><span class="d-none d-sm-inline" data-bind="text: \' \' + GetLangRes(\'Common_btnShare\', \'Share\')"></span>\n                                </div>\n                                <div class="btn btn-outline-secondary py-0 visually-hidden" data-fancybox data-src="#poke-moods-dialog" data-bind="attr: { title: GetLangRes(\'Common_btnPoke\', \'Knock\'), \'data-remove\': ! User.LoginName || Profile.LoginName == User.LoginName }, css: { \'visually-hidden\': ! User.LoginName || Profile.LoginName == User.LoginName }">\n                                    <i class="far fa-hand-point-left"></i><span class="d-none d-sm-inline" data-bind="text: \' \' + GetLangRes(\'Common_btnPoke\', \'Knock\')"></span>\n                                </div>\n                                <a class="btn btn-outline-secondary py-0 visually-hidden" data-bind="attr: { href: GetLoginUrl(null), title: GetLangRes(\'Common_loginToPoke\', \'Login to Knock\'), \'data-remove\': User.LoginName }, css: { \'visually-hidden\': User.LoginName }">\n                                    <i class="far fa-hand-point-left"></i><span class="d-none d-sm-inline" data-bind="text: \' \' + GetLangRes(\'Common_loginToPoke\', \'Login to Knock\')"></span>\n                                </a>\n                                <a class="btn btn-outline-secondary py-0 visually-hidden" data-external data-bind="attr: { href: GetGoogleMapsLink(Profile.LastActivityLatitude, Profile.LastActivityLongitude), title: GetLangRes(\'Common_showOnMap\', \'Show on map\'), \'data-remove\': !IsGeoValid(Profile.LastActivityLatitude, Profile.LastActivityLongitude) }, css: { \'visually-hidden\': !IsGeoValid(Profile.LastActivityLatitude, Profile.LastActivityLongitude) }">\n                                    <i class="fas fa-map-marker-alt"></i><span class="d-none d-sm-inline" data-bind="text: \' \' + GetLangRes(\'Common_showOnMap\', \'Show on map\')"></span>\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="col-sm-4 col-5">\n                        <div class="text-end">\n                            <div class="text-nowrap">\n                                <h5 data-bind="text: GetLangRes(\'Nose_Profile_lblLastSeen\', \'Last seen\') + \':\'"></h5>\n                                <div data-bind="text: GetDateStringFromTicks(Profile.LastActivityUtcDateTime)"></div>\n                                <div data-bind="ifnot: Profile.LastActivityUtcDateTime">\n                                    <a data-bind="attr: { href: GetLoginUrl(null) }, text: GetLangRes(\'Common_loginRequired\', \'Please login first.\')" data-popup></a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="poke-moods-dialog">\n    <div id="poke-moods-dialog" data-bind="foreach: PokeMoods" style="display:none;" class="moods-dialog">\n        <div class="btn btn-outline-secondary p-1" data-bind="text: $data, click: function() { jQuery.fancybox.getInstance(\'close\'); $parent.SendPoke($data, gn_data.User || {}); }"></div>\n    </div>\n</div>'});var GroupTypeEnum,CoordinateTypeEnum,CommentItemType,CommunityAcl,NewsType,RatingViewModel=function(n){function e(e){var t=n.call(this,e&&e.imagePath||null)||this,o=0;e&&!isNaN(e.percent)&&(o=parseInt(e.percent)),t.Percent=ko.observable(o);o=0;return e&&!isNaN(e.count)&&(o=parseInt(e.count)),t.Count=ko.observable(o),t}return __extends(e,n),e.prototype.Title=function(){return this.Percent()+"%"+(0<this.Count()?" ("+this.Count()+")":"")},e.prototype.ImageByPercent=function(e){return this.ImagePath()+(this.Percent()>e?"/StarOn":"/StarOff")+".png"},e}(BaseComponentsViewModel);ko.components.register("ma-gpsnose-rating",{viewModel:{createViewModel:function(e,t){return new RatingViewModel(e)}},template:'<div data-bind="if: Count() != 0"><div class="rating" data-bind="attr: { title: Title() }"><img class="star" data-bind="attr: { src: ImageByPercent(-1) }" /><img class="star" data-bind="attr: { src: ImageByPercent(20) }" /><img class="star" data-bind="attr: { src: ImageByPercent(45) }" /><img class="star" data-bind="attr: { src: ImageByPercent(70) }" /><img class="star" data-bind="attr: { src: ImageByPercent(90) }" /></div></div>'}),function(e){e[e.None=0]="None",e[e.ByDay=1]="ByDay",e[e.ByWeek=2]="ByWeek",e[e.ByMonth=3]="ByMonth",e[e.ByYear=4]="ByYear",e[e.Custom=5]="Custom"}(GroupTypeEnum=GroupTypeEnum||{}),function(e){e[e.Touch=0]="Touch",e[e.Poi=1]="Poi",e[e.Blog=2]="Blog"}(CoordinateTypeEnum=CoordinateTypeEnum||{}),function(e){e[e.PhotoBlog=1]="PhotoBlog",e[e.FavoriteLocation=2]="FavoriteLocation",e[e.Tour=3]="Tour",e[e.Event=4]="Event",e[e.Community=5]="Community"}(CommentItemType=CommentItemType||{}),function(e){e[e.NoOptions=0]="NoOptions",e[e.ListMembers=1]="ListMembers",e[e.MembersInviteMembers=2]="MembersInviteMembers",e[e.CommentsFromMembers=4]="CommentsFromMembers"}(CommunityAcl=CommunityAcl||{}),function(e){e[e.Unknown=0]="Unknown",e[e.NewGuestUser=1]="NewGuestUser",e[e.ProfileActivated=2]="ProfileActivated",e[e.ProfileAbout=3]="ProfileAbout",e[e.ProfileImage=4]="ProfileImage",e[e.Comment=5]="Comment",e[e.Rating=6]="Rating",e[e.PhotoBlog=7]="PhotoBlog",e[e.PoI=8]="PoI",e[e.Tour=9]="Tour",e[e.Event=10]="Event",e[e.Mashup=11]="Mashup"}(NewsType=NewsType||{});var EulaViewModel=function(t){function e(){var e=t.call(this)||this;return e.EulaPath="/eula/",e.IndexCurrId=0,e.UlActive=!1,e.OlActive=!1,e.EulaCurrentVersion=ko.observable(1),e.EulaLanguage=ko.observable("en"),e.Content=ko.observable(""),e.Index=ko.observableArray([]),e}return __extends(e,t),e.prototype.GetHtml=function(e){var t="";"-"!=e.substring(0,1)&&this.UlActive&&this.UlActive&&(t+="</ul>",this.UlActive=!1);var o=/^[0-9]*\.\s(.*)$/.exec(e);!o&&this.OlActive&&this.OlActive&&(t+="</ol>",this.OlActive=!1);var n=/^([#]*)\s/.exec(e);return n?(n=null===(n=n[1])||void 0===n?void 0:n.length,t+=this.GetHeader(n,e.substring(n).trim(),n<=2)):"[index]"==e?t+='<div id="index_dest"></div>':"-"==e.substring(0,1)?(this.UlActive||(t+="<ul>",this.UlActive=!0),t+="<li>"+jQuery("<div />").text(e.substring(1).trim()).html()+"</li>"):o?(this.OlActive||(t+="<ol>",this.OlActive=!0),t+="<li>"+jQuery("<div />").text(o[1]).html()+"</li>"):t+="<p>"+jQuery("<div />").text(e).html()+"</p>",this.linkify(t)},e.prototype.linkify=function(e){return(e=e.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|]|www\.gpsnose\.com)/gi,function(e){return"www.gpsnose.com"==e?"<strong>"+e+"</strong>":'<a href="'+e+'">'+e+"</a>"})).replace(/(\b[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*)/gi,function(e){return'<a href="'+e+'">'+e+"</a>"})},e.prototype.GetHeader=function(e,t,o){t=jQuery("<div />").text(t).html();return this.IndexCurrId++,o&&this.Index.push('<a href="#anc_'+this.IndexCurrId+'" class="index index-'+e+'">'+t+"</a>"),"<h"+(e+1)+' id="anc_'+this.IndexCurrId+'">'+t+"</h"+(e+1)+">"},e.prototype.LoadFile=function(o){var e=this,n=this;this.UpdateCurrentVersion(function(){e.CheckLanguage(function(){jQuery.ajax({type:"GET",url:e.EulaPath+e.EulaCurrentVersion()+"_"+e.EulaLanguage()+".txt",dataType:"text",success:function(e){var e=e.split("\n"),t="";e.forEach(function(e){0<e.trim().length&&(t+=n.GetHtml(e.trim()))}),n.Content(t),o()},error:function(){dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)}})})})},e.prototype.CheckLanguage=function(n){var i=GetCurrentLang(),a=this;jQuery.ajax({type:"HEAD",url:this.EulaPath+this.EulaCurrentVersion()+"_"+i+".txt",success:function(e,t,o){a.EulaLanguage(i),n()},error:function(e,t,o){n()}})},e.prototype.UpdateCurrentVersion=function(n){var i=this.EulaCurrentVersion()+1,a=this;jQuery.ajax({type:"HEAD",url:this.EulaPath+i+"_en.txt",success:function(e,t,o){a.EulaCurrentVersion(i),a.UpdateCurrentVersion(n)},error:function(e,t,o){n()}})},e}(BaseViewModel),EventDetailViewModel=function(o){function e(e){var t=o.call(this)||this;return t.Dates=ko.observableArray(),t.UniqueKey=e.UniqueKey||"",t.LoginName=GetLoginNameFromUniqueKey(t.UniqueKey),t.CreationTicks=GetTicksFromUniqueKey(t.UniqueKey),t.Entity=new EventDto({UniqueKey:t.UniqueKey}),t.NoseDto=new NoseDto({LoginName:t.LoginName}),t.IsOnlineEvent=16==(16&e.EventOptions),t}return __extends(e,o),e.prototype.OnAddDates=function(e){},e.prototype.AddDates=function(e){if(null!=e){for(var t in e)this.Dates.push(new EventDateDto(t,e[t]));this.OnAddDates&&this.OnAddDates(this.Dates())}},e}(BaseViewModel),GipViewModel=function(e){function t(){var o=e.call(this)||this;return o.CacheGip=new Array,o.Rectangle=ko.observable(null),o.Gip=ko.observable(null),o.IsGipAutoUpdate=ko.observable(!1),o.SearchQuery=ko.observable(null),o.Latitude=ko.observable(0).extend({numeric:5}),o.Longitude=ko.observable(0).extend({numeric:5}),o.Zoom=ko.observable(12),o.ZoomPreview=ko.observable(12),o.PreventZoomInOnRefresh=ko.observable(!1),o.RequestActive=ko.observable(!1),o.ShareUrl=ko.computed(function(){return"https://www.gpsnose.com/gip/"+o.Gip()}),o.Warning=ko.observable(null),o.HasWarning=ko.computed(function(){return null!=o.Warning()}),o.Gip.subscribe(function(e){var t=e.replace(/[^0-9A-HYJKWMNXPR-VZ.]+/gi,"");t!=e?o.Gip(t):(o.IsGipAutoUpdate()||0==o.Latitude()&&0==o.Longitude())&&o.GetMapRectFromGip()}),o.Zoom.subscribe(function(e){e<2?o.Zoom(2):28<e?o.Zoom(28):o.PreventZoomInOnRefresh(!1),o.ZoomPreview(e),o.GetGipFromLatLng()}),o.Rectangle.subscribe(function(e){o.Latitude(e.Center.Latitude),o.Longitude(e.Center.Longitude),o.Zoom(e.Zoom),o.OnRefresh&&o.OnRefresh(o.PreventZoomInOnRefresh())}),o.IsGipAutoUpdate.subscribe(function(e){e&&o.GetMapRectFromGip()}),o}return __extends(t,e),t.prototype.OnSearch=function(e){},t.prototype.OnRefresh=function(e){},t.prototype.GetGpxBox=function(){var e=this.Rectangle();return null!=e&&e.Vertex0?[{type:"Feature",properties:{type:"track"},geometry:{type:"LineString",coordinates:[[e.Vertex0.Longitude,e.Vertex0.Latitude],[e.Vertex1.Longitude,e.Vertex1.Latitude],[e.Vertex2.Longitude,e.Vertex2.Latitude],[e.Vertex3.Longitude,e.Vertex3.Latitude],[e.Vertex0.Longitude,e.Vertex0.Latitude]]}}]:null},t.prototype.GetMapRectFromGip=function(){var e,t=this,o=this.Gip()?this.Gip().replace(/\.$/,""):null;!o||o.length<1?this.UseUserLocation():(e=this.CacheGip.filter(function(e){return e[0]==o}))[0]?this.Rectangle(e[0][1]):this.RequestActive()||(this.RequestActive(!0),jQuery.ajax({type:"POST",url:"/Gip/GetRectFromGip",cache:!1,data:{gip:o},dataType:"json",success:function(e){e&&e.Center&&(t.CacheGip.push([o,e]),t.Rectangle(e)),t.RequestActive(!1)},error:function(e){t.RequestActive(!1),t.UseUserLocation()}}))},t.prototype.GetGipFromLatLng=function(){var t=this;this.RequestActive()||(this.RequestActive(!0),jQuery.ajax({type:"POST",url:"/Gip/GetGipFromLatLng",cache:!1,data:{lat:this.Latitude(),lon:this.Longitude(),zoom:this.Zoom()},dataType:"json",success:function(e){e&&e.Rect&&(t.Rectangle(e.Rect),t.Gip(e.Gip)),t.RequestActive(!1)},error:function(e){t.RequestActive(!1),t.UseUserLocation()}}))},t.prototype.UseUserLocation=function(){this.UserLocationCallback&&this.UserLocationCallback()},t.prototype.Search=function(){this.OnSearch&&this.OnSearch(this.SearchQuery())},t}(BaseViewModel),ImportedKeywordsViewModel=function(e){function t(){var i=e.call(this)||this;return i.ImportedKeywordsUrl="/Home/GetAllImportedKeywords",i.BaseDataUrl="https://gpsnose.blob.core.windows.net",i.CurrentKeyword=ko.observable(null),i.KeywordScopes=ko.observableArray([]),i.ImportedKeywords=ko.observableArray([]),i.ImportedKeywordsRequestActive=ko.observable(!1),i.CurrentKeyword.subscribe(function(e){i.SelectKeyword(e.Keyword)}),i.ImportedKeywords.subscribe(function(e){var t=ko.utils.arrayMap(i.ImportedKeywords(),function(e){return e.Scope});i.KeywordScopes(ko.utils.arrayGetDistinctValues(t).sort());var o,n=i.findGetParameter("keyword");n&&0<n.length&&(o=ko.utils.arrayFilter(i.ImportedKeywords(),function(e){return e.Keyword==n}))[0]?i.CurrentKeyword(o[0]):i.CurrentKeyword(e[0])}),i}return __extends(t,e),t.prototype.OnSelectKeyword=function(e,t,o){},t.prototype.SelectKeyword=function(t){var n=this,i=ko.utils.arrayFirst(this.ImportedKeywords(),function(e){return e.Keyword==t});jQuery.ajax({url:this.BaseDataUrl+"/impkeysgsjon/"+encodeURI(t),dataType:"json",success:function(e){n.OnSelectKeyword&&n.OnSelectKeyword(n,i,e)},error:function(e,t,o){n.OnSelectKeyword&&n.OnSelectKeyword(n,i,[])}})},t.prototype.ImportedKeywordsWithScope=function(t){return ko.utils.arrayFilter(this.ImportedKeywords(),function(e){return e.Scope==t})},t.prototype.LoadImportedKeywords=function(){var t=this;this.ImportedKeywordsRequestActive()||(this.ImportedKeywordsRequestActive(!0),jQuery.ajax({type:"POST",url:this.ImportedKeywordsUrl,cache:!1,dataType:"json",success:function(e){e?t.ImportedKeywords(e):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null),t.ImportedKeywordsRequestActive(!1)},error:function(){t.ImportedKeywordsRequestActive(!1),dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblUnknownError","An unknown error is occured!"),null)}}))},t.prototype.findGetParameter=function(t){var o,n=null;return location.search.substr(1).split("&").forEach(function(e){(o=e.split("="))[0]===t&&(n=decodeURIComponent(o[1]))}),n},t}(BaseViewModel),IndexViewModel=function(e){function t(){var t=e.call(this)||this;return t.CommunityTag=ko.observable(""),t.MashupPageUrl="/Home/Page_Mashups",t.CommunityDetailUrl="/Community/GetDetail",t.MashupsPageSize=gnSettings.MashupsPageSize,t.ShowMashups=ko.observable(!0),t.PublicMashups=ko.observableArray(),t.PublicMashupsLastKnownTagName="%",t.HasMorePublicMashups=ko.observable(!0),t.PublicMashupsRequestActive=ko.observable(!1),t.ClosedMashups=ko.observableArray(),t.ClosedMashupsLastKnownTagName="@",t.HasMoreClosedMashups=ko.observable(!0),t.ClosedMashupsRequestActive=ko.observable(!1),t.NosePageUrl="/Home/Page_Noses",t.Noses=ko.observableArray(),t.NosesPageSize=gnSettings.NosesPageSize,t.NosesLastKnownTicks=window.MAX_DATE_TIME_TICKS,t.HasMoreNoses=ko.observable(!0),t.NosesRequestActive=ko.observable(!1),t.ShowNoses=ko.observable(!0),t.NewsPageUrl="/Home/Page_News",t.News=ko.observableArray(),t.NewsPageSize=gnSettings.NewsPageSize,t.NewsLastKnownTicks=window.MAX_DATE_TIME_TICKS,t.HasMoreNews=ko.observable(!0),t.NewsRequestActive=ko.observable(!1),t.ShowNews=ko.observable(!0),t.NosesRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),t.NewsRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),t.CommunityEntity=new CommunityDto({},new NoseDto({})),t.CommunityTag.subscribe(function(e){t.CommunityEntity=new CommunityDto({TagName:e},new NoseDto({}))}),t}return __extends(t,e),t.prototype.OnAddPublicMashups=function(){},t.prototype.AddPublicMashups=function(e){if(null!=e){if(0<e.length){for(var t in this.PublicMashupsLastKnownTagName=e[e.length-1],e)this.PublicMashups.push(new CommunityDto({TagName:e[t]},new NoseDto({})));e.length%this.MashupsPageSize!=0&&this.HasMorePublicMashups(!1)}else this.HasMorePublicMashups(!1);this.OnAddPublicMashups&&this.OnAddPublicMashups()}},t.prototype.PagePublicMashups=function(){var t=this;this.ShowMashups()&&!this.PublicMashupsRequestActive()&&this.HasMorePublicMashups()&&(this.PublicMashupsRequestActive(!0),jQuery.ajax({type:"POST",url:this.MashupPageUrl,cache:!1,data:{lastKnownMashup:this.PublicMashupsLastKnownTagName,pageSize:this.MashupsPageSize},dataType:"json",success:function(e){e&&0<e.length?t.AddPublicMashups(e):t.HasMorePublicMashups(!1),t.PublicMashupsRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.PublicMashupsRequestActive(!1)}}))},t.prototype.OnAddClosedMashups=function(){},t.prototype.AddClosedMashups=function(e){if(null!=e){if(0<e.length){for(var t in this.ClosedMashupsLastKnownTagName=e[e.length-1],e)this.ClosedMashups.push(new CommunityDto({TagName:e[t]},new NoseDto({})));e.length%this.MashupsPageSize!=0&&this.HasMoreClosedMashups(!1)}else this.HasMoreClosedMashups(!1);this.OnAddClosedMashups&&this.OnAddClosedMashups()}},t.prototype.PageClosedMashups=function(){var t=this;this.ShowMashups()&&!this.ClosedMashupsRequestActive()&&this.HasMoreClosedMashups()&&(this.ClosedMashupsRequestActive(!0),jQuery.ajax({type:"POST",url:this.MashupPageUrl,cache:!1,data:{lastKnownMashup:this.ClosedMashupsLastKnownTagName,pageSize:this.MashupsPageSize},dataType:"json",success:function(e){e&&0<e.length?t.AddClosedMashups(e):t.HasMoreClosedMashups(!1),t.ClosedMashupsRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.ClosedMashupsRequestActive(!1)}}))},t.prototype.OnAddNoses=function(){},t.prototype.AddNoses=function(e){if(null!=e){if(0<e.length){for(var t in this.NosesLastKnownTicks=e[e.length-1].CreationTicks,e)this.Noses.push(new NoseDto(e[t]));e.length%this.NosesPageSize!=0&&this.HasMoreNoses(!1)}else this.HasMoreNoses(!1);this.OnAddNoses&&this.OnAddNoses()}},t.prototype.PageNoses=function(){var t=this;this.ShowNoses()&&!this.NosesRequestActive()&&this.HasMoreNoses()&&(this.NosesRequestActive(!0),jQuery.ajax({type:"POST",url:this.NosePageUrl,cache:!1,data:{lastKnownTicks:this.NosesLastKnownTicks,pageSize:this.NosesPageSize,community:this.CommunityTag()},dataType:"json",success:function(e){e&&0<e.length?t.AddNoses(e):t.HasMoreNoses(!1),t.NosesRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.NosesRequestActive(!1)}}))},t.prototype.OnAddNews=function(){},t.prototype.AddNews=function(e){if(null!=e){if(0<e.length){for(var t in this.NewsLastKnownTicks=e[e.length-1].CreationTicks,e)this.News.push(new NewsDto(e[t]));e.length%this.NewsPageSize!=0&&this.HasMoreNews(!1)}else this.HasMoreNews(!1);this.OnAddNews&&this.OnAddNews()}},t.prototype.PageNews=function(){var t=this;this.ShowNews()&&!this.NewsRequestActive()&&this.HasMoreNews()&&(this.NewsRequestActive(!0),jQuery.ajax({type:"POST",url:this.NewsPageUrl,cache:!1,data:{lastKnownTicks:this.NewsLastKnownTicks,pageSize:this.NewsPageSize,community:this.CommunityTag()},dataType:"json",success:function(e){e&&0<e.length?t.AddNews(e):t.HasMoreNews(!1),t.NewsRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.NewsRequestActive(!1)}}))},t}(BaseViewModel),BaseNavigableItem=function(e){e&&jQuery.extend(this,e),!this.LoginName&&e.Creator&&(this.LoginName=e.Creator),this.UniqueKey?(this.LoginName=GetLoginNameFromUniqueKey(this.UniqueKey),this.CreationTicks=GetTicksFromUniqueKey(this.UniqueKey)):this.CreationTicks&&(this.UniqueKey=GetUniqueKey(this.LoginName,this.CreationTicks))},CarouselItemDto=function(e,t){this.Title=ko.observable(""),this.Text=ko.observable(""),this.Title(e),this.Text(t)},CommentDto=function(e){var t=this;this.HasText=function(){return t.Text&&0<t.Text.length},e&&jQuery.extend(this,e),e.CreatedByUserName&&!this.Creator&&(this.Creator=e.CreatedByUserName),this.NoseDto=new NoseDto({LoginName:this.Creator})},CommunityDto=function(){function e(e,t){var o=this;this.TagName=ko.observable(""),this.Description=ko.observable(""),this.CreatorLoginName=ko.observable(""),this.CreationTicks=ko.observable("0"),this.MembersCount=ko.observable(0),this.Acls=ko.observable(0),this.Admins=ko.observableArray([]),this.IsInCommunity=ko.observable(!1),this.HasRequested=ko.observable(!1),this.IsRequestActive=ko.observable(!1),this.LoginName=ko.observable(""),this.NoseDto=ko.observable(),this.ThumbSize="@200",this.ImageUrl=function(){return gnSettings.BaseDataUrl+"/commimg/"+encodeURIComponent(o.TagName())},this.ThumbUrl=function(){return o.ImageUrl()+o.ThumbSize},this.PreviewUrl=function(){return"/community/preview?profileTag="+encodeURIComponent(o.TagName())},this.DetailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/community/index?profileTag="+encodeURIComponent(o.TagName())+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"&lid="+gnSettings.LoginId:"")},this.ShareUrl=function(){return gnSettings.BaseUrl+"/community/index?profileTag="+encodeURIComponent(o.TagName())},this.IsLoginNameAdmin=function(){return o.LoginName()==o.CreatorLoginName()||-1!=jQuery.inArray(o.LoginName(),o.Admins())},this.WebMashupUrl=function(){if(-1!=o.TagName().indexOf(".")){var e=o.TagName().substring(1).split("@");if(0<e.length)return"http://"+e[0]}return null},this.IsAclListMembers=function(){return(o.Acls()&CommunityAcl.ListMembers)==CommunityAcl.ListMembers},this.IsMembersListAllowed=function(){return o.IsAclListMembers()||o.IsLoginNameAdmin()},this.IsAclMembersInviteMembers=function(){return(o.Acls()&CommunityAcl.MembersInviteMembers)==CommunityAcl.MembersInviteMembers},this.IsInviteMembersAllowed=function(){return o.IsAclMembersInviteMembers()&&(o.IsInCommunity()||o.NoseDto().IsInCommunity(o.TagName()))||o.IsLoginNameAdmin()},this.IsAclCommentsFromMembers=function(){return(o.Acls()&CommunityAcl.CommentsFromMembers)==CommunityAcl.CommentsFromMembers},this.CommentItemType=CommentItemType.Community,this.IsCommentsAllowed=function(){return o.IsAclCommentsFromMembers()&&(o.IsInCommunity()||o.NoseDto().IsInCommunity(o.TagName())||!o.LoginName())||o.IsLoginNameAdmin()},this.IsUserAdmin=function(e){return o.CreatorLoginName()==e||-1!=jQuery.inArray(e,o.Admins())},this.Update(e),this.LoginName(t.LoginName),this.NoseDto(new NoseDto(t))}return e.prototype.Update=function(e){e.TagName&&this.TagName(e.TagName),e.Description&&this.Description(e.Description),e.CreatorLoginName&&this.CreatorLoginName(e.CreatorLoginName),e.CreationTicks&&this.CreationTicks(e.CreationTicks),e.MembersCount&&this.MembersCount(e.MembersCount),e.Acls&&this.Acls(e.Acls),e.Admins&&this.Admins(e.Admins),e.IsInCommunity&&this.IsInCommunity(e.IsInCommunity),e.LoginName&&this.LoginName(e.LoginName),e.HasRequested&&this.HasRequested(e.HasRequested)},e.prototype.DisplayName=function(){return new KeywordDto(this.TagName()).GetHtml()},e}(),CommunityMemberDto=function(e){e&&jQuery.extend(this,e),this.NoseDto=new NoseDto({LoginName:this.LoginName})},Coordinate=function(e){this.PercentageX=0,this.PercentageY=0,this.Distance=0,this.AgeString="0m",e&&jQuery.extend(this,e),this.Location=L.latLng(this.lat,this.lon,this.alt)},EventDateDto=function(e,t){this.Ticks=e,this.Count=t},EventDto=function(o){function e(e){var t=o.call(this,e)||this;return t.ThumbSize="@200",t.ImageUrl=function(){return gnSettings.BaseDataUrl+"/eventsimg/"+encodeURIComponent(t.UniqueKey)},t.ThumbUrl=function(){return t.ImageUrl()+t.ThumbSize},t.PreviewUrl=function(){return"/event/preview/"+encodeURIComponent(t.UniqueKey)},t.DetailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/event/detail/"+encodeURIComponent(t.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.ShareUrl=function(){return gnSettings.BaseUrl+"/event/detail/"+encodeURIComponent(t.UniqueKey)},t}return __extends(e,o),e}(BaseNavigableItem),GeoDataGeometry=function(){},GeoDataItem=function(){},GeoDataProperties=function(){},GnGip=function(){},GnMapPoint=function(e,t){this.Latitude=e,this.Longitude=t},GnMapRectangle=function(){},ImportedKeywordDto=function(){this.Keyword="",this.LastUpdatedTicks="",this.DataSourceInfo="",this.Scope="",this.Count=0},KeywordDto=function(){function e(e){this.Name=ko.observable(""),this.IsSelected=ko.observable(!1),this.Name(e),this.Community=new CommunityDto({TagName:e},new NoseDto({}))}return e.prototype.IsCommunity=function(){return""!=this.GetIcon()},e.prototype.GetHtml=function(){var e=this.Name(),t=this.GetIcon();return""!=t&&e&&2<e.length?'<i class="'+t+'"></i> <span class="keyword-label">'+e.substr(1,e.length)+"</span>":e},e.prototype.GetIcon=function(){var e=this.Name();if(!e||e.length<1)return"";var t="";switch(e.charAt(0)){case"@":t="glyphicon glyphicon-lock fas fa-lock";break;case"*":t="glyphicon glyphicon-eye-close fas fa-eye-slash";break;case"%":t="glyphicon glyphicon-globe fas fa-globe-americas"}return t},e.prototype.Toggle=function(){this.IsSelected(!this.IsSelected())},e}(),NavBarDto=function(e,t,o){this.Url=e,this.Text=t,this.IsActive=o},NewsDto=function(e){var t=this;switch(this.PoiPublished_Name=34,this.TemplateName=function(){switch(t.NewsType){case NewsType.ProfileAbout:return"AboutNewsTemplate";case NewsType.ProfileImage:return"ProfileImageNewsTemplate";case NewsType.NewGuestUser:return"NewGuestUserNewsTemplate";case NewsType.ProfileActivated:return"ProfileActivatedTemplate";case NewsType.PhotoBlog:return"PhotoBlogNewsTemplate";case NewsType.PoI:return"PoIPublishedNewsTemplate";case NewsType.Tour:return"TourNewsTemplate";case NewsType.Comment:return"CommentNewsTemplate";case NewsType.Rating:return"RatingNewsTemplate";case NewsType.Event:return"EventNewsTemplate";case NewsType.Mashup:return"MashupNewsTemplate";default:return"UnknownTemplate"}},this.ThumbUrl=function(){return t.ImageUrl()+t.Entity.ThumbSize},this.DetailInlineUrl=function(){return t.PreviewUrl()},this.PhotoBlogText=function(){return t.IsNowDeleted?GetLangRes("NewsPart_Load_lblBlogWasDeleted","Impression was deleted"):t.Title},this.CommentText=function(){return t.IsNowDeleted?GetLangRes("NewsPart_Load_lblCommentWasDeleted","Comment was deleted"):null!=t.Description&&""!=t.Description?t.Description:(null!=t.Comment_Text?t.Comment_Text:"")+(null!=t.Comment_Mood?" "+t.Comment_Mood:"")},this.ThumbSize="@600",this.ImageUrl=function(){return t.Entity.ImageUrl()},this.PreviewUrl=function(){return t.Entity.PreviewUrl()},this.DetailUrl=function(){return t.Entity.DetailUrl()},this.ShareUrl=function(){return t.Entity.ShareUrl()},e&&jQuery.extend(this,e),this.UniqueKey=GetUniqueKey(this.Creator,this.CreationTicks),this.NoseDto=new NoseDto({LoginName:this.Creator}),this.Entity=new NoseDto({LoginName:this.Creator}),this.NewsType){case NewsType.PhotoBlog:this.UniqueKey=GetUniqueKey(this.Creator,this.Impression_CreationTicks),this.Entity=new PhotoBlogDto(this);break;case NewsType.PoI:this.UniqueKey=GetUniqueKey(this.Creator,this.PoiPublished_CreationTicks),this.Entity=new PoiDto(this);break;case NewsType.Tour:this.UniqueKey=GetUniqueKey(this.Creator,this.Track_CreationTicks),this.Entity=new TourDto(this);break;case NewsType.Event:this.UniqueKey=GetUniqueKey(this.Creator,this.Event_CreationTicks),this.Entity=new EventDto(this);break;case NewsType.Comment:switch(this.UniqueKey=this.Comment_CommentItemId,this.Comment_CommentItemType){case"PhotoBlog":this.Entity=new PhotoBlogDto({UniqueKey:this.UniqueKey});break;case"FavoriteLocation":this.Entity=new PoiDto({UniqueKey:this.UniqueKey});break;case"Track":case"Tour":this.Entity=new TourDto({UniqueKey:this.UniqueKey,Latitude:this.Comment_CommentItemLatitude,Longitude:this.Comment_CommentItemLongitude});break;case"Community":this.Entity=new CommunityDto({TagName:this.Comment_CommentItemId},new NoseDto({}))}break;case NewsType.Rating:switch(this.UniqueKey=this.Rating_RatedItemId,this.Rating_RatedItemType){case"FavoriteLocation":this.Entity=new PoiDto({UniqueKey:this.UniqueKey});break;case"PhotoBlog":this.Entity=new PhotoBlogDto({UniqueKey:this.UniqueKey});break;case"Track":case"Tour":this.Entity=new TourDto({UniqueKey:this.UniqueKey,Latitude:this.Rating_RatedItemLatitude,Longitude:this.Rating_RatedItemLongitude})}break;case NewsType.Mashup:this.UniqueKey=this.Mashup_CommunityTag,this.Entity=new CommunityDto({TagName:this.Mashup_CommunityTag},new NoseDto({}))}},NoseDto=function(o){function e(e){var t=o.call(this,e)||this;return t.IsInCommunity=function(e){return t.Communities&&-1!=jQuery.inArray(e,t.Communities)},t.ThumbSize="@200",t.ImageUrl=function(){return gnSettings.BaseDataUrl+"/profimg/"+encodeURIComponent(t.LoginName)},t.ThumbUrl=function(){return t.ImageUrl()+t.ThumbSize},t.PreviewUrl=function(){return"/nose/preview/"+encodeURIComponent(t.LoginName)},t.DetailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/"+encodeURIComponent(t.LoginName)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.ShareUrl=function(){return gnSettings.BaseUrl+"/"+encodeURIComponent(t.LoginName)},t}return __extends(e,o),e}(BaseNavigableItem),PageableItem=function(){function e(e,t,o,n){this.Items=ko.observableArray(),this.ItemLastKnownTicks=window.MAX_DATE_TIME_TICKS,this.HasMoreItems=ko.observable(!0),this.ItemsRequestActive=ko.observable(!1),this.TagName=e,this.ItemPageUrl=t,this.ItemPageSize=o,this.NewItem=n}return e.prototype.NewItem=function(e){return null},e.prototype.OnAddItems=function(){},e.prototype.AddItems=function(e){if(null!=e){if(0<e.length){for(var t in this.ItemLastKnownTicks=e[e.length-1].CreationTicks,e)this.Items.push(this.NewItem(e[t]));e.length%this.ItemPageSize!=0&&this.HasMoreItems(!1)}else this.HasMoreItems(!1);this.OnAddItems&&this.OnAddItems()}},e.prototype.PageItems=function(){var t=this;!this.ItemsRequestActive()&&this.HasMoreItems()&&(this.ItemsRequestActive(!0),jQuery.ajax({type:"POST",url:this.ItemPageUrl,cache:!1,data:{lastKnownTicks:this.ItemLastKnownTicks,pageSize:this.ItemPageSize,community:this.TagName},dataType:"json",success:function(e){e&&0<e.length?t.AddItems(e):t.HasMoreItems(!1),t.ItemsRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.ItemsRequestActive(!1)}}))},e}(),PhotoBlogDto=function(o){function e(e){var t=o.call(this,e)||this;return t.GroupName=ko.observable(""),t.GroupCount=ko.observable(1),t.GroupType=ko.observable(GroupTypeEnum.None),t.IsGrouped=ko.observable(!1),t.IsLastIncompleteGroup=ko.observable(!1),t.DateString=ko.computed(function(){var e=GetDateFromTicks(t.CreationTicks);return t.GroupType()==GroupTypeEnum.ByDay?moment(e).format("LL"):t.GroupType()==GroupTypeEnum.ByWeek?GetLangRes("Common_lblCalendarWeekFormat","CW %cw%").replace("%cw%",moment(e).format("w"))+" "+moment(e).format("YYYY"):t.GroupType()==GroupTypeEnum.ByMonth?moment(e).format("MMMM YYYY"):moment(e).format("LLL")}),t.ThumbSize="@600",t.ImageUrl=function(){return gnSettings.BaseDataUrl+"/pbimg/"+encodeURIComponent(t.UniqueKey)},t.ThumbUrl=function(){return t.ImageUrl()+t.ThumbSize},t.PreviewUrl=function(){return"/impression/preview/"+encodeURIComponent(t.UniqueKey)},t.DetailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/impression/detail/"+encodeURIComponent(t.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.ShareUrl=function(){return gnSettings.BaseUrl+"/impression/detail/"+encodeURIComponent(t.UniqueKey)},t.CommentItemType=CommentItemType.PhotoBlog,t.IsCommentsAllowed=function(){return!0},t.IsUserAdmin=function(e){return t.LoginName==e},t}return __extends(e,o),e}(BaseNavigableItem),PoiDto=function(o){function e(e){var t=o.call(this,e)||this;return t.ThumbSize="@200",t.ImageUrl=function(){return gnSettings.BaseDataUrl+"/locimg/"+encodeURIComponent(t.UniqueKey)},t.ThumbUrl=function(){return t.ImageUrl()+t.ThumbSize},t.PreviewUrl=function(){return"/poi/preview/"+encodeURIComponent(t.UniqueKey)},t.DetailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/poi/detail/"+encodeURIComponent(t.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.ShareUrl=function(){return gnSettings.BaseUrl+"/poi/detail/"+encodeURIComponent(t.UniqueKey)},t.CommentItemType=CommentItemType.FavoriteLocation,t.IsCommentsAllowed=function(){return!0},t.IsUserAdmin=function(e){return t.LoginName==e},t}return __extends(e,o),e}(BaseNavigableItem),SecurityToken=function(){this.Token=ko.observable(null),this.CreatorUserName=ko.observable(null),this.CreatedTicks=ko.observable(null),this.ScannedTicks=ko.observable(null),this.IsValid=ko.observable(!1),this.IsPending=ko.observable(!1)},TourDto=function(o){function e(e){var t=o.call(this,e)||this;return t.ThumbSize="",t.ImageUrl=function(){return""},t.ThumbUrl=function(){return""},t.PreviewUrl=function(){return"/track/preview/"+encodeURIComponent(t.UniqueKey)},t.DetailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/track/detail/"+encodeURIComponent(t.UniqueKey)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.ShareUrl=function(){return gnSettings.BaseUrl+"/track/detail/"+encodeURIComponent(t.UniqueKey)},t.CommentItemType=CommentItemType.Tour,t.IsCommentsAllowed=function(){return!0},t.IsUserAdmin=function(e){return t.LoginName==e},!t.StartLatitude&&t.Latitude&&(t.StartLatitude=t.Latitude),!t.StartLongitude&&t.Longitude&&(t.StartLongitude=t.Longitude),!t.StartLatitude&&e.Track_StartLatitude&&(t.StartLatitude=e.Track_StartLatitude),!t.StartLongitude&&e.Track_StartLongitude&&(t.StartLongitude=e.Track_StartLongitude),t}return __extends(e,o),e}(BaseNavigableItem),UserDto=function(e){this.LoginName=e.LoginName,this.IsActivated=e.IsActivated},NearbyViewModel=function(n){function e(e,t){var o=n.call(this)||this;return o.Entity=new CommunityDto(e,t),o.TagName=o.Entity.TagName(),o.NoseDto=new NoseDto({LoginName:o.Entity.CreatorLoginName()}),o.PageableNoses=new PageableItem(o.Entity.TagName(),"/Nearby/Noses",gnSettings.NearbyNosesPageSize,function(e){e=new NoseDto(e);return e.IsAdmin=e.LoginName==o.Entity.CreatorLoginName()||o.Entity.Admins()&&-1!=jQuery.inArray(e.LoginName,o.Entity.Admins()),e}),o.PageablePois=new PageableItem(o.Entity.TagName(),"/Nearby/Pois",gnSettings.NearbyPoisPageSize,function(e){return new PoiDto(e)}),o.PageableImpressions=new PageableItem(o.Entity.TagName(),"/Nearby/Impressions",gnSettings.NearbyImpressionsPageSize,function(e){return new PhotoBlogDto(e)}),o.PageableTracks=new PageableItem(o.Entity.TagName(),"/Nearby/Tracks",gnSettings.NearbyToursPageSize,function(e){return new TourDto(e)}),o.PageableEvents=new PageableItem(o.Entity.TagName(),"/Nearby/Events",gnSettings.NearbyEventsPageSize,function(e){return new EventDto(e)}),o}return __extends(e,n),e.prototype.DisplayName=function(){return new KeywordDto(this.TagName).GetHtml()},e}(BaseViewModel),PhotoBlogDetailViewModel=function(o){function e(e){var t=o.call(this)||this;return t.Tour=null,t.UniqueKey=e||"",t.LoginName=GetLoginNameFromUniqueKey(t.UniqueKey),t.CreationTicks=GetTicksFromUniqueKey(t.UniqueKey),t.Entity=new PhotoBlogDto({UniqueKey:t.UniqueKey}),t.NoseDto=new NoseDto({LoginName:t.LoginName}),t}return __extends(e,o),e.prototype.SetTourById=function(e){this.Tour=new TourDto({UniqueKey:e})},e}(BaseViewModel),PoiDetailViewModel=function(o){function e(e){var t=o.call(this)||this;return t.Tour=null,t.UniqueKey=e||"",t.LoginName=GetLoginNameFromUniqueKey(t.UniqueKey),t.CreationTicks=GetTicksFromUniqueKey(t.UniqueKey),t.Entity=new PoiDto({UniqueKey:t.UniqueKey}),t.NoseDto=new NoseDto({LoginName:t.LoginName}),t}return __extends(e,o),e.prototype.SetTourById=function(e){this.Tour=new TourDto({UniqueKey:e})},e}(BaseViewModel),SecurityTokenValidatorViewModel=function(e){function t(){var t=e.call(this)||this;return t.ValidateUrl="/WebApi/IsSecurityTokenValid",t.ValidationRequestActive=ko.observable(!1),t.CurrentSecurityToken=ko.observable(null),t.SecurityTokens=ko.observableArray([]),t.MessageError=ko.observable(null),t.MessageSuccess=ko.observable(null),t.HasMessage=ko.computed(function(){return null!=t.MessageError()||null!=t.MessageSuccess()}),t.IsCameraOn=ko.observable(!1),t.IsCameraPending=ko.observable(!1),t.IsScanFinished=ko.observable(!1),t.IsCameraOn.subscribe(function(e){e?(t.OnCameraOn&&t.OnCameraOn(t.Decoder),t.CurrentSecurityToken(null),t.MessageError(null),t.MessageSuccess(null),t.IsScanFinished(!1)):t.OnCameraOff&&t.OnCameraOff(t.Decoder),t.ValidationRequestActive(!1),t.IsCameraPending(e)}),t.CurrentSecurityToken.subscribe(function(e){null!=e&&t.SecurityTokens.push(e)}),t}return __extends(t,e),t.prototype.OnCameraOn=function(e){},t.prototype.OnCameraOff=function(e){},t.prototype.OnValidateComplete=function(e,t){},t.prototype.ToggleCamera=function(){this.IsCameraOn(!this.IsCameraOn())},t.prototype.CameraIsNowReady=function(){this.IsCameraPending(!1)},t.prototype.ValidateResultCode=function(e){var t,o,n;this.ValidationRequestActive()||(this.ValidationRequestActive(!0),t=this,o=GetLangRes("SecurityTokenValidator_invalideQrCode","Wrong type of QR-Code, please scan a SecurityToken"),null==(e=new URL(e))?(this.MessageError(o),this.ValidationRequestActive(!1)):((n=new SecurityToken).Token(e.searchParams.get("t")),n.CreatorUserName(e.searchParams.get("u")),n.CreatedTicks(e.searchParams.get("c")),n.ScannedTicks(GetTicksFromDate(new Date)),n.IsPending(!0),this.CurrentSecurityToken(n),null==n.Token()||n.Token().length<1?(this.MessageError(o),this.ValidationRequestActive(!1)):(this.IsCameraOn(!1),jQuery.ajax({type:"POST",url:t.ValidateUrl,data:{token:n.Token()},cache:!1,dataType:"json",success:function(e){n.IsValid(e.IsOk),t.IsScanFinished(!0)},error:function(){},complete:function(){n.IsPending(!1),t.OnValidateComplete(n.IsValid(),n.CreatorUserName())}}))))},t.prototype.setDefaultDecoder=function(e,t){var o=this;this.Decoder=e.WebCodeCamJQuery({zoom:1,beep:null,resultFunction:function(e){o.ValidateResultCode(e.code)},cameraSuccess:function(e){o.CameraIsNowReady()},canPlayFunction:function(){},getDevicesError:function(e){o.IsCameraOn(!1),o.MessageError(e.message)},getUserMediaError:function(e){o.IsCameraOn(!1),o.MessageError(e.message)},cameraError:function(e){o.IsCameraOn(!1),o.MessageError(e.message)},constraints:{video:{mandatory:{maxWidth:960,maxHeight:540}},audio:!1},flipHorizontal:!0,decoderWorker:t}).data().plugin_WebCodeCamJQuery,this.OnCameraOn=function(e){e.play()},this.OnCameraOff=function(e){e.stop()}},t}(BaseViewModel),TourDetailViewModel=function(r){function e(e){var t=r.call(this)||this;if(t.ALTITUDE_UNKNOWN=32768,t.ALTITUDE_FROM_MISSING_QUADRANT=32769,t.ALTITUDE_SEA_LEVEL=.001,t.CurrentTourIndex=ko.observable(-1),t.TourItems=ko.observableArray([]),t.Coordinates=ko.observableArray([]),t.NiceTourCoordinates=ko.observableArray([]),t.ElevationMax=ko.observable(0),t.ElevationMaxString=ko.computed(function(){return 0!=t.ElevationMax()?Math.round(t.ElevationMax())+"m":""}),t.ElevationMin=ko.observable(0),t.ElevationMinString=ko.computed(function(){return 0!=t.ElevationMin()?Math.round(t.ElevationMin())+"m":""}),t.MetaElapsedTime=ko.observable(0),t.MetaDistanceTravelled=ko.observable(0),t.MetaAverageSpeed=ko.observable(0),t.MetaElevationUp=ko.observable(0),t.MetaElevationDown=ko.observable(0),t.MetaEffectiveDistance=ko.observable(0),t.CoordinateRequestActive=ko.observable(!1),t.cWidth=3e3,t.cHeight=1e3,t.cMargin=5,t.ElevationCanvasIdentifier=ko.observable(null),t.ElevationMousemoveIndex=ko.observable(-1),t.ElevationClickedIndex=ko.observable(-1),t.UniqueKey=e.UniqueKey||"",t.LoginName=GetLoginNameFromUniqueKey(t.UniqueKey),t.CreationTicks=GetTicksFromUniqueKey(t.UniqueKey),t.Entity=e,t.NoseDto=new NoseDto({LoginName:t.LoginName}),t.ElevationMousemoveIndex.subscribe(function(e){t.DrawElevation()}),t.ElevationClickedIndex.subscribe(function(e){t.DrawElevation()}),t.Entity&&t.Entity.GeoData){var o,n=t.Entity.GeoData,i=new Array;for(o in n){var a,s=n[o];s.properties&&(s.geometry?(a={UniqueKey:s.properties.identifier,Latitude:s.geometry.coordinates[1],Longitude:s.geometry.coordinates[0]},"poi"==s.properties.type?i.push(new PoiDto(a)):"blog"==s.properties.type&&i.push(new PhotoBlogDto(a))):"blog"==s.properties.type&&i.push(new PhotoBlogDto({UniqueKey:s.properties.identifier})))}ko.utils.arrayPushAll(t.TourItems(),i.sort(function(e,t){return e.CreationTicks<t.CreationTicks?-1:e.CreationTicks>t.CreationTicks?1:0}))}return t}return __extends(e,r),e.prototype.UpdateMetaInformations=function(){this.MetaElapsedTime(this.GetElapsedTime()),this.MetaDistanceTravelled(this.GetDistanceTravelled()),this.MetaAverageSpeed(this.GetAverageSpeed()),this.MetaElevationUp(this.GetElevationUp()),this.MetaElevationDown(this.GetElevationDown()),this.MetaEffectiveDistance(this.GetEffectiveDistance())},e.prototype.OnLoadCoordinates=function(){},e.prototype.LoadCoordinates=function(){var i=this;this.CoordinateRequestActive()||(this.CoordinateRequestActive(!0),jQuery.ajax({type:"GET",url:"/Tour/Coordinates",cache:!1,data:{id:this.UniqueKey},dataType:"json",success:function(e){if(e)for(var t=0,o=e;t<o.length;t++){var n=o[t],n=new Coordinate(n);n.type==CoordinateTypeEnum.Touch&&i.Coordinates.push(n)}i.DrawElevation(),i.OnLoadCoordinates(),i.UpdateMetaInformations(),i.CoordinateRequestActive(!1)},error:function(){dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorLoadCoordinates","Coordinates cannot be loaded!"),null),i.CoordinateRequestActive(!1)}}))},e.prototype.DrawElevation=function(){var t=this,e=this.ElevationCanvasIdentifier()||"",o=$(e)[0];if(o.getContext){o.width=this.cWidth+2*this.cMargin,o.height=this.cHeight+2*this.cMargin;var n=o.getContext("2d");n.fillStyle="#eeeeee",n.rect(this.cMargin,this.cMargin,this.cWidth,this.cHeight),n.fill(),n.lineWidth=10,n.strokeStyle="#dddddd",n.stroke();for(var i=this.GetDistanceTravelled(),a=this.AnyCoordinatesWithAlt(this.NiceTourCoordinates())?this.NiceTourCoordinates():this.Coordinates(),s=a[0].ticks,r=this.ALTITUDE_UNKNOWN,l=0,u=0,d=a;u<d.length;u++)r>(f=d[u]).alt&&0!=f.alt&&(r=f.alt),l<f.alt&&f.alt!=this.ALTITUDE_UNKNOWN&&f.alt!=this.ALTITUDE_FROM_MISSING_QUADRANT&&(l=f.alt);var c=void 0,o=l-r,c=o<50?(r-=20,l+=20,10):o<100?(r-=20,l+=20,20):(r-=50,l+=50,100);this.ElevationMin(r),this.ElevationMax(l);for(var m=Math.floor(r/c)+1;m<Math.floor(l/c);m++){var h=this.cHeight/Math.abs(l-r),h=this.cHeight-(m*c-r)*h;n.beginPath(),n.moveTo(this.cMargin,h+this.cMargin),n.lineTo(this.cWidth+this.cMargin,h+this.cMargin),n.lineWidth=5,n.strokeStyle="#dddddd",n.stroke()}n.beginPath();for(var g=null,p=0,b=-1,v=-1,y=-1,m=0;m<a.length;m++){var f=a[m],C=this.cMargin;null!=g&&(0!=f.alt&&f.alt!=this.ALTITUDE_UNKNOWN||(f.alt=g.alt),p+=Math.abs(f.Location.distanceTo(g.Location)),C+=this.cWidth/i*p,f.AgeString=GetAgeString(s,f.ticks,!0,!0));var w=this.cHeight-this.cHeight/(l-r)*(f.alt-r)+this.cMargin;null!=g?n.lineTo(C,w):n.moveTo(C,w),m==this.ElevationClickedIndex()&&(b=C,v=w,f.alt),m==this.ElevationMousemoveIndex()&&(y=C,f.alt),f.Distance=p,f.PercentageX=0<p?p/i:0,g=f}n.lineWidth=20,n.strokeStyle="#ff0000",n.stroke(),0<=y&&this.DrawVerticalLine(n,y,-1,"#0077dd","#ffff00"),0<=b&&this.DrawVerticalLine(n,b,v,"#ff0000","#ffff00"),$(e).off(),$(e).on("mouseout",function(e){t.OnElevationMouseOut(),t.ElevationMousemoveIndex(-1)}),$(e).on("mousemove",function(e){t.HandleElevationEvent(a,e)}),$(e).on("click",function(e){t.HandleElevationEvent(a,e)})}},e.prototype.DrawVerticalLine=function(e,t,o,n,i){e.beginPath(),e.moveTo(t,this.cMargin),e.lineTo(t,this.cHeight+this.cMargin),e.lineWidth=10,e.strokeStyle=n,e.stroke(),0<=o&&(e.beginPath(),e.arc(t,o,30,0,2*Math.PI,!0),e.lineWidth=20,e.strokeStyle=n,e.stroke(),e.fillStyle=i,e.fill())},e.prototype.OnElevationMouseMove=function(e){},e.prototype.OnElevationMouseOut=function(){},e.prototype.OnElevationClick=function(e){},e.prototype.HandleElevationEvent=function(e,t){t.preventDefault(),t.stopPropagation();var o=t.type;try{for(var n,i=-1,a=(t.clientX-$(t.target).offset().left)/$(t.target).width(),s=1e4,r=0;r<e.length;r++){var l=e[r],u=Math.abs(a-l.PercentageX);u<s&&(s=u,i=r)}0<=i&&(n=e[i],"click"==o?(this.ElevationClickedIndex(i),this.OnElevationClick(n)):"mousemove"==o&&(this.ElevationMousemoveIndex(i),this.OnElevationMouseMove(n)))}catch(t){console&&console.log(t)}},e.prototype.AnyCoordinatesWithAlt=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];if(n.alt!=this.ALTITUDE_UNKNOWN&&n.alt!=this.ALTITUDE_FROM_MISSING_QUADRANT)return!0}return!1},e.prototype.GetElapsedTime=function(){var e=this.Coordinates();if(0<e.length){var t=e[0],e=e[e.length-1];if(null!=t&&null!=e){t=GetDateFromTicks(e.ticks).getTime()-GetDateFromTicks(t.ticks).getTime();return Math.floor(Math.abs(t/1e3))}}return 0},e.prototype.GetDistanceTravelled=function(){for(var e=0,t=null,o=0,n=0<this.NiceTourCoordinates().length?this.NiceTourCoordinates():this.Coordinates();o<n.length;o++){var i=n[o];null!=t&&(e+=Math.abs(i.Location.distanceTo(t.Location))),t=i}return e},e.prototype.GetElevationUp=function(){return this.GetElevation(1,0)},e.prototype.GetElevationDown=function(){return this.GetElevation(-1,0)},e.prototype.GetElevation=function(e,t){var o=0;return o=(o=0<this.NiceTourCoordinates().length?this.GetElevationFromCoordinates(this.NiceTourCoordinates(),e,t):o)<1?this.GetElevationFromCoordinates(this.Coordinates(),e,t):o},e.prototype.GetElevationFromCoordinates=function(e,t,o){var n=!1,i=0;if(null!=e)for(var a=null,s=0,r=e;s<r.length;s++){var l,u,d,c=r[s];Math.abs(c.alt)>this.ALTITUDE_SEA_LEVEL&&c.alt!=this.ALTITUDE_UNKNOWN&&(n=!0),null==a?a=c:Math.abs(a.alt)>this.ALTITUDE_SEA_LEVEL&&Math.abs(c.alt)>this.ALTITUDE_SEA_LEVEL&&a.alt!=this.ALTITUDE_UNKNOWN&&c.alt!=this.ALTITUDE_UNKNOWN&&(l=!1,u=c.alt-a.alt,0<o&&!(0<(d=Math.abs(a.Location.distanceTo(c.Location)))&&o<=Math.abs(u)/d*100)||(l=!0),(0==t||t<0&&u<0||0<t&&0<u)&&l&&(i+=Math.abs(u)),a=c)}return n?i:-1},e.prototype.GetEffectiveDistance=function(){var e=this.GetDistanceTravelled(),t=Math.floor(Math.max(this.GetElevation(1,0),0)/100);1<=t&&(e+=1e3*t);t=Math.floor(Math.max(this.GetElevation(-1,20),0)/150);return 1<=t&&(e+=1e3*t),e},e.prototype.GetAverageSpeed=function(){var e=0,t=this.GetElapsedTime(),o=this.GetDistanceTravelled();return e=0<t&&0<o?o/t*3.6:e},e}(BaseViewModel),UserDetailViewModel=function(t){function e(e){var o=t.call(this)||this;return o.loginName=e,o.PhotoBlogs=ko.observableArray([]),o.PhotoBlogsPageSize=gnSettings.PhotoBlogsPageSize,o.PhotoBlogsLastKnownTicks=window.MAX_DATE_TIME_TICKS,o.HasMorePhotoBlogs=ko.observable(!0),o.PhotoBlogsRequestActive=ko.observable(!1),o.PhotoBlogsGroupValueTemp=ko.observable(0),o.PhotoBlogsGroupValue=ko.observable(0).extend({notify:"always"}),o.PhotoBlogsGroupCount=0,o.RequestUntilPhotoBlogsGroup=0,o.LoadNextGroupClicked=!1,o.LoadNextGroupRequestCount=0,o.PhotoBlogsGroupType=ko.observable(GroupTypeEnum.None),o.PhotoBlogsGroupTypeString=ko.computed(function(){return o.PhotoBlogsGroupType()==GroupTypeEnum.ByDay?GetLangRes("Common_lblGroupTypeByDay","Group by day"):o.PhotoBlogsGroupType()==GroupTypeEnum.ByWeek?GetLangRes("Common_lblGroupTypeByWeek","Group by week"):o.PhotoBlogsGroupType()==GroupTypeEnum.ByMonth?GetLangRes("Common_lblGroupTypeByMonth","Group by month"):o.PhotoBlogsGroupType()==GroupTypeEnum.Custom?GetLangRes("Common_lblGroupTypeCustom","Smart group"):GetLangRes("Common_lblGroupTypeNone","No grouping")}),o.PhotoBlogsGroupValueLabel=ko.computed(function(){return 60<=o.PhotoBlogsGroupValueTemp()?o.PhotoBlogsGroupValueTemp()/60+"h":1<=o.PhotoBlogsGroupValueTemp()?o.PhotoBlogsGroupValueTemp()+"min":GetLangRes("Common_lblNoGrouping","No Grouping")}),o.PhotoBlogsScrollAutoLoad=ko.computed(function(){var e=o.PhotoBlogsGroupType(),t=o.PhotoBlogsGroupValue();return e==GroupTypeEnum.None||e==GroupTypeEnum.Custom&&t<1}),o.PhotoBlogsStartTicksValue=ko.observable(window.MAX_DATE_TIME_TICKS),o.PhotoBlogsStartDate=ko.observable(""),o.ShareUrl=ko.pureComputed(function(){var e=new Array;return 0<o.PhotoBlogsGroupValue()&&e.push("bg="+o.PhotoBlogsGroupValue()),o.PhotoBlogsStartTicksValue()!=window.MAX_DATE_TIME_TICKS&&e.push("bs="+o.PhotoBlogsStartTicksValue()),o.PhotoBlogsGroupType()!=GroupTypeEnum.None&&e.push("bgt="+o.PhotoBlogsGroupType()),o.NoseDto?o.NoseDto.ShareUrl()+(0<e.length?"?"+e.join("&"):""):""},o),o.Pois=ko.observableArray(),o.PoisPageSize=gnSettings.PoisPageSize,o.PoisLastKnownTicks=window.MAX_DATE_TIME_TICKS,o.HasMorePois=ko.observable(!0),o.PoisRequestActive=ko.observable(!1),o.Tours=ko.observableArray(),o.ToursPageSize=gnSettings.ToursPageSize,o.ToursLastKnownTicks=window.MAX_DATE_TIME_TICKS,o.HasMoreTours=ko.observable(!0),o.ToursRequestActive=ko.observable(!1),o.Events=ko.observableArray(),o.EventsPageSize=gnSettings.EventsPageSize,o.EventsLastKnownTicks=window.MAX_DATE_TIME_TICKS,o.HasMoreEvents=ko.observable(!0),o.EventsRequestActive=ko.observable(!1),o.PhotoBlogsRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),o.PoisRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),o.ToursRequestActive.subscribe(function(e){ShowPreviewPageLoad(e)}),o.NoseDto=new NoseDto({LoginName:o.loginName}),o.PhotoBlogsGroupType.subscribe(function(e){e!=GroupTypeEnum.Custom?(o.PhotoBlogsStartDate(""),o.PhotoBlogsGroupValue(0)):o.UpdatePhotoBlogGroup()}),o.PhotoBlogsGroupValue.subscribe(function(e){o.PhotoBlogsGroupValueTemp(e),o.UpdatePhotoBlogGroup()}),o.PhotoBlogsStartTicksValue.subscribe(function(e){o.PhotoBlogsLastKnownTicks=e,o.PhotoBlogs.removeAll(),o.HasMorePhotoBlogs(!0),o.PageBlogs()}),o.PhotoBlogsStartDate.subscribe(function(e){e?(e=moment(e).tz("UTC").add(1,"d").startOf("day").toDate(),e=GetTicksFromDate(e),o.PhotoBlogsStartTicksValue(e)):o.PhotoBlogsStartTicksValue(window.MAX_DATE_TIME_TICKS)}),o}return __extends(e,t),e.prototype.LengthBasedContent=function(e){return e?200<e.length?"<p>"+e+"</p>":100<e.length?'<h5 class="text-center">'+e+"</h5>":50<e.length?'<h4 class="text-center">'+e+"</h4>":'<h3 class="text-center">'+e+"</h3>":""},e.prototype.UpdatePhotoBlogsGroupValue=function(e,t){var o=0,o=e<15?e:e<18?15+15*(e-15):60+60*(e-18);t?this.PhotoBlogsGroupValue(o):this.PhotoBlogsGroupValueTemp(o)},e.prototype.GetPhotoBlogsGroupSliderVal=function(e){return e<=15?e:e<=60?(e-15)/15+15:(e-60)/60+18},e.prototype.OnUpdatePhotoBlogGroup=function(){},e.prototype.UpdatePhotoBlogGroup=function(){var i,a,s=this,r=0,l=0,u=this.PhotoBlogsGroupValue(),d=new BigNumber(u).multiply(6e8);ko.utils.arrayForEach(this.PhotoBlogs(),function(e,t){e.GroupType(s.PhotoBlogsGroupType()),e.IsLastIncompleteGroup(!1);var o,n=new BigNumber(e.CreationTicks);new BigNumber(s.PhotoBlogsStartTicksValue());s.PhotoBlogsScrollAutoLoad()&&s.PhotoBlogsGroupValue()<1&&s.PhotoBlogsStartTicksValue()==window.MAX_DATE_TIME_TICKS?(l++,e.IsGrouped(!1),e.GroupCount(1),e.GroupName("")):s.PhotoBlogsGroupType()==GroupTypeEnum.Custom?(r=5,0<u?(void 0!==i&&-1==a.subtract(n).compare(d)?(e.IsGrouped(!0),i.GroupCount(i.GroupCount()+1)):(l++,(i=e).IsGrouped(!1),i.GroupCount(1)),a=new BigNumber(e.CreationTicks),e.GroupName(i.CreationTicks)):(l++,e.IsGrouped(!1),e.GroupCount(1),e.GroupName(""))):(r=s.PhotoBlogsGroupType()==GroupTypeEnum.ByWeek?4:s.PhotoBlogsGroupType()==GroupTypeEnum.ByMonth?3:5,void 0===i?(l++,(i=e).IsGrouped(!1),i.GroupCount(1),i.GroupName(e.CreationTicks)):(o=GetDateFromTicks(i.CreationTicks),n=GetDateFromTicks(e.CreationTicks),s.PhotoBlogsGroupType()==GroupTypeEnum.ByDay&&o.getFullYear()==n.getFullYear()&&o.getMonth()==n.getMonth()&&o.getDate()==n.getDate()||s.PhotoBlogsGroupType()==GroupTypeEnum.ByWeek&&moment(o).week()==moment(n).week()||s.PhotoBlogsGroupType()==GroupTypeEnum.ByMonth&&o.getFullYear()==n.getFullYear()&&o.getMonth()==n.getMonth()?(e.IsGrouped(!0),i.GroupCount(i.GroupCount()+1)):(l++,(i=e).IsGrouped(!1),i.GroupCount(1)),e.GroupName(i.CreationTicks))),i&&(t===s.PhotoBlogs().length-1&&s.HasMorePhotoBlogs()&&!s.PhotoBlogsScrollAutoLoad()?i.IsLastIncompleteGroup(!0):i.IsLastIncompleteGroup(!1))}),this.PhotoBlogsGroupCount=l,!this.PhotoBlogsScrollAutoLoad()&&l<Math.max(r,this.RequestUntilPhotoBlogsGroup)&&this.HasMorePhotoBlogs()&&this.PageBlogs(),this.OnUpdatePhotoBlogGroup&&this.OnUpdatePhotoBlogGroup()},e.prototype.OnAddPhotoBlogs=function(e){},e.prototype.AddPhotoBlogs=function(e){if(null!=e){if(0<e.length){this.PhotoBlogsLastKnownTicks=e[e.length-1].CreationTicks;for(var t=0,o=e;t<o.length;t++){var n=o[t];this.PhotoBlogs.push(new PhotoBlogDto(n))}e.length%this.PhotoBlogsPageSize!=0&&this.HasMorePhotoBlogs(!1)}else this.HasMorePhotoBlogs(!1);this.UpdatePhotoBlogGroup(),this.OnAddPhotoBlogs&&this.OnAddPhotoBlogs(e)}},e.prototype.PageBlogs=function(){var t=this;if(this.LoadNextGroupClicked){if(10<this.LoadNextGroupRequestCount)return this.LoadNextGroupClicked=!1,void(this.LoadNextGroupRequestCount=0);this.LoadNextGroupRequestCount++}!this.PhotoBlogsRequestActive()&&this.HasMorePhotoBlogs()&&(this.PhotoBlogsRequestActive(!0),jQuery.ajax({type:"POST",url:"/Nose/Page_Blogs",cache:!1,data:{loginName:this.loginName,lastKnownBlogTicks:this.PhotoBlogsLastKnownTicks,pageSize:this.PhotoBlogsPageSize},dataType:"json",success:function(e){t.PhotoBlogsRequestActive(!1),e&&0<e.length?t.AddPhotoBlogs(e):t.HasMorePhotoBlogs(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.PhotoBlogsRequestActive(!1)}}))},e.prototype.LoadNextGroup=function(){this.LoadNextGroupClicked=!0,this.LoadNextGroupRequestCount=0,this.RequestUntilPhotoBlogsGroup=this.PhotoBlogsGroupCount+1,this.UpdatePhotoBlogGroup()},e.prototype.OnAddPois=function(e){},e.prototype.AddPois=function(e){if(null!=e){if(0<e.length){this.PoisLastKnownTicks=e[e.length-1].CreationTicks;for(var t=0,o=e;t<o.length;t++){var n=o[t];this.Pois.push(new PoiDto(n))}e.length%this.PoisPageSize!=0&&this.HasMorePois(!1)}else this.HasMorePois(!1);this.OnAddPois&&this.OnAddPois(e)}},e.prototype.PagePois=function(){var t=this;!this.PoisRequestActive()&&this.HasMorePois()&&(this.PoisRequestActive(!0),jQuery.ajax({type:"POST",url:"/Nose/Page_PoIs",cache:!1,data:{loginName:this.loginName,lastKnownPoITicks:this.PoisLastKnownTicks,pageSize:this.PoisPageSize},dataType:"json",success:function(e){e&&0<e.length?t.AddPois(e):t.HasMorePois(!1),t.PoisRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.PoisRequestActive(!1)}}))},e.prototype.OnAddTours=function(e){},e.prototype.AddTours=function(e){if(null!=e){if(0<e.length){this.ToursLastKnownTicks=e[e.length-1].CreationTicks;for(var t=0,o=e;t<o.length;t++){var n=o[t];this.Tours.push(new TourDto(n))}e.length%this.ToursPageSize!=0&&this.HasMoreTours(!1)}else this.HasMoreTours(!1);this.OnAddTours&&this.OnAddTours(e)}},e.prototype.PageTours=function(){var t=this;!this.ToursRequestActive()&&this.HasMoreTours()&&(this.ToursRequestActive(!0),jQuery.ajax({type:"POST",url:"/Nose/Page_Tours",cache:!1,data:{loginName:this.loginName,lastKnownTourTicks:this.ToursLastKnownTicks,pageSize:this.ToursPageSize},dataType:"json",success:function(e){e&&0<e.length?t.AddTours(e):t.HasMoreTours(!1),t.ToursRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.ToursRequestActive(!1)}}))},e.prototype.OnAddEvents=function(e){},e.prototype.AddEvents=function(e){if(null!=e){if(0<e.length){this.EventsLastKnownTicks=e[e.length-1].CreationTicks;for(var t=0,o=e;t<o.length;t++){var n=o[t];this.Events.push(new EventDto(n))}e.length%this.EventsPageSize!=0&&this.HasMoreEvents(!1)}else this.HasMoreEvents(!1);this.OnAddEvents&&this.OnAddEvents(e)}},e.prototype.PageEvents=function(){var t=this;!this.EventsRequestActive()&&this.HasMoreEvents()&&(this.EventsRequestActive(!0),jQuery.ajax({type:"POST",url:"/Nose/Page_Events",cache:!1,data:{loginName:this.loginName,lastKnownEventTicks:this.EventsLastKnownTicks,pageSize:this.EventsPageSize},dataType:"json",success:function(e){e&&0<e.length?t.AddEvents(e):t.HasMoreEvents(!1),t.EventsRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.EventsRequestActive(!1)}}))},e}(BaseViewModel);