<html
  xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
  xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
  xmlns:nose="http://typo3.org/ns/SmartNoses/Gpsnose/ViewHelpers"
  data-namespace-typo3-fluid="true">

<f:layout name="Default" />


<f:section name="title"><f:translate key="MashupAdmin_lblLoginTitle" /></f:section>


<f:section name="buttons">
</f:section>


<f:section name="messages">
    <f:flashMessages />
</f:section>


<f:section name="content">
<div class="row">
    <div class="col-lg-4 col-md-3 col-sm-3 col-xs-12"></div>
    <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
        <f:if condition="{qr_code_image}">
            <f:then>
                <img class="qrcode" src="data:image/png;base64,{qr_code_image}" />
            </f:then>
            <f:else>
                <p>No image created</p>
            </f:else>
        </f:if>
    </div>
    <div class="col-lg-4 col-md-3 col-sm-3 col-xs-12"></div>
</div>

<f:if condition="{login_id}">
<script>
var loginId = '{login_id}';
$(document).ready(function() {
    // Check if logged in
    window.setTimeout(WaitForLogin, 3500);
});
function WaitForLogin() {
    $.ajax({
        type: 'POST',
        url: TYPO3.settings.ajaxUrls['gpsnose::loginVerifie'],
        data: {
            "LoginId": loginId
           },
        dataType: 'json',
        success: function(result) {
            if (result.IsOk) {
                document.location.reload();
            } else {
                window.setTimeout(WaitForLogin, 3500);
            }
        },
        error: function () {
            window.setTimeout(WaitForLogin, 3500);
        }
    });
}
</script>
</f:if>

</f:section>

</html>